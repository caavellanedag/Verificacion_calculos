*LIBNAME PRUEBA "\\prowin02\omartinezm\SASFILES\Verificacion Calculos";
*LIBNAME PRUEBA "\\prowin02\lcarrillo\SASFILES\Laura\VERIFICACION_CALCULOS";
*LIBNAME PRUEBA "\\prowin02\bcamargo\SASFILES\Verificacion_Calculos_2020";
*LIBNAME MUESTRA '\\prowin02\omartinezm\SASFILES\Puntos_Muestra_2017';
/*proc printto log="\\prowin02\dospina\SASFILES\SASLog\EG.log"; RUN;*/


/*CREACION DE LIBRERIAS NECESARIAS*/
%let _timer_start = %sysfunc(datetime());
%LET RUTA = \\prowin04\cavellaneda\EJERCICIOS\EJERCICIOS 2021\VERIFICACION_CALCULOS;
LIBNAME PRUEBA "\\prowin04\cavellaneda\EJERCICIOS\EJERCICIOS 2021\VERIFICACION_CALCULOS";
*%INCLUDE "//prowin04/cavellaneda/EJERCICIOS/EJERCICIOS 2021/VERIFICACION_CALCULOS/MACRO_USOP.SAS";

/*USO PREDOMINANTE*/
%MACRO USOP(VISTA_ANO, PREDIO_ANO,PREDIO_USO_ANO,CODIGO_USOP_ANO);/*VISTA_ANO=BASE CON VISTA CALIFICACION DEL AÑO CORRESPONDIETE,
 
/* EXTRACCIÓN DEL USO DE LA BASE VISTA_CALIFICACIÓN */
PROC SQL;
	CREATE TABLE USOS_VISTA AS
 	SELECT CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO, 
		  CODIGO_CONSTRUCCION, CODIGO_RESTO, 
		  UNIDAD_CALIFICADA, CODIGO_USO, AREA_USO, CLASE_CONSTRUCCION, PUNTAJE
     FROM &VISTA_ANO;
QUIT; 

/* SE CREA UNA BASE CON LA SUMA DE AREA DE USO POR PREDIO-USO */
PROC SQL;
	CREATE TABLE PREDIOUSO AS SELECT *, ROUND(SUM(AREA_USO),0.01) AS SUM_USO
	FROM USOS_VISTA
	GROUP BY CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO, 
		    CODIGO_CONSTRUCCION, CODIGO_RESTO, CODIGO_USO;
QUIT;
 
/* SE CREA TABLA CON LA MODA DEL USO A NIVEL DE PREDIOS 

  (en caso de empates se selecciona  en orden 
   CODIGO_BARRIO CODIGO_MANZANA CODIGO_PREDIO CODIGO_CONSTRUCCION CODIGO_RESTO
   SUM_USO, UNIDAD_CALIFICADA, DESCENDING CLASE_CONSTRUCCION,  DESCENDING PUNTAJE, CODIGO_USO)
*/
PROC SQL;
     CREATE TABLE PREDIOSU AS
     SELECT DISTINCT CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO, 
				 CODIGO_CONSTRUCCION, CODIGO_RESTO, CODIGO_USO, SUM_USO, UNIDAD_CALIFICADA, CLASE_CONSTRUCCION, PUNTAJE,
				 MAX(SUM_USO) AS MAX_PRED_USO
     FROM PREDIOUSO 
     GROUP BY CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO, 
		    CODIGO_CONSTRUCCION, CODIGO_RESTO 
     HAVING SUM_USO = MAX_PRED_USO;
QUIT;


PROC SORT DATA = PREDIOSU OUT = PREDIOSU1;
by CODIGO_BARRIO CODIGO_MANZANA CODIGO_PREDIO CODIGO_CONSTRUCCION CODIGO_RESTO
   SUM_USO UNIDAD_CALIFICADA DESCENDING CLASE_CONSTRUCCION  DESCENDING PUNTAJE CODIGO_USO;RUN;


/*******************************************************/
 

/*SE ELIMINAN DUPLICADOS POR PREDIO*/
PROC SORT DATA = PREDIOSU1 OUT = PREDIOS_UP NODUPKEY dupout=PREDIOSDUPLI1;
     BY CODIGO_BARRIO CODIGO_MANZANA CODIGO_PREDIO CODIGO_CONSTRUCCION CODIGO_RESTO;
RUN; 
 
/* PEGADO DEL USO PREDOMINANTE A LA BASE DE PREDIOS */
PROC SQL;
	CREATE TABLE &PREDIO_USO_ANO AS 
	SELECT A.*, B.CODIGO_USO AS &CODIGO_USOP_ANO
	FROM &PREDIO_ANO AS A LEFT JOIN PREDIOS_UP AS B 
	ON A.CODIGO_BARRIO=B.CODIGO_BARRIO AND A.CODIGO_MANZANA=B.CODIGO_MANZANA AND
	   A.CODIGO_PREDIO=B.CODIGO_PREDIO AND A.CODIGO_CONSTRUCCION = B.CODIGO_CONSTRUCCION AND 
	   A.CODIGO_RESTO=B.CODIGO_RESTO;
QUIT;
 
PROC SQL; DROP TABLE USOS_VISTA; QUIT;
PROC SQL; DROP TABLE PREDIOUSO; QUIT;
PROC SQL; DROP TABLE PrediosU; QUIT;
/*PROC SQL; DROP TABLE Predios_UP; QUIT;*/
 
%MEND USOP;


%LET FECHA_CORTE = 211007;
%LET VIGENCIA = 2022;
%LET VIGENCIA_2 = 22;
%LET YEAR = &VIGENCIA. - 1;
%LET VIGENCIA_ANT = %sysevalf(&VIGENCIA.-1);
%LET VIGENCIA_ANT_2 = %sysevalf(&VIGENCIA_2.-1);
%LET VIGENCIA_ANT_ANT = %sysevalf(&VIGENCIA.-2);
%LET VIGENCIA_ANT_ANT_2 = %sysevalf(&VIGENCIA_2.-2);


DATA COMUN.PREDIO_&FECHA_CORTE.; 
SET ODBCLIB.PREDIO;
IF CODIGO_DESTINO = '99' THEN delete;
IF MARCA_FORMACION = 'S' THEN delete;
RUN;

PROC SQL;   CREATE TABLE COMUN.VISTA_CALIFICACION_&FECHA_CORTE. AS	
		SELECT A.*, B.CODIGO_DESTINO, B.MARCA_FORMACION
		FROM  ODBCLIB.VISTA_CALIFICACION AS A
		INNER JOIN (SELECT DISTINCT CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO, CODIGO_CONSTRUCCION, CODIGO_RESTO, 
		CODIGO_DESTINO, MARCA_FORMACION
         FROM COMUN.PREDIO_&FECHA_CORTE.) AS B
				ON	A.CODIGO_BARRIO = B.CODIGO_BARRIO &
					A.CODIGO_MANZANA = B.CODIGO_MANZANA &
					A.CODIGO_PREDIO = B.CODIGO_PREDIO &
					A.CODIGO_CONSTRUCCION = B.CODIGO_CONSTRUCCION &
					A.CODIGO_RESTO = B.CODIGO_RESTO;
QUIT;


/* Modicar edad de acuerdo a la vigencia en curso */
PROC SQL;   CREATE TABLE TEMP1_BASE_CALCULOS AS	
		SELECT B.*, A.*,
		CASE WHEN (&VIGENCIA. - A.VETUSTEZ) = 0 THEN 1 ELSE (&VIGENCIA. - A.VETUSTEZ) END AS EDAD
			FROM  COMUN.PREDIO_&FECHA_CORTE. AS B LEFT JOIN COMUN.VISTA_CALIFICACION_&FECHA_CORTE. AS A
				ON	A.CODIGO_BARRIO = B.CODIGO_BARRIO &
					A.CODIGO_MANZANA = B.CODIGO_MANZANA &
					A.CODIGO_PREDIO = B.CODIGO_PREDIO &
					A.CODIGO_CONSTRUCCION = B.CODIGO_CONSTRUCCION &
					A.CODIGO_RESTO = B.CODIGO_RESTO
			ORDER BY A.CODIGO_BARRIO, A.CODIGO_MANZANA, A.CODIGO_PREDIO, A.CODIGO_CONSTRUCCION, A.CODIGO_RESTO,
			A.CODIGO_USO, A.UNIDAD_CALIFICADA;
QUIT;



/*Cálculo del número de unidades calificadas por cada predio*/

/*Cálculo del número de usos por cada predio*/
PROC SQL;	CREATE TABLE TEMP1_NUM_USOS AS  /*Cálculo del número de usos por cada predio*/
		SELECT DISTINCT CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO, CODIGO_CONSTRUCCION, CODIGO_RESTO,
		CODIGO_USO
			FROM COMUN.VISTA_CALIFICACION_&FECHA_CORTE.
			ORDER BY CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO, CODIGO_CONSTRUCCION, CODIGO_RESTO, CODIGO_USO;
QUIT;


/*Agrega información de número de unidades calificadas y número de usos distintos por predio*/
PROC SQL;	CREATE TABLE TEMP1_BASE_CALCULOS AS /*Agrega información de número de unidades calificadas y número de usos distintos por predio*/
		SELECT A.*, B.NUMERO_UNIDADES, B.SUMA_PUNTAJE, C.NUM_USOS, 
		D.CODIGO_LOCALIDAD, D.NOMBRE_BARRIO
			FROM TEMP1_BASE_CALCULOS AS A 
            LEFT JOIN 	
              (SELECT DISTINCT CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO, CODIGO_CONSTRUCCION, CODIGO_RESTO,
			COUNT(*) AS NUMERO_UNIDADES, SUM(PUNTAJE) AS SUMA_PUNTAJE
			FROM COMUN.VISTA_CALIFICACION_&FECHA_CORTE.
				GROUP BY CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO, CODIGO_CONSTRUCCION, CODIGO_RESTO) AS B
				ON	A.CODIGO_BARRIO = B.CODIGO_BARRIO &
					A.CODIGO_MANZANA = B.CODIGO_MANZANA &
					A.CODIGO_PREDIO = B.CODIGO_PREDIO &
					A.CODIGO_CONSTRUCCION = B.CODIGO_CONSTRUCCION &
					A.CODIGO_RESTO = B.CODIGO_RESTO
			LEFT JOIN 
			(SELECT DISTINCT CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO, CODIGO_CONSTRUCCION, CODIGO_RESTO,
			COUNT(*) AS NUM_USOS FROM TEMP1_NUM_USOS
			GROUP BY CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO, CODIGO_CONSTRUCCION, CODIGO_RESTO)
			AS C
				ON	A.CODIGO_BARRIO = C.CODIGO_BARRIO &
					A.CODIGO_MANZANA = C.CODIGO_MANZANA &
					A.CODIGO_PREDIO = C.CODIGO_PREDIO &
					A.CODIGO_CONSTRUCCION = C.CODIGO_CONSTRUCCION &
					A.CODIGO_RESTO = C.CODIGO_RESTO
			LEFT JOIN ODBCLIB.BARRIO AS D 
				ON A.CODIGO_BARRIO = D.CODIGO_BARRIO;
QUIT;


proc import datafile = "&RUTA.\Verificacion_calculos\input\PUNTOS_MUESTRA_ASIGNACION_INCORRECTA_MODELO.xlsx"
 out  =  PM_ESTRATO_INCORRECTO
 dbms  =  xlsx
 replace;
 sheet  =  "Hoja2";
run;


PROC SQL;
CREATE TABLE TEMP1_BASE_CALCULOS AS SELECT
A.*, D.PM_ESTRATO_INCORRECTO
FROM TEMP1_BASE_CALCULOS AS A 
LEFT JOIN 
(SELECT DISTINCT CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO,
CODIGO_CONSTRUCCION, CODIGO_RESTO, 1 AS PM_ESTRATO_INCORRECTO FROM PM_ESTRATO_INCORRECTO) AS D
ON A.CODIGO_BARRIO = D.CODIGO_BARRIO AND
A.CODIGO_MANZANA = D.CODIGO_MANZANA AND
A.CODIGO_PREDIO = D.CODIGO_PREDIO AND 
A.CODIGO_CONSTRUCCION = D.CODIGO_CONSTRUCCION AND 
A.CODIGO_RESTO = D.CODIGO_RESTO;
QUIT;


DATA TEMP1_BASE_CALCULOS;
SET TEMP1_BASE_CALCULOS;
IF PM_ESTRATO_INCORRECTO = 1 THEN CODIGO_ESTRATO = 5;
RUN;

/*************************************************************************************************/
/* SE IMPUTA EL ESTRATO PARA PREDIOS RESIDENCIALES POR ESTRATO MODAL POR MANZANA, SECTOR O LOCALIDAD A PARTIR DE COMUN.PREDIO_&FECHA_CORTE.*/
/*************************************************************************************************/

/*Se crea una base de predios con la información de localidad, barrio, manzana, predio y estrato*/

PROC SQL;	CREATE TABLE TEMP1_ESTRATO AS  /*Genera base de moda del estrato (manzana, barrio, localidad) a partir de la base COMUN.PREDIO_&FECHA_CORTE.*/
		SELECT B.CODIGO_LOCALIDAD, A.CODIGO_BARRIO, A.CODIGO_MANZANA, A.CODIGO_PREDIO, A.CODIGO_ESTRATO,
		A.MARCA_FORMACION, A.CODIGO_DESTINO
			FROM COMUN.PREDIO_&FECHA_CORTE. AS A LEFT JOIN ODBCLIB.BARRIO AS B
				ON	A.CODIGO_BARRIO = B.CODIGO_BARRIO
			WHERE	SUBSTR(A.CODIGO_BARRIO,1,1) = '0' & 
					A.CODIGO_ESTRATO IN (1,2,3,4,5,6) &
					(A.MARCA_FORMACION IN ('A','B','C','D','E','F','G','N') | A.MARCA_FORMACION IS NULL) &
					A.CODIGO_DESTINO NOT IN ('99')
			ORDER BY CODIGO_LOCALIDAD, A.CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_ESTRATO;
QUIT;


/*Se crea una tabla con el conteo de predios por estrato a nivel de manzana*/
PROC SQL;	CREATE TABLE TEMP2_ESTRATO AS
		SELECT DISTINCT CODIGO_LOCALIDAD, CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_ESTRATO,
		COUNT(*) AS PREDIOS_ESTRATO_MANZANA
			FROM TEMP1_ESTRATO
			GROUP BY CODIGO_LOCALIDAD, CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_ESTRATO
			ORDER BY CODIGO_LOCALIDAD, CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_ESTRATO;
QUIT;


/*Se crea una tabla con el conteo de predios por estrato a nivel de barrio*/
PROC SQL;	CREATE TABLE TEMP3_ESTRATO AS
		SELECT DISTINCT CODIGO_LOCALIDAD, CODIGO_BARRIO, CODIGO_ESTRATO, COUNT(*) AS PREDIOS_ESTRATO_BARRIO
			FROM TEMP1_ESTRATO
			GROUP BY CODIGO_LOCALIDAD, CODIGO_BARRIO, CODIGO_ESTRATO
			ORDER BY CODIGO_LOCALIDAD, CODIGO_BARRIO, CODIGO_ESTRATO;
QUIT;


/*Se crea una tabla con el conteo de predios por estrato a nivel de localidad*/
PROC SQL;	CREATE TABLE TEMP4_ESTRATO AS
		SELECT DISTINCT CODIGO_LOCALIDAD, CODIGO_ESTRATO, COUNT(*) AS PREDIOS_ESTRATO_LOCALIDAD
			FROM TEMP1_ESTRATO
			GROUP BY CODIGO_LOCALIDAD, CODIGO_ESTRATO
			ORDER BY CODIGO_LOCALIDAD, CODIGO_ESTRATO;
QUIT;


/*Se crea una tabla con la moda del estrato a nivel de manzana (en caso de empates se selecciona el menor estrato)*/
PROC SQL;	CREATE TABLE PRUEBA.MODA_ESTRATO_MANZANA AS
		SELECT DISTINCT CODIGO_LOCALIDAD, CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_ESTRATO,
		MAX(PREDIOS_ESTRATO_MANZANA) AS MAX_PRED_ESTRATO_MANZANA
			FROM TEMP2_ESTRATO
			GROUP BY CODIGO_LOCALIDAD, CODIGO_BARRIO, CODIGO_MANZANA
			HAVING PREDIOS_ESTRATO_MANZANA = MAX_PRED_ESTRATO_MANZANA
			ORDER BY CODIGO_LOCALIDAD, CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_ESTRATO;
QUIT;


PROC SORT
	DATA = PRUEBA.MODA_ESTRATO_MANZANA
	OUT = PRUEBA.MODA_ESTRATO_MANZANA NODUPKEY;
	BY CODIGO_LOCALIDAD CODIGO_BARRIO CODIGO_MANZANA;
RUN;

/*Se crea una tabla con la moda del estrato a nivel de barrio (en caso de empates se selecciona el menor estrato)*/
PROC SQL;	CREATE TABLE PRUEBA.MODA_ESTRATO_BARRIO AS
		SELECT DISTINCT CODIGO_LOCALIDAD, CODIGO_BARRIO, CODIGO_ESTRATO, MAX(PREDIOS_ESTRATO_BARRIO) AS
		MAX_PRED_ESTRATO_BARRIO
			FROM TEMP3_ESTRATO
			GROUP BY CODIGO_LOCALIDAD, CODIGO_BARRIO
			HAVING PREDIOS_ESTRATO_BARRIO = MAX_PRED_ESTRATO_BARRIO
			ORDER BY CODIGO_LOCALIDAD, CODIGO_BARRIO, CODIGO_ESTRATO;
QUIT;

PROC SORT
	DATA = PRUEBA.MODA_ESTRATO_BARRIO
	OUT = PRUEBA.MODA_ESTRATO_BARRIO NODUPKEY;
	BY CODIGO_LOCALIDAD CODIGO_BARRIO;
RUN;

/*Se crea una tabla con la moda del estrato a nivel de localidad (en caso de empates se selecciona el menor estrato)*/
PROC SQL;	CREATE TABLE PRUEBA.MODA_ESTRATO_LOCALIDAD AS
		SELECT DISTINCT CODIGO_LOCALIDAD, CODIGO_ESTRATO, MAX(PREDIOS_ESTRATO_LOCALIDAD) AS
		MAX_PRED_ESTRATO_LOCALIDAD
			FROM TEMP4_ESTRATO
			GROUP BY CODIGO_LOCALIDAD
			HAVING PREDIOS_ESTRATO_LOCALIDAD = MAX_PRED_ESTRATO_LOCALIDAD
			ORDER BY CODIGO_LOCALIDAD, CODIGO_ESTRATO;
QUIT;

PROC SORT
	DATA = PRUEBA.MODA_ESTRATO_LOCALIDAD
	OUT = PRUEBA.MODA_ESTRATO_LOCALIDAD NODUPKEY;
	BY CODIGO_LOCALIDAD;
RUN;


/***********************************************************************/
/* Imputa el código de estrato a los usos residenciales que no lo tienen */
/***********************************************************************/

/***********************************************************************/
/*Pega la moda del estrato a nivel de manzana*/
/***********************************************************************/
DATA MODA_ESTRATO_MANZANA; SET PRUEBA.MODA_ESTRATO_MANZANA;
CODIGO_ESTRATO_MANZ = CODIGO_ESTRATO;
KEEP CODIGO_LOCALIDAD CODIGO_BARRIO CODIGO_MANZANA CODIGO_ESTRATO_MANZ; RUN;


PROC SORT DATA = TEMP1_BASE_CALCULOS; BY CODIGO_LOCALIDAD CODIGO_BARRIO CODIGO_MANZANA;
PROC SORT DATA = MODA_ESTRATO_MANZANA; BY CODIGO_LOCALIDAD CODIGO_BARRIO CODIGO_MANZANA;

DATA TEMP1_BASE_CALCULOS; MERGE TEMP1_BASE_CALCULOS (IN = A1) MODA_ESTRATO_MANZANA (IN = A2); 
BY CODIGO_LOCALIDAD CODIGO_BARRIO CODIGO_MANZANA; IF A1; RUN;

/***********************************************************************/
/*Pega la moda del estrato a nivel de BARRIO*/
/***********************************************************************/

DATA MODA_ESTRATO_BARRIO; SET PRUEBA.MODA_ESTRATO_BARRIO;
CODIGO_ESTRATO_BARRIO = CODIGO_ESTRATO;
KEEP CODIGO_LOCALIDAD CODIGO_BARRIO CODIGO_ESTRATO_BARRIO; RUN;

PROC SORT DATA=MODA_ESTRATO_BARRIO; BY CODIGO_LOCALIDAD CODIGO_BARRIO;

DATA TEMP1_BASE_CALCULOS; MERGE TEMP1_BASE_CALCULOS (IN = A1) MODA_ESTRATO_BARRIO (IN = A2); 
BY CODIGO_LOCALIDAD CODIGO_BARRIO; IF A1; RUN;

/***********************************************************************/
/*Pega la moda del estrato a nivel de LOCALIDAD*/
/***********************************************************************/

DATA MODA_ESTRATO_LOCALIDAD; SET PRUEBA.MODA_ESTRATO_LOCALIDAD;
CODIGO_ESTRATO_LOCAL = CODIGO_ESTRATO;
KEEP CODIGO_LOCALIDAD CODIGO_ESTRATO_LOCAL; RUN;

PROC SORT DATA = MODA_ESTRATO_LOCALIDAD; BY CODIGO_LOCALIDAD;

DATA TEMP1_BASE_CALCULOS; MERGE TEMP1_BASE_CALCULOS (IN = A1) MODA_ESTRATO_LOCALIDAD (IN = A2); 
BY CODIGO_LOCALIDAD; IF A1; 
COD_ESTR_ORIG = CODIGO_ESTRATO;
RUN;


DATA TEMP1_BASE_CALCULOS; 
SET TEMP1_BASE_CALCULOS; /*Imputación del estrato*/

IF ((CODIGO_USO IN ('001','002','009','019','037','038')) OR
(CODIGO_USO IN ('020','022') AND CLASE_PREDIO ='P')) AND COD_ESTR_ORIG IN (.,0) THEN 
 CODIGO_ESTRATO = CODIGO_ESTRATO_MANZ; ELSE CODIGO_ESTRATO = COD_ESTR_ORIG; 

IF ((CODIGO_USO IN ('001','002','009','019','037','038')) OR
(CODIGO_USO IN ('020','022') AND CLASE_PREDIO ='P')) AND COD_ESTR_ORIG IN (.,0) AND CODIGO_ESTRATO_MANZ IN (.,0)
       THEN CODIGO_ESTRATO = CODIGO_ESTRATO_BARRIO; else CODIGO_ESTRATO = CODIGO_ESTRATO;

IF ((CODIGO_USO IN ('001','002','009','019','037','038')) OR
(CODIGO_USO IN ('020','022') AND CLASE_PREDIO ='P')) AND COD_ESTR_ORIG IN (.,0) AND CODIGO_ESTRATO_MANZ IN (.,0) AND CODIGO_ESTRATO_BARRIO IN (.,0)
       THEN CODIGO_ESTRATO = CODIGO_ESTRATO_LOCAL; ELSE CODIGO_ESTRATO = CODIGO_ESTRATO;

LLAVE = COMPRESS(CODIGO_BARRIO||CODIGO_MANZANA||CODIGO_PREDIO||CODIGO_CONSTRUCCION||CODIGO_RESTO);
LOTE_ID = COMPRESS(CODIGO_BARRIO||"0"||CODIGO_MANZANA||"0"||CODIGO_PREDIO);
RUN;



/************************************************************************************************************/
/****************** EMPIEZA LA RUTINA PARA ARMAR LA BASE CREANDO TODAS LAS VARIABLES DUMMY ******************/
/************************************************************************************************************/

/************************************************************************************************************/
/* CREACIÓN DE VARIABLES DUMMY PARA LOS USOS */
/************************************************************************************************************/

PROC SQL; 	CREATE TABLE PREDIO_VISTA_PRODUCCION AS /* CREACIÓN DE VARIABLES DUMMY PARA LOS USOS */
		SELECT *, 
CASE WHEN CODIGO_USO = '001' THEN 1 ELSE 0 END AS D_USO_001,
CASE WHEN CODIGO_USO = '002' THEN 1 ELSE 0 END AS D_USO_002,
CASE WHEN CODIGO_USO = '003' THEN 1 ELSE 0 END AS D_USO_003,
CASE WHEN CODIGO_USO = '004' THEN 1 ELSE 0 END AS D_USO_004,
CASE WHEN CODIGO_USO = '005' THEN 1 ELSE 0 END AS D_USO_005,
CASE WHEN CODIGO_USO = '006' THEN 1 ELSE 0 END AS D_USO_006,
CASE WHEN CODIGO_USO = '007' THEN 1 ELSE 0 END AS D_USO_007,
CASE WHEN CODIGO_USO = '008' THEN 1 ELSE 0 END AS D_USO_008,
CASE WHEN CODIGO_USO = '009' THEN 1 ELSE 0 END AS D_USO_009,
CASE WHEN CODIGO_USO = '010' THEN 1 ELSE 0 END AS D_USO_010,
CASE WHEN CODIGO_USO = '011' THEN 1 ELSE 0 END AS D_USO_011,
CASE WHEN CODIGO_USO = '012' THEN 1 ELSE 0 END AS D_USO_012,
CASE WHEN CODIGO_USO = '013' THEN 1 ELSE 0 END AS D_USO_013,
CASE WHEN CODIGO_USO = '014' THEN 1 ELSE 0 END AS D_USO_014,
CASE WHEN CODIGO_USO = '015' THEN 1 ELSE 0 END AS D_USO_015,
CASE WHEN CODIGO_USO = '016' THEN 1 ELSE 0 END AS D_USO_016,
CASE WHEN CODIGO_USO = '017' THEN 1 ELSE 0 END AS D_USO_017,
CASE WHEN CODIGO_USO = '018' THEN 1 ELSE 0 END AS D_USO_018,
CASE WHEN CODIGO_USO = '019' THEN 1 ELSE 0 END AS D_USO_019,
CASE WHEN CODIGO_USO = '020' THEN 1 ELSE 0 END AS D_USO_020,
CASE WHEN CODIGO_USO = '021' THEN 1 ELSE 0 END AS D_USO_021,
CASE WHEN CODIGO_USO = '022' THEN 1 ELSE 0 END AS D_USO_022,
CASE WHEN CODIGO_USO = '023' THEN 1 ELSE 0 END AS D_USO_023,
CASE WHEN CODIGO_USO = '024' THEN 1 ELSE 0 END AS D_USO_024,
CASE WHEN CODIGO_USO = '025' THEN 1 ELSE 0 END AS D_USO_025,
CASE WHEN CODIGO_USO = '026' THEN 1 ELSE 0 END AS D_USO_026,
CASE WHEN CODIGO_USO = '027' THEN 1 ELSE 0 END AS D_USO_027,
CASE WHEN CODIGO_USO = '028' THEN 1 ELSE 0 END AS D_USO_028,
CASE WHEN CODIGO_USO = '029' THEN 1 ELSE 0 END AS D_USO_029,
CASE WHEN CODIGO_USO = '030' THEN 1 ELSE 0 END AS D_USO_030,
CASE WHEN CODIGO_USO = '031' THEN 1 ELSE 0 END AS D_USO_031,
CASE WHEN CODIGO_USO = '032' THEN 1 ELSE 0 END AS D_USO_032,
CASE WHEN CODIGO_USO = '033' THEN 1 ELSE 0 END AS D_USO_033,
CASE WHEN CODIGO_USO = '034' THEN 1 ELSE 0 END AS D_USO_034,
CASE WHEN CODIGO_USO = '035' THEN 1 ELSE 0 END AS D_USO_035,
CASE WHEN CODIGO_USO = '036' THEN 1 ELSE 0 END AS D_USO_036,
CASE WHEN CODIGO_USO = '037' THEN 1 ELSE 0 END AS D_USO_037,
CASE WHEN CODIGO_USO = '038' THEN 1 ELSE 0 END AS D_USO_038,
CASE WHEN CODIGO_USO = '039' THEN 1 ELSE 0 END AS D_USO_039,
CASE WHEN CODIGO_USO = '040' THEN 1 ELSE 0 END AS D_USO_040,
CASE WHEN CODIGO_USO = '041' THEN 1 ELSE 0 END AS D_USO_041,
CASE WHEN CODIGO_USO = '042' THEN 1 ELSE 0 END AS D_USO_042,
CASE WHEN CODIGO_USO = '043' THEN 1 ELSE 0 END AS D_USO_043,
CASE WHEN CODIGO_USO = '044' THEN 1 ELSE 0 END AS D_USO_044,
CASE WHEN CODIGO_USO = '045' THEN 1 ELSE 0 END AS D_USO_045,
CASE WHEN CODIGO_USO = '046' THEN 1 ELSE 0 END AS D_USO_046,
CASE WHEN CODIGO_USO = '047' THEN 1 ELSE 0 END AS D_USO_047,
CASE WHEN CODIGO_USO = '048' THEN 1 ELSE 0 END AS D_USO_048,
CASE WHEN CODIGO_USO = '049' THEN 1 ELSE 0 END AS D_USO_049,
CASE WHEN CODIGO_USO = '050' THEN 1 ELSE 0 END AS D_USO_050,
CASE WHEN CODIGO_USO = '051' THEN 1 ELSE 0 END AS D_USO_051,
CASE WHEN CODIGO_USO = '052' THEN 1 ELSE 0 END AS D_USO_052,
CASE WHEN CODIGO_USO = '053' THEN 1 ELSE 0 END AS D_USO_053,
CASE WHEN CODIGO_USO = '055' THEN 1 ELSE 0 END AS D_USO_055,
CASE WHEN CODIGO_USO = '056' THEN 1 ELSE 0 END AS D_USO_056,
CASE WHEN CODIGO_USO = '058' THEN 1 ELSE 0 END AS D_USO_058,
CASE WHEN CODIGO_USO = '059' THEN 1 ELSE 0 END AS D_USO_059,
CASE WHEN CODIGO_USO = '060' THEN 1 ELSE 0 END AS D_USO_060,
CASE WHEN CODIGO_USO = '062' THEN 1 ELSE 0 END AS D_USO_062,
CASE WHEN CODIGO_USO = '064' THEN 1 ELSE 0 END AS D_USO_064,
CASE WHEN CODIGO_USO = '065' THEN 1 ELSE 0 END AS D_USO_065,
CASE WHEN CODIGO_USO = '066' THEN 1 ELSE 0 END AS D_USO_066,
CASE WHEN CODIGO_USO = '067' THEN 1 ELSE 0 END AS D_USO_067,
CASE WHEN CODIGO_USO = '070' THEN 1 ELSE 0 END AS D_USO_070,
CASE WHEN CODIGO_USO = '071' THEN 1 ELSE 0 END AS D_USO_071,
CASE WHEN CODIGO_USO = '072' THEN 1 ELSE 0 END AS D_USO_072,
CASE WHEN CODIGO_USO = '073' THEN 1 ELSE 0 END AS D_USO_073,
CASE WHEN CODIGO_USO = '074' THEN 1 ELSE 0 END AS D_USO_074,
CASE WHEN CODIGO_USO = '075' THEN 1 ELSE 0 END AS D_USO_075,
CASE WHEN CODIGO_USO = '076' THEN 1 ELSE 0 END AS D_USO_076,
CASE WHEN CODIGO_USO = '077' THEN 1 ELSE 0 END AS D_USO_077,
CASE WHEN CODIGO_USO = '080' THEN 1 ELSE 0 END AS D_USO_080,
CASE WHEN CODIGO_USO = '081' THEN 1 ELSE 0 END AS D_USO_081,
CASE WHEN CODIGO_USO = '082' THEN 1 ELSE 0 END AS D_USO_082,
CASE WHEN CODIGO_USO = '090' THEN 1 ELSE 0 END AS D_USO_090,
CASE WHEN CODIGO_USO = '091' THEN 1 ELSE 0 END AS D_USO_091,
CASE WHEN CODIGO_USO = '092' THEN 1 ELSE 0 END AS D_USO_092,
CASE WHEN CODIGO_USO = '093' THEN 1 ELSE 0 END AS D_USO_093,
CASE WHEN CODIGO_USO = '094' THEN 1 ELSE 0 END AS D_USO_094,
CASE WHEN CODIGO_USO = '095' THEN 1 ELSE 0 END AS D_USO_095,
CASE WHEN CODIGO_USO = '096' THEN 1 ELSE 0 END AS D_USO_096,
CASE WHEN CODIGO_USO = '097' THEN 1 ELSE 0 END AS D_USO_097,
CASE WHEN CODIGO_USO = '098' THEN 1 ELSE 0 END AS D_USO_098
FROM TEMP1_BASE_CALCULOS
ORDER BY CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO, CODIGO_CONSTRUCCION, CODIGO_RESTO, CODIGO_USO, UNIDAD_CALIFICADA;
QUIT;


PROC SQL; 	CREATE TABLE USO_T AS		
SELECT 		CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO, CODIGO_CONSTRUCCION, CODIGO_RESTO,
MAX(D_USO_001) AS USO_001,	MAX(D_USO_002) AS USO_002,	MAX(D_USO_003) AS USO_003,
MAX(D_USO_004) AS USO_004,	MAX(D_USO_005) AS USO_005,	MAX(D_USO_006) AS USO_006,
MAX(D_USO_007) AS USO_007,	MAX(D_USO_008) AS USO_008,	MAX(D_USO_009) AS USO_009,
MAX(D_USO_010) AS USO_010,	MAX(D_USO_011) AS USO_011,	MAX(D_USO_012) AS USO_012,
MAX(D_USO_013) AS USO_013,	MAX(D_USO_014) AS USO_014,	MAX(D_USO_015) AS USO_015,
MAX(D_USO_016) AS USO_016,	MAX(D_USO_017) AS USO_017,	MAX(D_USO_018) AS USO_018,
MAX(D_USO_019) AS USO_019,	MAX(D_USO_020) AS USO_020,	MAX(D_USO_021) AS USO_021,
MAX(D_USO_022) AS USO_022,	MAX(D_USO_023) AS USO_023,	MAX(D_USO_024) AS USO_024,
MAX(D_USO_025) AS USO_025,	MAX(D_USO_026) AS USO_026,	MAX(D_USO_027) AS USO_027,
MAX(D_USO_028) AS USO_028,	MAX(D_USO_029) AS USO_029,	MAX(D_USO_030) AS USO_030,
MAX(D_USO_031) AS USO_031,	MAX(D_USO_032) AS USO_032,	MAX(D_USO_033) AS USO_033,
MAX(D_USO_034) AS USO_034,	MAX(D_USO_035) AS USO_035,	MAX(D_USO_036) AS USO_036,
MAX(D_USO_037) AS USO_037,	MAX(D_USO_038) AS USO_038,	MAX(D_USO_039) AS USO_039,
MAX(D_USO_040) AS USO_040,	MAX(D_USO_041) AS USO_041,	MAX(D_USO_042) AS USO_042,
MAX(D_USO_043) AS USO_043,	MAX(D_USO_044) AS USO_044,	MAX(D_USO_045) AS USO_045,
MAX(D_USO_046) AS USO_046,	MAX(D_USO_047) AS USO_047,	MAX(D_USO_048) AS USO_048,
MAX(D_USO_049) AS USO_049,	MAX(D_USO_050) AS USO_050,	MAX(D_USO_051) AS USO_051,
MAX(D_USO_052) AS USO_052,	MAX(D_USO_053) AS USO_053,	MAX(D_USO_055) AS USO_055,
MAX(D_USO_056) AS USO_056,	MAX(D_USO_058) AS USO_058,	MAX(D_USO_059) AS USO_059, 
MAX(D_USO_060) AS USO_060,  MAX(D_USO_062) AS USO_062,	MAX(D_USO_064) AS USO_064,	
MAX(D_USO_065) AS USO_065,	MAX(D_USO_066) AS USO_066,	MAX(D_USO_067) AS USO_067,	
MAX(D_USO_070) AS USO_070,  MAX(D_USO_071) AS USO_071,	MAX(D_USO_072) AS USO_072,	
MAX(D_USO_073) AS USO_073,  MAX(D_USO_074) AS USO_074,	MAX(D_USO_075) AS USO_075,	
MAX(D_USO_076) AS USO_076,  MAX(D_USO_077) AS USO_077,  MAX(D_USO_080) AS USO_080,	
MAX(D_USO_081) AS USO_081,  MAX(D_USO_082) AS USO_082,	MAX(D_USO_090) AS USO_090,	
MAX(D_USO_091) AS USO_091,  MAX(D_USO_092) AS USO_092,	MAX(D_USO_093) AS USO_093,	
MAX(D_USO_094) AS USO_094,  MAX(D_USO_095) AS USO_095,	MAX(D_USO_096) AS USO_096,	
MAX(D_USO_097) AS USO_097,  MAX(D_USO_098) AS USO_098
				FROM PREDIO_VISTA_PRODUCCION 
				GROUP BY 	CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO, CODIGO_CONSTRUCCION, CODIGO_RESTO/* &
                    A.CODIGO_USO = B.CODIGO_USO*/;
QUIT;

DATA PREDIO_VISTA_PRODUCCION; SET PREDIO_VISTA_PRODUCCION;
DROP 
D_USO_001	D_USO_002	D_USO_003	D_USO_004	D_USO_005	D_USO_006	D_USO_007	D_USO_008	D_USO_009	D_USO_010
D_USO_011	D_USO_012	D_USO_013	D_USO_014	D_USO_015	D_USO_016	D_USO_017	D_USO_018	D_USO_019	D_USO_020
D_USO_021	D_USO_022	D_USO_023	D_USO_024	D_USO_025	D_USO_026	D_USO_027	D_USO_028	D_USO_029	D_USO_030
D_USO_031	D_USO_032	D_USO_033	D_USO_034	D_USO_035	D_USO_036	D_USO_037	D_USO_038	D_USO_039	D_USO_040
D_USO_041	D_USO_042	D_USO_043	D_USO_044	D_USO_045	D_USO_046	D_USO_047	D_USO_048	D_USO_049	D_USO_050
D_USO_051	D_USO_052	D_USO_053	D_USO_055	D_USO_056	D_USO_058	D_USO_059	D_USO_060	D_USO_062	D_USO_064
D_USO_065	D_USO_066	D_USO_067	D_USO_070	D_USO_071	D_USO_072	D_USO_073	D_USO_074	D_USO_075	D_USO_076
D_USO_077	D_USO_080	D_USO_081	D_USO_082	D_USO_090	D_USO_091	D_USO_092	D_USO_093	D_USO_094	D_USO_095
D_USO_096	D_USO_097	D_USO_098;
RUN;

/************************************************************************************************************/
/* A LA BASE PREDIO_VISTA_PRODUCCION SE LE PEGAN LAS VARIABLES DUMMY DE TODOS LOS USOS */
/************************************************************************************************************/

PROC SQL; 	CREATE TABLE PREDIO_VISTA_PRODUC_USOP_A AS	/* A LA BASE PREDIO_VISTA_PRODUCCION SE LE PEGAN LAS VARIABLES DUMMY DE TODOS LOS USOS */
		SELECT A.*, B.*
				FROM PREDIO_VISTA_PRODUCCION AS A LEFT JOIN USO_T AS B
				ON	A.CODIGO_BARRIO = B.CODIGO_BARRIO &
					A.CODIGO_MANZANA = B.CODIGO_MANZANA &
					A.CODIGO_PREDIO = B.CODIGO_PREDIO &
					A.CODIGO_CONSTRUCCION = B.CODIGO_CONSTRUCCION &
					A.CODIGO_RESTO = B.CODIGO_RESTO;
QUIT;


/*--------------------------------------------------------------------------------------------------------------------------
AQUI EMPIEZA LA CONSTRUCCION PARA OBTENER LA INFO A NIVEL PREDIO
--------------------------------------------------------------------------------------------------------------------------*/

%USOP(PREDIO_VISTA_PRODUC_USOP_A, PREDIO_VISTA_PRODUC_USOP_A, PRUEBA.PREDIO_VISTA_PRODUC_USOP, CODIGO_USOP);


/************************************************************************************************************/
/* CREACIÓN DE VARIABLES DE URBANO Y RURAL, MEJORA Y LOTES. */
/* PEGADO DE LA MARCA MANZANA, LAS ZHF DE LAS DOS VIGENCIAS Y LA VARIABLE DE LOTES_CIEGOS */
/************************************************************************************************************/

DATA TIPO_CARACTERIZACION_MANZ; set ODBCLIB.TIPO_CARACTERIZACION_MANZ; /* MARCA MANZANA */
MANMANZ_ID = CAT(CODIGO_BARRIO, 0, CODIGO_MANZANA);
MARCA_MANZANA = TIPO_RES_ASOC;
IF VIGENCIA = &VIGENCIA.;
RUN; 

PROC SORT  DATA = TIPO_CARACTERIZACION_MANZ NODUPKEY;  
BY  CODIGO_BARRIO CODIGO_MANZANA; RUN;

PROC SQL; 	CREATE TABLE PRUEBA.RES_FORM_PRED_SIIC AS /* Informacion de ZHF de vigencia en curso*/
		SELECT CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO, VIGENCIA_RESOLUCION, CODIGO_ZONA_FISICA
			FROM ODBCLIB.RESOLUCION_PREDIO_DIG
			WHERE VIGENCIA_RESOLUCION = &VIGENCIA.
			ORDER BY CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO;
QUIT;

PROC SORT 	DATA=PRUEBA.RES_FORM_PRED_SIIC NODUPKEY; BY CODIGO_BARRIO CODIGO_MANZANA CODIGO_PREDIO; RUN;


PROC SQL; 	CREATE TABLE PRUEBA.RES_FORM_PRED_SIIC_2020 AS  
		SELECT CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO, VIGENCIA_RESOLUCION, CODIGO_ZONA_FISICA
			FROM ODBCLIB.RESOLUCION_PREDIO_DIG_2020
			WHERE VIGENCIA_RESOLUCION = 2020
			ORDER BY CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO;
QUIT;

PROC SORT 	DATA=PRUEBA.RES_FORM_PRED_SIIC_2020 NODUPKEY; BY CODIGO_BARRIO CODIGO_MANZANA CODIGO_PREDIO; RUN;


PROC SQL;  	CREATE TABLE PRUEBA.PREDIO_VISTA_USOP_MZ_ZHF AS  
		SELECT A.*, 
		SUBSTR(A.CODIGO_BARRIO, 1, 1) AS ID_UR_RU,
		CASE WHEN (SUBSTR(A.CODIGO_BARRIO, 1, 1) = "0") THEN 1 ELSE 0 END  AS PRED_URB,
		CASE WHEN (SUBSTR(A.CODIGO_BARRIO, 1, 1) NE "0") THEN 1 ELSE 0 END  AS PRED_RUR,
		CASE WHEN ((A.CODIGO_USO IN (' ','090')) OR (A.AREA_CONSTRUIDA IN (0,.))) THEN 1 ELSE 0 END AS LOTE,
		CASE WHEN ((A.AREA_CONSTRUIDA > 0 AND A.AREA_TERRENO = 0) OR (A.CODIGO_CONSTRUCCION NE '000' AND A.CODIGO_RESTO = '00000')) THEN 1 ELSE 0 END AS MEJORA,
		B.CODIGO_ZONA_FISICA AS ZHF_&VIGENCIA.,
		B.CODIGO_ZONA_FISICA AS ZHF, SUBSTR(B.CODIGO_ZONA_FISICA,12,1) AS ZHF12,		
		SUBSTR(B.CODIGO_ZONA_FISICA,13,1) AS ZHF13, C.CODIGO_ZONA_FISICA AS ZHF_2020,
		D.MARCA_MANZANA
			FROM PRUEBA.PREDIO_VISTA_PRODUC_USOP AS A
 			LEFT JOIN PRUEBA.RES_FORM_PRED_SIIC AS B
				ON	A.CODIGO_BARRIO = B.CODIGO_BARRIO &
					A.CODIGO_MANZANA = B.CODIGO_MANZANA &
					A.CODIGO_PREDIO = B.CODIGO_PREDIO
			LEFT JOIN PRUEBA.RES_FORM_PRED_SIIC_2020 AS C
				ON A.CODIGO_BARRIO = C.CODIGO_BARRIO &
				   A.CODIGO_MANZANA = C.CODIGO_MANZANA &
				   A.CODIGO_PREDIO = C.CODIGO_PREDIO
			LEFT JOIN TIPO_CARACTERIZACION_MANZ AS D
				ON	CAT(A.CODIGO_BARRIO, 0, A.CODIGO_MANZANA) = D.MANMANZ_ID
			LEFT JOIN (SELECT DISTINCT * FROM COMUN.LOTES_CIEGOS_BANDERA_180305) AS E
				ON A.LOTE_ID = E.LOTE_ID
			ORDER BY A.CODIGO_BARRIO, A.CODIGO_MANZANA, A.CODIGO_PREDIO, CODIGO_CONSTRUCCION, CODIGO_RESTO,
			CODIGO_USO, UNIDAD_CALIFICADA;
QUIT;


/************************************************************************************************************/
/* SE CREA UNA BASE A NIVEL DE PREDIO, POR USO PREDOMINANTE */
/************************************************************************************************************/

DATA PREDIO_VISTA_PRODUC_USOP3; SET PRUEBA.PREDIO_VISTA_USOP_MZ_ZHF; IF CODIGO_USOP = CODIGO_USO; RUN;

	
PROC SORT DATA=PREDIO_VISTA_PRODUC_USOP3 OUT = PRUEBA.PREDIO_VISTA_PRODUC_USOP4  NODUPKEY;
BY CODIGO_BARRIO CODIGO_MANZANA CODIGO_PREDIO CODIGO_CONSTRUCCION CODIGO_RESTO; RUN;



/********************************************************************************************/
/* REGLAS DE LIQUIDACIÓN A NIVEL DE PREDIO */
/*********************************************************************************************/


PROC SQL; CREATE TABLE PREDIOS_MODELO AS	/* REGLAS DE LIQUIDACIÓN A NIVEL DE PREDIO */
		SELECT *,
	
CASE
WHEN ((CODIGO_USO IN (' ','090') AND CLASE_PREDIO ='P') OR (AREA_CONSTRUIDA IN (0,.) AND CLASE_PREDIO ='P')) THEN 'LOTES_PH'
WHEN ((CODIGO_USO IN (' ') AND CLASE_PREDIO ='N') OR (AREA_CONSTRUIDA IN (0,.) AND CLASE_PREDIO ='N')) THEN 'LOTES_NPH'
WHEN ((AREA_CONSTRUIDA / AREA_TERRENO) < 0.3 & CLASE_PREDIO = 'N' & AREA_TERRENO > 0) THEN 'LOTES_30'
				
/*WHEN (CONSERVACION_HISTORICA  NE ('N') & CLASE_PREDIO = 'N' & CODIGO_USO IN ('001','002','009','019','020','022')) THEN 'AVESP_BIC'
WHEN (CONSERVACION_HISTORICA  NE ('N') & CODIGO_USO IN ('003','004','005','006','007','008','010','011','012','013','014','015',
'016','017','018','021','023','024','025','026','029','030','031','032','033','055','056','058',
'062','064','065','066','067','070','071','072','073','074','075','076','077','080','094','096') ) THEN 'AVESP_BIC' */

WHEN (CONSERVACION_HISTORICA  NE ('N') & CLASE_PREDIO = 'N' ) THEN 'AV_ESP_BIC'


/*WHEN ( LLAVE IN(
'005624010700000000','005624010800000000','005624010900000000','005624011000000000','005624011100000000',
'005624011200000000','005624011300000009','005624012300000000','005624012400000000','005624012500000000',
'005624012600000000','005624012700000000','005624012800000000','005624012900000000','005624013000000000',
'005624013100000000','005624013200000000','005624013300000000','005624013400000000','005624013500000000',
'005624013600000000','005624013700000000','005624013800000000','005624014000000000','005624014100000000',
'005624014200000000','005624014300000000','005624014600000000','005672010100000000','005672010200000000',
'005673010100000000','002511801100000000'))THEN 'PRED_CESP'   mismos del CIB2018 son los entregados el 180302*/


/*1.1 Modelos PH*/
WHEN (CODIGO_USO IN ('037','038') & CODIGO_ESTRATO IN (1) ) THEN 'M01_1' /*Residencial PH, estrato 1*/
WHEN (CODIGO_USO IN ('037','038') & CODIGO_ESTRATO IN (2) ) THEN 'M01_2' /*Residencial PH, estrato 2*/
WHEN (CODIGO_USO IN ('037','038') & CODIGO_ESTRATO IN (3) ) THEN 'M01_3' /*Residencial PH, estrato 3*/
WHEN (CODIGO_USO IN ('037','038') & CODIGO_ESTRATO IN (4) ) THEN 'M02_4' /*Residencial PH, estrato 4*/
WHEN (CODIGO_USO IN ('037','038') & CODIGO_ESTRATO IN (5) ) THEN 'M02_5' /*Residencial PH, estrato 5*/
WHEN (CODIGO_USO IN ('037','038') & CODIGO_ESTRATO IN (6) ) THEN 'M02_6' /*Residencial PH, estrato 6*/
WHEN (CODIGO_USO IN ('035', '036','043','044','045','046','059','081', '082','092') ) THEN 'M03' /*Oficinas PH*/
WHEN (CODIGO_USO IN ('039','040','060')) THEN 'M04' /*Comercio PH*/
WHEN (CODIGO_USO IN ('028','034','053','091','093','097')) THEN 'M05' /*Bodegas + Industria PH*/
WHEN (CODIGO_USO IN ('001','002','009','019','020','022') & CODIGO_ESTRATO IN (1) & CLASE_PREDIO = 'P')  THEN 'M06_1' /*Bifamiliar estrato 1*/
WHEN (CODIGO_USO IN ('001','002','009','019','020','022') & CODIGO_ESTRATO IN (2) & CLASE_PREDIO = 'P')  THEN 'M06_2' /*Bifamiliar estrato 2*/
WHEN (CODIGO_USO IN ('001','002','009','019','020','022') & CODIGO_ESTRATO IN (3) & CLASE_PREDIO = 'P')  THEN 'M06_3' /*Bifamiliar estrato 3*/
WHEN (CODIGO_USO IN ('001','002','009','019','020','022') & CODIGO_ESTRATO IN (4) & CLASE_PREDIO = 'P')  THEN 'M06_4' /*Bifamiliar estrato 4*/
WHEN (CODIGO_USO IN ('001','002','009','019','020','022') & CODIGO_ESTRATO IN (5) & CLASE_PREDIO = 'P')  THEN 'M06_5' /*Bifamiliar estrato 5*/
WHEN (CODIGO_USO IN ('001','002','009','019','020','022') & CODIGO_ESTRATO IN (6) & CLASE_PREDIO = 'P')  THEN 'M06_6' /*Bifamiliar estrato 6*/

/*Tablas de Valor NPH*/

WHEN (NUM_USOS = 1 & NUMERO_UNIDADES = 1 & CODIGO_USO IN ('001','002','009') & CLASE_PREDIO = 'N' & ARMAZON_ESTRUCTURA = '111' & MUROS_ESTRUCTURA = '121' ) THEN 'T24' /*Construcciones en material de desecho*/
WHEN (NUM_USOS = 1 & NUMERO_UNIDADES = 1 & CODIGO_USO IN ('001','002','009') & CLASE_PREDIO = 'N' & ARMAZON_ESTRUCTURA = '112' & MUROS_ESTRUCTURA = '124' ) THEN 'T25' /*Construcciones en Prefabricado*/


/*T01 Residencial */ 
WHEN (NUM_USOS = 1 & NUMERO_UNIDADES = 1 & CODIGO_USO IN ('001','002','009') & CLASE_PREDIO = 'N') THEN 'T01' /*Residencial*/
WHEN (NUM_USOS = 1 & NUMERO_UNIDADES = 1 & CODIGO_USO IN ('012') & AREA_CONSTRUIDA <= 350 & MAX_NUM_PISO <= 5) THEN 'T01' /*Residencial*/
WHEN (NUM_USOS = 1 & NUMERO_UNIDADES = 1 & CODIGO_USO IN ('020') & CLASE_PREDIO = 'N' & CLASE_CONSTRUCCION = "R") THEN 'T01' /*Residencial*/
WHEN (NUM_USOS = 2 & NUMERO_UNIDADES = 2 & CODIGO_USO IN ('001','002') & (USO_003 + USO_004 + USO_009 + USO_012 + USO_014 + USO_020 +
USO_022 + USO_026 + USO_056 + USO_058 + USO_080) > 0 & CLASE_PREDIO = 'N' ) THEN 'T01' /*Residencial*/
WHEN ( NUM_USOS = 2 & NUMERO_UNIDADES = 2 &  CODIGO_USO IN ('009') & (USO_001 + USO_002 + USO_003 + USO_004 + USO_012 + USO_014 +
USO_020 + USO_022 + USO_026 + USO_056 + USO_058 + USO_080) > 0 & CLASE_PREDIO = 'N') THEN 'T01' /*Residencial*/
WHEN ( NUM_USOS = 3 & NUMERO_UNIDADES = 3 & CODIGO_USO IN ('001','002') & (USO_003 > 0 & USO_022 > 0 ) & CLASE_PREDIO = 'N' ) THEN 'T01' /*Residencial*/
WHEN ( NUM_USOS = 3 & NUMERO_UNIDADES = 3 & CODIGO_USO IN ('001','002') & (USO_004 > 0 & USO_022 > 0 ) & CLASE_PREDIO = 'N' ) THEN 'T01' /*Residencial*/
WHEN ( NUM_USOS = 3 & NUMERO_UNIDADES = 3 & CODIGO_USO IN ('001','002') & (USO_004 > 0 & USO_020 > 0 ) & CLASE_PREDIO = 'N' ) THEN 'T01' /*Residencial*/
WHEN ( NUM_USOS = 3 & NUMERO_UNIDADES = 3 & CODIGO_USO IN ('001','002') & (USO_004 > 0 & USO_009 > 0 ) & CLASE_PREDIO = 'N' ) THEN 'T01' /*Residencial*/
WHEN ( NUM_USOS = 2 & NUMERO_UNIDADES = 2 &  CODIGO_USO IN ('012') & (USO_001 + USO_002 + USO_003 + USO_004 + USO_009 +
USO_020 + USO_022 + USO_056) > 0 & AREA_CONSTRUIDA <= 350 & MAX_NUM_PISO <= 5) THEN 'T01' /*Residencial*/
WHEN ( NUM_USOS = 2 & NUMERO_UNIDADES = 2 &  CODIGO_USO IN ('020') & (USO_001 + USO_002 + USO_003 + USO_004 + USO_009 +
USO_012 + USO_022 + USO_056) > 0 & CLASE_CONSTRUCCION = 'R' & CLASE_PREDIO = 'N') THEN 'T01' /*Residencial*/

/*T01 Residencial  - uso complementario*/
WHEN ( NUM_USOS = 2 & NUMERO_UNIDADES = 2 & CODIGO_USO IN ('003','004','012','058') & (USO_001 > 0 | USO_002 > 0 )) THEN 'T01' /*Residencial*/
WHEN ( NUM_USOS = 2 & NUMERO_UNIDADES = 2 & CODIGO_USO IN ('020') & (USO_001 > 0 | USO_002 > 0 ) & CLASE_PREDIO = 'N' ) THEN 'T01' /*Residencial*/
WHEN ( NUM_USOS = 2 & NUMERO_UNIDADES = 2 & CODIGO_USO IN ('020') & (USO_002 > 0) & CLASE_PREDIO = 'N' ) THEN 'T01' /*Residencial*/
WHEN ( NUM_USOS = 2 & NUMERO_UNIDADES = 2 & CODIGO_USO IN ('020') & (USO_001 > 0) & CLASE_PREDIO = 'N' ) THEN 'T01' /*Residencial*/
WHEN ( NUM_USOS = 3 & NUMERO_UNIDADES = 3 & CODIGO_USO IN ('003') & (USO_001 > 0 & USO_022 > 0 )) THEN 'T01' /*Residencial - uso complementario*/
WHEN ( NUM_USOS = 3 & NUMERO_UNIDADES = 3 & CODIGO_USO IN ('020') & (USO_001 > 0 & USO_022 > 0 ) & CLASE_PREDIO = 'N' ) THEN 'T01' /*Residencial*/
WHEN ( NUM_USOS = 3 & NUMERO_UNIDADES = 3 & CODIGO_USO IN ('012') & (USO_001 > 0 & USO_003 > 0 )) THEN 'T01' /*Residencial*/
WHEN ( NUM_USOS = 3 & NUMERO_UNIDADES = 3 & CODIGO_USO IN ('012') & (USO_001 > 0 & USO_004 > 0 )) THEN 'T01' /*Residencial*/
WHEN ( NUM_USOS = 3 & NUMERO_UNIDADES = 3 & CODIGO_USO IN ('012') & (USO_001 > 0 & USO_009 > 0 )) THEN 'T01' /*Residencial*/
WHEN ( NUM_USOS = 3 & NUMERO_UNIDADES = 3 & CODIGO_USO IN ('012') & (USO_001 > 0 & USO_020 > 0 )) THEN 'T01' /*Residencial*/
WHEN ( NUM_USOS = 3 & NUMERO_UNIDADES = 3 & CODIGO_USO IN ('012') & (USO_001 > 0 & USO_022 > 0 )) THEN 'T01' /*Residencial*/

/*WHEN ( NUM_USOS = 3 & NUMERO_UNIDADES = 3 & CODIGO_USO IN ('022') & (USO_001 > 0 & USO_004 > 0 ) & CLASE_PREDIO = 'N' ) THEN 'T01' Residencial*/

/*T02 Adecuación Comercial*/
WHEN (NUM_USOS = 1 & NUMERO_UNIDADES = 1 & CODIGO_USO IN ('003', '004', '056')) THEN 'T02' /*Adecuación Comercial*/
WHEN (NUM_USOS = 2 & NUMERO_UNIDADES = 2 & CODIGO_USO IN ('003', '004', '056') &(USO_009 + USO_020 + USO_022)> 0 ) THEN 'T02' /*Adecuación Comercial*/
WHEN (NUM_USOS = 3 & NUMERO_UNIDADES = 3 & CODIGO_USO IN ('004') & (USO_001 > 0 & USO_022 > 0 )) THEN 'T02' /*Adecuación Comercial*/

/*T03 Bodegas e Industria*/
WHEN (NUM_USOS = 1 & NUMERO_UNIDADES = 1 & CODIGO_USO IN ('010', '011', '025', '080')) THEN 'T03' /*Bodegas e Industria*/
WHEN (NUM_USOS = 2 & NUMERO_UNIDADES = 2 & CODIGO_USO IN ('010', '011') & 
(USO_001 + USO_002 + USO_003 + USO_004 + USO_009 + USO_012 +  USO_022 + USO_080 + USO_056) > 0) THEN 'T03' /*Bodegas e Industria*/
/*WHEN (NUM_USOS = 2 & NUMERO_UNIDADES = 2 & CODIGO_USO IN ('011') & 
(USO_001 + USO_002 + USO_003 + USO_004 + USO_009 + USO_012 + USO_022 + USO_080 + USO_056) > 0) THEN 'T03' Bodegas e Industria*/
WHEN (NUM_USOS = 2 & NUMERO_UNIDADES = 2 & CODIGO_USO IN ('025') & 
(USO_001 + USO_002 + USO_003 + USO_004 + USO_009 + USO_012 + USO_020 + USO_022 + USO_080 + USO_056) > 0) THEN 'T03' /*Bodegas e Industria*/
WHEN (NUM_USOS = 3 & NUMERO_UNIDADES = 3 & CODIGO_USO IN ('010','011','025') & (USO_022 > 0 & USO_080 > 0 )) THEN 'T03' /*Bodegas e Industria*/
WHEN (NUM_USOS = 3 & NUMERO_UNIDADES = 3 & CODIGO_USO IN ('010','011','025') & (USO_004 > 0 & USO_080 > 0 )) THEN 'T03' /*Bodegas e Industria*/

/*T04 Bodega Económica */
WHEN (NUM_USOS = 1 & NUMERO_UNIDADES = 1 & CODIGO_USO IN ('033')) THEN 'T04' /*Bodega Económica*/
/*WHEN (NUM_USOS = 2 & NUMERO_UNIDADES = 2 & CODIGO_USO IN ('033') &(USO_020+USO_080)> 0) THEN 'T04' Bodega Económica*/

/*T05 Oficinas*/
WHEN (CLASE_CONSTRUCCION = "C" & NUM_USOS = 1 & NUMERO_UNIDADES = 1 & CODIGO_USO IN ('020')& CLASE_PREDIO = 'N') THEN 'T05' /*Oficinas*/
WHEN (CLASE_CONSTRUCCION = "C" & NUM_USOS = 1 & NUMERO_UNIDADES = 1 & CODIGO_USO IN ('015', '018', '029', '030', '058', '065', '067')) THEN 'T05' /*Oficinas*/
WHEN (CLASE_CONSTRUCCION = "C" & NUM_USOS = 2 & NUMERO_UNIDADES = 2 & 
CODIGO_USO IN ('020') & (USO_003 + USO_004 + USO_009 + USO_012 + USO_022 + USO_056)> 0 & CLASE_PREDIO = 'N') THEN 'T05' /*Oficinas*/

/*T06 Institucional*/
WHEN (((AREA_CONSTRUIDA < 350 & MAX_NUM_PISO <= 5) | (AREA_CONSTRUIDA > 350)) & 
 NUM_USOS = 1 & NUMERO_UNIDADES = 1 & CODIGO_USO IN ('012')) THEN 'T06' /*Institucional*/
WHEN (((AREA_CONSTRUIDA < 350 & MAX_NUM_PISO <= 5) | (AREA_CONSTRUIDA > 350)) & 
 NUM_USOS = 2 & NUMERO_UNIDADES = 2 & CODIGO_USO IN ('012') & (USO_003 + USO_004 + USO_009 + USO_020 + USO_022 + USO_056)> 0) THEN 'T06' /*Institucional*/

/*T07 Depósitos*/
WHEN (NUM_USOS = 1 & NUMERO_UNIDADES = 1 & CODIGO_USO IN ('022') & CLASE_PREDIO = 'N') THEN 'T07' /*Depósitos*/
WHEN (NUM_USOS = 2 & NUMERO_UNIDADES = 2 & CODIGO_USO IN ('022') & 
(USO_003 + USO_004 + USO_009 + USO_020 + USO_056) > 0 & CLASE_PREDIO = 'N') THEN 'T07' /*Depósitos*/

/*T08 Colegios y Universidades 1-3 pisos*/
WHEN (NUM_USOS = 1 & NUMERO_UNIDADES = 1 & CODIGO_USO IN ('013')) THEN 'T08' /*Colegios y Universidades 1-3 pisos*/

/*T09 Clínicas y Hospitales*/
WHEN (NUM_USOS = 1 & NUMERO_UNIDADES = 1 & CODIGO_USO IN ('017')) THEN 'T09' /*Clínicas y Hospitales*/

/*T10 Aulas de Clase*/
WHEN (NUM_USOS = 1 & NUMERO_UNIDADES = 1 & CODIGO_USO IN ('064')) THEN 'T10' /*Aulas de Clase*/

/*T11 Hoteles*/
WHEN (NUM_USOS = 1 & NUMERO_UNIDADES = 1 & CODIGO_USO IN ('021')) THEN 'T11' /*Hoteles*/

/*T12 Edificio de Parqueo*/
WHEN (NUM_USOS = 1 & NUMERO_UNIDADES = 1 & CODIGO_USO IN ('024')) THEN 'T12' /*Edificio de Parqueo*/

/*T13 Parqueadero NPH*/
WHEN (NUM_USOS = 1 & NUMERO_UNIDADES = 1 & CODIGO_USO IN ('096')) THEN 'T13' /*Parqueadero NPH*/

/*T14 Oficinas Operativas*/
WHEN (NUM_USOS = 1 & NUMERO_UNIDADES = 1 & CODIGO_USO IN ('005')) THEN 'T14' /*Oficinas Operativas*/

/*T15 Enramadas*/
WHEN (NUM_USOS = 1 & NUMERO_UNIDADES = 1 & CODIGO_USO IN ('070')) THEN 'T15' /*Enramadas*/

/*T16 Anexos constructivos*/
WHEN (NUM_USOS = 1 & NUMERO_UNIDADES = 1 & CODIGO_USO IN ('071','072','073','076','077')) THEN 'T16' /*Anexos constructivos*/

/*T17 Piscinas*/
WHEN (NUM_USOS = 1 & NUMERO_UNIDADES = 1 & CODIGO_USO IN ('031')) THEN 'T17' /*Piscinas*/

/*T18 Coliseos*/
WHEN (NUM_USOS = 1 & NUMERO_UNIDADES = 1 & CODIGO_USO IN ('032')) THEN 'T18' /*Coliseos*/

/*T19 Bodegas con Adecuación Comercial*/
WHEN (NUM_USOS = 1 & NUMERO_UNIDADES = 1 & CODIGO_USO IN ('008', '014', '023')) THEN 'T19' /*Bodegas con Adecuación Comercial*/
WHEN (NUM_USOS = 2 & NUMERO_UNIDADES = 2 & CODIGO_USO IN ('008', '023') &
 (USO_001 + USO_002 + USO_003 + USO_004 + USO_009 + USO_012 + USO_020 + USO_022 + USO_080 + USO_056)> 0) THEN 'T19' /*Bodegas con Adecuación Comercial*/
WHEN (NUM_USOS = 3 & NUMERO_UNIDADES = 3 & CODIGO_USO IN ('008') & (USO_022 > 0 & USO_080 > 0 )) THEN 'T19' /*Bodegas con Adecuación Comercial*/
WHEN (NUM_USOS = 3 & NUMERO_UNIDADES = 3 & CODIGO_USO IN ('008') & (USO_004 > 0 & USO_080 > 0 )) THEN 'T19' /*Bodegas con Adecuación Comercial*/

/*T20 Moteles, amoblados, residencias*/
WHEN (NUM_USOS = 1 & NUMERO_UNIDADES = 1 & CODIGO_USO IN ('026')) THEN 'T20' /*Moteles, amoblados, residencias*/

/*T26 Colegios y Universidades 4 o mas pisos*/
WHEN (NUM_USOS = 1 & NUMERO_UNIDADES = 1 & CODIGO_USO IN ('016')) THEN 'T26' /*Colegios y Universidades 4 o mas pisos*/


WHEN (NUM_USOS = 1 & NUMERO_UNIDADES = 1 & CODIGO_USO IN ('047', '055', '057', '062', '066', '074', '075', '098')) THEN 'AV_ESP_USO' 
WHEN (NUM_USOS = 1 & NUMERO_UNIDADES = 1 & CODIGO_USO IN ('006','007','041','042','094','095')) THEN 'AV_ESP_CC' 

/*1.2 Tablas de Valor PH*/

WHEN (NUM_USOS = 1 & NUMERO_UNIDADES = 1 & CODIGO_USO IN ('048') ) THEN 'T21' /*Parqueo libre  PH */
WHEN (NUM_USOS = 2 & NUMERO_UNIDADES = 2 & CODIGO_USO IN ('048') & (USO_049)> 0) THEN 'T21' 
WHEN (NUM_USOS = 1 & NUMERO_UNIDADES = 1 & CODIGO_USO IN ('049') ) THEN 'T22' /*Parqueo libre  PH  último cambio*/
WHEN (NUM_USOS = 2 & NUMERO_UNIDADES = 2 & CODIGO_USO IN ('049') & (USO_048)> 0) THEN 'T22' 

/*WHEN (CODIGO_USO IN ('048') & NUMERO_UNIDADES = 1 & NUM_USOS = 1  ) THEN 'T21' /*Parqueo libre  PH */
/*WHEN (CODIGO_USO IN ('048') & NUMERO_UNIDADES = 2 & NUM_USOS = 2 & USO_049 > 0 ) THEN 'T21' /*Parqueo libre  PH */
/*WHEN (CODIGO_USO IN ('048') & NUMERO_UNIDADES = 2 & NUM_USOS = 1  ) THEN 'T21' /*Parqueo libre  PH  último cambio*/
/*WHEN (CODIGO_USO IN ('049') & NUMERO_UNIDADES = 2 & NUM_USOS = 1  ) THEN 'T22' /*Parqueo libre  PH  último cambio*/

/*WHEN (CODIGO_USO IN ('049') & NUMERO_UNIDADES = 2 & NUM_USOS = 2 & USO_051 > 0  ) THEN 'T22' /*Parqueo libre  PH  último cambio*/

/*WHEN (CODIGO_USO IN ('049') & NUMERO_UNIDADES = 1 & NUM_USOS = 1 ) THEN 'T22' /*Parqueo cubierto PH */
/*WHEN (CODIGO_USO IN ('049') & NUMERO_UNIDADES = 2 & NUM_USOS = 2 & USO_048 > 0) THEN 'T22' /*Parqueo cubierto PH */



WHEN (CODIGO_USO IN ('050') & NUMERO_UNIDADES = 1 & NUM_USOS = 1 ) THEN 'T12' /* Edificio de parqueo PH */
WHEN (CODIGO_USO IN ('051') & NUMERO_UNIDADES = 1 & NUM_USOS = 1 ) THEN 'T23' /* Depósito (Lockers) PH */ 
WHEN (CODIGO_USO IN ('052') & NUMERO_UNIDADES = 1 & NUM_USOS = 1 ) THEN 'T17' /*Piscinas PH */
/*WHEN (CODIGO_USO IN ('082') & NUMERO_UNIDADES = 1 & NUM_USOS = 1 ) THEN 'T14' Oficinas operativas PH*/
WHEN (CODIGO_USO IN ('027') & NUMERO_UNIDADES = 1 & NUM_USOS = 1 ) THEN 'T20' /*Moteles, amoblados, residencias*/




ELSE 'USOS MULTIPLES'
		END AS MODELO_0,
1 AS UNIDCAL_PRED,
/*T01 Residencial  - uso complementario*/
CASE
WHEN ( NUM_USOS = 2 & NUMERO_UNIDADES = 2 & CODIGO_USO IN ('003','004','012','058') & (USO_001 > 0 | USO_002 > 0 )) THEN 1 /*Residencial*/
WHEN ( NUM_USOS = 2 & NUMERO_UNIDADES = 2 & CODIGO_USO IN ('020') & (USO_001 > 0 | USO_002 > 0 ) & CLASE_PREDIO = 'N' ) THEN 1 /*Residencial*/
WHEN ( NUM_USOS = 3 & NUMERO_UNIDADES = 3 & CODIGO_USO IN ('003') & (USO_001 > 0 & USO_022 > 0 )) THEN 1 /*Residencial - uso complementario*/
WHEN ( NUM_USOS = 3 & NUMERO_UNIDADES = 3 & CODIGO_USO IN ('020') & (USO_001 > 0 & USO_022 > 0 ) & CLASE_PREDIO = 'N' ) THEN 1 /*Residencial*/
/*WHEN ( NUM_USOS = 3 & NUMERO_UNIDADES = 3 & CODIGO_USO IN ('022') & (USO_001 > 0 & USO_004 > 0 ) & CLASE_PREDIO = 'N' ) THEN 1 Residencial*/

ELSE 0 END AS RES_NPH_CASODOS

			FROM PRUEBA.PREDIO_VISTA_PRODUC_USOP4
			ORDER BY CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO, CODIGO_CONSTRUCCION, CODIGO_RESTO, CODIGO_USO,
			UNIDAD_CALIFICADA;
QUIT;


/* *******************************************************************************************************/
/* SE ASIGNAN LOS MODELOS DE AVALÚOS ESPECIALES POR TOPES A NIVEL DE PREDIO */
/* *******************************************************************************************************/

DATA PREDIOS_MODELO_1; SET PREDIOS_MODELO;
IF MODELO_0 = 'T01' AND NUM_USOS = 1 & NUMERO_UNIDADES = 1 AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000000) THEN MODELO_0 = 'AV_ESP_TOP';
IF MODELO_0 = 'T02' AND NUM_USOS = 1 & NUMERO_UNIDADES = 1 AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000000) THEN MODELO_0 = 'AV_ESP_TOP';
IF MODELO_0 = 'T03' AND NUM_USOS = 1 & NUMERO_UNIDADES = 1 AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000000) THEN MODELO_0 = 'AV_ESP_TOP';
IF MODELO_0 = 'T04' AND NUM_USOS = 1 & NUMERO_UNIDADES = 1 AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000000) THEN MODELO_0 = 'AV_ESP_TOP';
IF MODELO_0 = 'T05' AND NUM_USOS = 1 & NUMERO_UNIDADES = 1 AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000000) THEN MODELO_0 = 'AV_ESP_TOP';
IF MODELO_0 = 'T06' AND NUM_USOS = 1 & NUMERO_UNIDADES = 1 AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 10000) THEN MODELO_0 = 'AV_ESP_TOP';
IF MODELO_0 = 'T07' AND NUM_USOS = 1 & NUMERO_UNIDADES = 1 AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 100000) THEN MODELO_0 = 'AV_ESP_TOP';
IF MODELO_0 = 'T08' AND NUM_USOS = 1 & NUMERO_UNIDADES = 1 AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 10000) THEN MODELO_0 = 'AV_ESP_TOP';
IF MODELO_0 = 'T09' AND NUM_USOS = 1 & NUMERO_UNIDADES = 1 AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000000) THEN MODELO_0 = 'AV_ESP_TOP';
IF MODELO_0 = 'T10' AND NUM_USOS = 1 & NUMERO_UNIDADES = 1 AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000000) THEN MODELO_0 = 'AV_ESP_TOP';
IF MODELO_0 = 'T11' AND NUM_USOS = 1 & NUMERO_UNIDADES = 1 AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 10000) THEN MODELO_0 = 'AV_ESP_TOP';
IF MODELO_0 = 'T12' AND NUM_USOS = 1 & NUMERO_UNIDADES = 1 AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000000) THEN MODELO_0 = 'AV_ESP_TOP';
IF MODELO_0 = 'T13' AND NUM_USOS = 1 & NUMERO_UNIDADES = 1 AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000000) THEN MODELO_0 = 'AV_ESP_TOP';
IF MODELO_0 = 'T14' AND NUM_USOS = 1 & NUMERO_UNIDADES = 1 AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 10000) THEN MODELO_0 = 'AV_ESP_TOP';
IF MODELO_0 = 'T15' AND NUM_USOS = 1 & NUMERO_UNIDADES = 1 AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000000) THEN MODELO_0 = 'AV_ESP_TOP';
IF MODELO_0 = 'T16' AND NUM_USOS = 1 & NUMERO_UNIDADES = 1 AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000000) THEN MODELO_0 = 'AV_ESP_TOP';
IF MODELO_0 = 'T17' AND NUM_USOS = 1 & NUMERO_UNIDADES = 1 AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 100000) THEN MODELO_0 = 'AV_ESP_TOP';
IF MODELO_0 = 'T18' AND NUM_USOS = 1 & NUMERO_UNIDADES = 1 AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000000) THEN MODELO_0 = 'AV_ESP_TOP';
IF MODELO_0 = 'T19' AND NUM_USOS = 1 & NUMERO_UNIDADES = 1 AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 100000) THEN MODELO_0 = 'AV_ESP_TOP';
IF MODELO_0 = 'T20' AND NUM_USOS = 1 & NUMERO_UNIDADES = 1 AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 5000) THEN MODELO_0 = 'AV_ESP_TOP';

IF MODELO_0 = 'T21' AND NUM_USOS = 1 & NUMERO_UNIDADES = 1 AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000) THEN MODELO_0 = 'AV_ESP_TOP';
IF MODELO_0 = 'T21' AND (NUM_USOS NE 1 OR NUMERO_UNIDADES NE 1) AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_CONSTRUIDA > 1000) THEN MODELO_0 = 'AV_ESP_TOP';

IF MODELO_0 = 'T22' AND NUM_USOS = 1 & NUMERO_UNIDADES = 1 AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000) THEN MODELO_0 = 'AV_ESP_TOP';
IF MODELO_0 = 'T22' AND (NUM_USOS NE 1 OR NUMERO_UNIDADES NE 1) AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_CONSTRUIDA > 1000) THEN MODELO_0 = 'AV_ESP_TOP';

IF MODELO_0 = 'T23' AND NUM_USOS = 1 & NUMERO_UNIDADES = 1 AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 100) THEN MODELO_0 = 'AV_ESP_TOP';
IF MODELO_0 = 'T24' AND NUM_USOS = 1 & NUMERO_UNIDADES = 1 AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 100000) THEN MODELO_0 = 'AV_ESP_TOP';
IF MODELO_0 = 'T25' AND NUM_USOS = 1 & NUMERO_UNIDADES = 1 AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 100000) THEN MODELO_0 = 'AV_ESP_TOP';
IF MODELO_0 = 'T26' AND NUM_USOS = 1 & NUMERO_UNIDADES = 1 AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 10000) THEN MODELO_0 = 'AV_ESP_TOP';

IF MODELO_0 = 'T01' AND (NUM_USOS NE 1 OR NUMERO_UNIDADES NE 1) AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000000) THEN MODELO_0 = 'USOS MULTIPLES';
IF MODELO_0 = 'T02' AND (NUM_USOS NE 1 OR NUMERO_UNIDADES NE 1) AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000000) THEN MODELO_0 = 'USOS MULTIPLES';
IF MODELO_0 = 'T03' AND (NUM_USOS NE 1 OR NUMERO_UNIDADES NE 1) AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000000) THEN MODELO_0 = 'USOS MULTIPLES';
IF MODELO_0 = 'T04' AND (NUM_USOS NE 1 OR NUMERO_UNIDADES NE 1) AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000000) THEN MODELO_0 = 'USOS MULTIPLES';
IF MODELO_0 = 'T05' AND (NUM_USOS NE 1 OR NUMERO_UNIDADES NE 1) AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000000) THEN MODELO_0 = 'USOS MULTIPLES';
IF MODELO_0 = 'T06' AND (NUM_USOS NE 1 OR NUMERO_UNIDADES NE 1) AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 10000) THEN MODELO_0 = 'USOS MULTIPLES';
IF MODELO_0 = 'T07' AND (NUM_USOS NE 1 OR NUMERO_UNIDADES NE 1) AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 100000) THEN MODELO_0 = 'USOS MULTIPLES';
IF MODELO_0 = 'T08' AND (NUM_USOS NE 1 OR NUMERO_UNIDADES NE 1) AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 10000) THEN MODELO_0 = 'USOS MULTIPLES';
IF MODELO_0 = 'T09' AND (NUM_USOS NE 1 OR NUMERO_UNIDADES NE 1) AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000000) THEN MODELO_0 = 'USOS MULTIPLES';
IF MODELO_0 = 'T10' AND (NUM_USOS NE 1 OR NUMERO_UNIDADES NE 1) AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000000) THEN MODELO_0 = 'USOS MULTIPLES';
IF MODELO_0 = 'T11' AND (NUM_USOS NE 1 OR NUMERO_UNIDADES NE 1) AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 10000) THEN MODELO_0 = 'USOS MULTIPLES';
IF MODELO_0 = 'T12' AND (NUM_USOS NE 1 OR NUMERO_UNIDADES NE 1) AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000000) THEN MODELO_0 = 'USOS MULTIPLES';
IF MODELO_0 = 'T13' AND (NUM_USOS NE 1 OR NUMERO_UNIDADES NE 1) AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000000) THEN MODELO_0 = 'USOS MULTIPLES';
IF MODELO_0 = 'T14' AND (NUM_USOS NE 1 OR NUMERO_UNIDADES NE 1) AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 10000) THEN MODELO_0 = 'USOS MULTIPLES';
IF MODELO_0 = 'T15' AND (NUM_USOS NE 1 OR NUMERO_UNIDADES NE 1) AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000000) THEN MODELO_0 = 'USOS MULTIPLES';
IF MODELO_0 = 'T16' AND (NUM_USOS NE 1 OR NUMERO_UNIDADES NE 1) AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000000) THEN MODELO_0 = 'USOS MULTIPLES';
IF MODELO_0 = 'T17' AND (NUM_USOS NE 1 OR NUMERO_UNIDADES NE 1) AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 100000) THEN MODELO_0 = 'USOS MULTIPLES';
IF MODELO_0 = 'T18' AND (NUM_USOS NE 1 OR NUMERO_UNIDADES NE 1) AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000000) THEN MODELO_0 = 'USOS MULTIPLES';
IF MODELO_0 = 'T19' AND (NUM_USOS NE 1 OR NUMERO_UNIDADES NE 1) AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 100000) THEN MODELO_0 = 'USOS MULTIPLES';
IF MODELO_0 = 'T20' AND (NUM_USOS NE 1 OR NUMERO_UNIDADES NE 1) AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 5000) THEN MODELO_0 = 'USOS MULTIPLES';
IF MODELO_0 = 'T21' AND (NUM_USOS NE 1 OR NUMERO_UNIDADES NE 1) AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000) THEN MODELO_0 = 'USOS MULTIPLES';
IF MODELO_0 = 'T22' AND (NUM_USOS NE 1 OR NUMERO_UNIDADES NE 1) AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000) THEN MODELO_0 = 'USOS MULTIPLES';
IF MODELO_0 = 'T23' AND (NUM_USOS NE 1 OR NUMERO_UNIDADES NE 1) AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 100) THEN MODELO_0 = 'USOS MULTIPLES';
IF MODELO_0 = 'T24' AND (NUM_USOS NE 1 OR NUMERO_UNIDADES NE 1) AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 100000) THEN MODELO_0 = 'USOS MULTIPLES';
IF MODELO_0 = 'T25' AND (NUM_USOS NE 1 OR NUMERO_UNIDADES NE 1) AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 100000) THEN MODELO_0 = 'USOS MULTIPLES';
IF MODELO_0 = 'T26' AND (NUM_USOS NE 1 OR NUMERO_UNIDADES NE 1) AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 10000) THEN MODELO_0 = 'USOS MULTIPLES';
RUN;

/* *******************************************************************************************************/
/*VISTA:  PEGADO IDENTIFICADOR UNIDAD CALIFICADA PREDOMINANTE*/
/* *******************************************************************************************************/

PROC SQL; CREATE TABLE VISTA_NUEVO_MODELO_A AS	 /*VISTA:  MODELO (Primera Asignación)*/
		SELECT A.*,  B.MODELO_0,  B.RES_NPH_CASODOS, 
		CASE WHEN (C.UNIDCAL_PRED=1) THEN 1 ELSE 0 END  AS UNIDCAL_PRED
				FROM PRUEBA.PREDIO_VISTA_USOP_MZ_ZHF AS A
 				LEFT JOIN PREDIOS_MODELO_1 AS B
				ON	A.CODIGO_BARRIO = B.CODIGO_BARRIO &
					A.CODIGO_MANZANA = B.CODIGO_MANZANA &
					A.CODIGO_PREDIO = B.CODIGO_PREDIO &
					A.CODIGO_CONSTRUCCION = B.CODIGO_CONSTRUCCION &
					A.CODIGO_RESTO = B.CODIGO_RESTO
				LEFT JOIN PREDIOS_MODELO_1 AS C 
					ON	A.CODIGO_BARRIO = C.CODIGO_BARRIO &
					A.CODIGO_MANZANA = C.CODIGO_MANZANA &
					A.CODIGO_PREDIO = C.CODIGO_PREDIO &
					A.CODIGO_CONSTRUCCION = C.CODIGO_CONSTRUCCION &
					A.CODIGO_RESTO = C.CODIGO_RESTO &
					A.CODIGO_USO = C.CODIGO_USO	&
					A.UNIDAD_CALIFICADA = C.UNIDAD_CALIFICADA &
					A.AREA_USO = C.AREA_USO &
					A.CLASE_CONSTRUCCION = C.CLASE_CONSTRUCCION &
					A.PUNTAJE = C.PUNTAJE &
                    A.RESTO_IRRADIADOR = C.RESTO_IRRADIADOR	 
WHERE	(A.MARCA_FORMACION IN ('A','B','C','D','E','F','G','N') | A.MARCA_FORMACION IS NULL) AND 	A.CODIGO_DESTINO NOT IN ('99');
QUIT;

/* *******************************************************************************************************
/* EN ESTA PARTE SE TRABAJAN LAS TABLAS DE MATERIALES DE DESECHO Y USOS COMPLEMENTARIOS. */
/* *******************************************************************************************************/


/* Se comentó el contenido del siguiente DATA - Set debido a que la definición de la T24 y T25 cambió*/
DATA MATERIAL_DESECHO1; SET VISTA_NUEVO_MODELO_A; /*T24 Construcciones en material de desecho O  T25 Construcciones en Prefabricado*/

/*IF (ARMAZON_ESTRUCTURA = '111' AND MUROS_ESTRUCTURA IN ('121')) OR (ARMAZON_ESTRUCTURA = '112' AND MUROS_ESTRUCTURA IN ('124')) ;*/
/*
IF RES_NPH_CASODOS=1 AND MODELO_0 IN ('T01') AND ARMAZON_ESTRUCTURA IN ('111') AND MUROS_ESTRUCTURA IN ('121') THEN MODELO_0='USOS MULTIPLES'; 
IF RES_NPH_CASODOS=1 AND MODELO_0 IN ('T01') AND ARMAZON_ESTRUCTURA IN ('112') AND MUROS_ESTRUCTURA IN ('124') THEN MODELO_0='USOS MULTIPLES'; 

IF (NUM_USOS = 1 & NUMERO_UNIDADES = 1 & ARMAZON_ESTRUCTURA IN ('111') AND MUROS_ESTRUCTURA IN ('121') 
AND MODELO_0 IN ('T01', 'T02', 'T03', 
'T04', 'T05', 'T06', 'T07', 'T08', 'T09', 'T10', 'T11', 'T12', 'T13', 'T14', 'T15', 'T16', 
'T17', 'T18', 'T19', 'T20', 'T21', 'T22', 'T23',  'T26')) THEN MODELO_0='T24'; 

IF (NUM_USOS = 1 & NUMERO_UNIDADES = 1 & ARMAZON_ESTRUCTURA IN ('112') AND MUROS_ESTRUCTURA IN ('124')
AND MODELO_0 IN ('T01', 'T02', 'T03', 'T04', 'T05', 'T06', 'T07', 'T08', 'T09', 'T10', 
'T11', 'T12', 'T13', 'T14', 'T15', 'T16', 'T17', 'T18', 'T19', 'T20', 'T21', 'T22', 
'T23', 'T26')) THEN MODELO_0='T25'; 

IF ((NUM_USOS NE 1 OR NUMERO_UNIDADES NE 1) AND RES_NPH_CASODOS NE 1 & ARMAZON_ESTRUCTURA IN ('111')  AND MUROS_ESTRUCTURA IN ('121') 
AND MODELO_0 IN ('T01', 'T02', 'T03', 
'T04', 'T05', 'T06', 'T07', 'T08', 'T09', 'T10', 'T11', 'T12', 'T13', 'T14', 'T15', 'T16', 
'T17', 'T18', 'T19', 'T20', 'T21', 'T22', 'T23', 'T26')) THEN MODELO_0='USOS MULTIPLES'; 

IF ((NUM_USOS NE 1 OR NUMERO_UNIDADES NE 1) AND RES_NPH_CASODOS NE 1  &  ARMAZON_ESTRUCTURA IN ('112') AND MUROS_ESTRUCTURA IN ('124')
AND MODELO_0 IN ('T01', 'T02', 'T03', 'T04', 'T05', 'T06', 'T07', 'T08', 'T09', 'T10', 
'T11', 'T12', 'T13', 'T14', 'T15', 'T16', 'T17', 'T18', 'T19', 'T20', 'T21', 'T22', 
'T23', 'T26')) THEN MODELO_0='USOS MULTIPLES'; 
*/
RUN;

DATA MATERIAL_DESECHO2; SET MATERIAL_DESECHO1;
/*
IF RES_NPH_CASODOS=1 AND MODELO_0='USOS MULTIPLES' THEN DESECHO_CASO2=1;
IF ((NUM_USOS NE 1 OR NUMERO_UNIDADES NE 1) AND RES_NPH_CASODOS NE 1  &  ARMAZON_ESTRUCTURA IN ('111') AND MUROS_ESTRUCTURA IN ('121') AND MODELO_0='USOS MULTIPLES') THEN USO_DESECHO =1; 
IF ((NUM_USOS NE 1 OR NUMERO_UNIDADES NE 1) AND RES_NPH_CASODOS NE 1  & ARMAZON_ESTRUCTURA IN ('112') AND MUROS_ESTRUCTURA IN ('124') AND MODELO_0='USOS MULTIPLES') THEN USO_DESECHO =1; 
/*KEEP CODIGO_BARRIO CODIGO_MANZANA CODIGO_PREDIO CODIGO_CONSTRUCCION CODIGO_RESTO LLAVE DESECHO_CASO2;*/
RUN;

/*
DATA MATERIAL_DESECHO3; SET MATERIAL_DESECHO2; 
IF DESECHO_CASO2=1 OR USO_DESECHO =1;
PREDIO_DESECHO=1;
KEEP CODIGO_BARRIO CODIGO_MANZANA CODIGO_PREDIO CODIGO_CONSTRUCCION CODIGO_RESTO LLAVE PREDIO_DESECHO;
RUN;

PROC SORT DATA=MATERIAL_DESECHO3 NODUPKEY;
BY CODIGO_BARRIO CODIGO_MANZANA CODIGO_PREDIO CODIGO_CONSTRUCCION CODIGO_RESTO; RUN;


PROC SQL; CREATE TABLE MATERIAL_DESECHO4 AS	 /*VISTA:  PEGADO IDENTIFICADOR PREDIO QUE TIENE UNIDAD CALIFICADA COMPLEMENTARIA*/
/*		SELECT A.*, 
CASE WHEN (B.PREDIO_DESECHO=1) THEN 1 ELSE 0 END  AS PREDIO_DESECHO

				FROM MATERIAL_DESECHO2 AS A LEFT JOIN MATERIAL_DESECHO3 AS B
				ON	A.LLAVE = B.LLAVE; /*IDENTIFICADOR PREDIO*/
*QUIT;


DATA MATERIAL_DESECHO; SET MATERIAL_DESECHO2;
*IF PREDIO_DESECHO = 1 THEN MODELO_0 = 'USOS MULTIPLES'; 
RUN;

 
/*SE PROGRAMAN LOS CASOS QUE SE LIQUIDAN POR LA UNIDAD DEL USO COMPLEMENTARIO*/
DATA VISTA_CASODOS; SET MATERIAL_DESECHO; /*SE PROGRAMAN LOS CASOS QUE SE LIQUIDAN POR LA UNIDAD DEL USO COMPLEMENTARIO*/
IF RES_NPH_CASODOS = 1 AND MODELO_0='T01'; RUN; 

PROC SQL; CREATE TABLE VISTA_CASODOS_A AS	/*MODELO (Asignación Caso Dos)*/
		SELECT *,
CASE
WHEN ( NUM_USOS = 2 & NUMERO_UNIDADES = 2 & CODIGO_USO IN ('003','004','012','058') & (USO_001 > 0)) THEN '001' /*Residencial*/
WHEN ( NUM_USOS = 2 & NUMERO_UNIDADES = 2 & CODIGO_USO IN ('003','004','012','058') & (USO_002 > 0 )) THEN '002' /*Residencial*/
WHEN ( NUM_USOS = 2 & NUMERO_UNIDADES = 2 & CODIGO_USO IN ('020'/*,'022'*/) & (USO_001 > 0 ) & CLASE_PREDIO = 'N' ) THEN '001' /*Residencial*/
WHEN ( NUM_USOS = 2 & NUMERO_UNIDADES = 2 & CODIGO_USO IN ('020'/*,'022'*/) & (USO_002 > 0 ) & CLASE_PREDIO = 'N' ) THEN '002' /*Residencial*/
WHEN ( NUM_USOS = 3 & NUMERO_UNIDADES = 3 & CODIGO_USO IN ('003'/*,'004'*/) & (USO_001 > 0 & USO_022 > 0 )) THEN '001' /*Residencial - uso complementario*/
WHEN ( NUM_USOS = 3 & NUMERO_UNIDADES = 3 & CODIGO_USO IN ('020') & (USO_001 > 0 & USO_022 > 0 ) & CLASE_PREDIO = 'N' ) THEN '001' /*Residencial*/
/*WHEN ( NUM_USOS = 3 & NUMERO_UNIDADES = 3 & CODIGO_USO IN ('022') & (USO_001 > 0 & USO_004 > 0 ) & CLASE_PREDIO = 'N' ) THEN '001' *//*Residencial*/
/*WHEN ( NUM_USOS = 3 & NUMERO_UNIDADES = 3 & CODIGO_USO IN ('022') & (USO_001 > 0 & USO_003 > 0 ) & CLASE_PREDIO = 'N' ) THEN '001' *//*Residencial*/
/*WHEN ( NUM_USOS = 3 & NUMERO_UNIDADES = 3 & CODIGO_USO IN ('022') & (USO_001 > 0 & USO_020 > 0 ) & CLASE_PREDIO = 'N' ) THEN '001' *//*Residencial*/
WHEN ( CODIGO_USO IN ('001')) THEN '001' /*Residencial*/
WHEN ( CODIGO_USO IN ('002')) THEN '002' /*Residencial*/
ELSE ' ' END AS CODIGO_USO_COMPL
			FROM VISTA_CASODOS
			ORDER BY CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO, CODIGO_CONSTRUCCION, CODIGO_RESTO, CODIGO_USO,
			UNIDAD_CALIFICADA;
QUIT;


/*VISTA_CODIGO_USO_COMPL*/
DATA VISTA_CASODOS_B; SET VISTA_CASODOS_A;  /*VISTA_CODIGO_USO_COMPL*/
IF CODIGO_USO = CODIGO_USO_COMPL; 
UNIDCAL_COMPL = 1;
KEEP CODIGO_BARRIO CODIGO_MANZANA CODIGO_PREDIO CODIGO_CONSTRUCCION CODIGO_RESTO CODIGO_USO UNIDAD_CALIFICADA AREA_USO CLASE_CONSTRUCCION PUNTAJE NUM_USOS CODIGO_USO CODIGO_USOP CODIGO_USO_COMPL UNIDCAL_COMPL llave;
RUN; 



PROC SORT DATA=VISTA_CASODOS_B; BY CODIGO_BARRIO CODIGO_MANZANA CODIGO_PREDIO CODIGO_CONSTRUCCION CODIGO_RESTO DESCENDING AREA_USO  UNIDAD_CALIFICADA DESCENDING CLASE_CONSTRUCCION DESCENDING PUNTAJE;
PROC SORT DATA=VISTA_CASODOS_B OUT = VISTA_UNIDAD_USO_COMPL  NODUPKEY;
BY CODIGO_BARRIO CODIGO_MANZANA CODIGO_PREDIO CODIGO_CONSTRUCCION CODIGO_RESTO; RUN;


PROC SQL; CREATE TABLE VISTA_NUEVO_MODELO_B AS	 /*VISTA:  PEGADO IDENTIFICADOR UNIDAD CALIFICADA COMPLEMENTARIA*/
		SELECT A.*, 
CASE WHEN (B.UNIDCAL_COMPL=1) THEN 1 ELSE 0 END  AS UNIDCAL_COMPL

				FROM MATERIAL_DESECHO AS A LEFT JOIN VISTA_UNIDAD_USO_COMPL AS B
				ON	A.CODIGO_BARRIO = B.CODIGO_BARRIO &
					A.CODIGO_MANZANA = B.CODIGO_MANZANA &
					A.CODIGO_PREDIO = B.CODIGO_PREDIO &
					A.CODIGO_CONSTRUCCION = B.CODIGO_CONSTRUCCION &
					A.CODIGO_RESTO = B.CODIGO_RESTO &
					A.CODIGO_USO = B.CODIGO_USO	&
					A.UNIDAD_CALIFICADA = B.UNIDAD_CALIFICADA &
					A.AREA_USO=B.AREA_USO &
					A.CLASE_CONSTRUCCION=B.CLASE_CONSTRUCCION ;
QUIT;

DATA VISTA_NUEVO_MODELO_B1; SET VISTA_NUEVO_MODELO_B;
IF UNIDCAL_COMPL=1 AND (CODIGO_USO IN ('001','002','009','019','020','022')  & CLASE_PREDIO = 'P' & CODIGO_ESTRATO IN (1,2,3))  THEN MODELO_0 ='M06_123'; 
IF UNIDCAL_COMPL=1 AND (CODIGO_USO IN ('001','002','009','019','020','022')  & CLASE_PREDIO = 'P' & CODIGO_ESTRATO IN (4,5,6))  THEN MODELO_0 ='M06_456';
RUN;

PROC SQL; CREATE TABLE VISTA_NUEVO_MODELO_C AS	 /*VISTA:  PEGADO IDENTIFICADOR PREDIO QUE TIENE UNIDAD CALIFICADA COMPLEMENTARIA*/
		SELECT A.*, 
CASE WHEN (B.UNIDCAL_COMPL=1) THEN 1 ELSE 0 END  AS PREDIO_UNIDCAL_COMPL

				FROM VISTA_NUEVO_MODELO_B1 AS A LEFT JOIN VISTA_UNIDAD_USO_COMPL AS B
				ON	A.LLAVE = B.LLAVE; /*IDENTIFICADOR PREDIO*/
QUIT;

/* *******************************************************************************************************
/* SE CREA LA BASE Y LA VARIABLE DE LA UNIDAD DE LIQUIDACIÓN (UNIDAD COMPLEMENTARIA EN CASOS PARTICULARES). */
/* *******************************************************************************************************/

DATA UNIDAD_LIQUIDACION; SET VISTA_NUEVO_MODELO_C ; /* SE CREA LA BASE Y LA VARIABLE DE LA UNIDAD DE LIQUIDACIÓN (UNIDAD COMPLEMENTARIA EN CASOS PARTICULARES). */
IF PREDIO_UNIDCAL_COMPL = 1 THEN UNIDAD_LIQUIDACION = UNIDCAL_COMPL;
ELSE UNIDAD_LIQUIDACION = UNIDCAL_PRED; 
RUN; 

/* *******************************************************************************************************
/* SE SELECCIONA PREDIOS CON USOS MÚLTIPLES. */
/* *******************************************************************************************************/

DATA VISTA_USOS_MULTIPLES; SET UNIDAD_LIQUIDACION; /* SE SELECCIONA PREDIOS CON USOS MÚLTIPLES */
IF MODELO_0 IN ('USOS MULTIPLES');
RUN; 

/* *******************************************************************************************************/
/*SE ASIGNA LA VARIABLE MODELO POR USO PARA LOS USOS MÚLTIPLES. */
/* *******************************************************************************************************/

PROC SQL; 	CREATE TABLE VISTA_USOS_MULTIPLES_1  /*SE ASIGNA LA TABLA POR USO*/
AS	SELECT *,
	
CASE 
WHEN (CODIGO_USO IN ('037','038') & CODIGO_ESTRATO IN (1) ) THEN 'M01_1' /*Residencial PH, estrato 1*/
WHEN (CODIGO_USO IN ('037','038') & CODIGO_ESTRATO IN (2) ) THEN 'M01_2' /*Residencial PH, estrato 2*/
WHEN (CODIGO_USO IN ('037','038') & CODIGO_ESTRATO IN (3) ) THEN 'M01_3' /*Residencial PH, estrato 3*/
WHEN (CODIGO_USO IN ('037','038') & CODIGO_ESTRATO IN (4) ) THEN 'M02_4' /*Residencial PH, estrato 4*/
WHEN (CODIGO_USO IN ('037','038') & CODIGO_ESTRATO IN (5) ) THEN 'M02_5' /*Residencial PH, estrato 5*/
WHEN (CODIGO_USO IN ('037','038') & CODIGO_ESTRATO IN (6) ) THEN 'M02_6' /*Residencial PH, estrato 6*/
WHEN (CODIGO_USO IN ('035','043','044','045','046','059','081','092') ) THEN 'M03' /*Oficinas PH*/
WHEN (CODIGO_USO IN ('039','040','060')) THEN 'M04' /*Comercio PH*/
WHEN (CODIGO_USO IN ('028','034','047','053','091','093','097')) THEN 'M05' /*Bodegas + Industria PH*/
WHEN (CODIGO_USO IN ('001','002','009','019','020','022') & CODIGO_ESTRATO IN (1) & CLASE_PREDIO = 'P')  THEN 'M06_1' /*Bifamiliar estrato 1*/
WHEN (CODIGO_USO IN ('001','002','009','019','020','022') & CODIGO_ESTRATO IN (2) & CLASE_PREDIO = 'P')  THEN 'M06_2' /*Bifamiliar estrato 2*/
WHEN (CODIGO_USO IN ('001','002','009','019','020','022') & CODIGO_ESTRATO IN (3) & CLASE_PREDIO = 'P')  THEN 'M06_3' /*Bifamiliar estrato 3*/
WHEN (CODIGO_USO IN ('001','002','009','019','020','022') & CODIGO_ESTRATO IN (4) & CLASE_PREDIO = 'P')  THEN 'M06_4' /*Bifamiliar estrato 4*/
WHEN (CODIGO_USO IN ('001','002','009','019','020','022') & CODIGO_ESTRATO IN (5) & CLASE_PREDIO = 'P')  THEN 'M06_5' /*Bifamiliar estrato 5*/
WHEN (CODIGO_USO IN ('001','002','009','019','020','022') & CODIGO_ESTRATO IN (6) & CLASE_PREDIO = 'P')  THEN 'M06_6' /*Bifamiliar estrato 6*/

/*Tablas de Valor NPH*/

WHEN (CODIGO_USO IN ('001','002','009') & CLASE_PREDIO = 'N' & ARMAZON_ESTRUCTURA = '111' & MUROS_ESTRUCTURA = '121' ) THEN 'T24' /*Construcciones en material de desecho*/
WHEN (CODIGO_USO IN ('001','002','009') & CLASE_PREDIO = 'N' & ARMAZON_ESTRUCTURA = '112' & MUROS_ESTRUCTURA = '124' ) THEN 'T25' /*Construcciones en Prefabricado*/

/*T01 Residencial */ 
WHEN (CODIGO_USO IN ('001','002','009') & CLASE_PREDIO = 'N') THEN 'T01' /*Residencial*/
WHEN (CODIGO_USO IN ('012') & AREA_USO <= 350 & MAX_NUM_PISO <= 5) THEN 'T01' /*Residencial*/
WHEN (CODIGO_USO IN ('020') & CLASE_PREDIO = 'N' & CLASE_CONSTRUCCION = "R") THEN 'T01' /*Residencial*/

/*T02 Adecuación Comercial*/
WHEN (CODIGO_USO IN ('003','004','056')) THEN 'T02' /*Adecuación Comercial*/

/*T03 Bodegas e Industria*/
WHEN (CODIGO_USO IN ('010','011','025','080')) THEN 'T03' /*Bodegas e Industria*/

/*T04 Bodega Económica */
WHEN (CODIGO_USO IN ('033')) THEN 'T04' /*Bodega Económica*/

/*T05 Oficinas*/
WHEN (CODIGO_USO IN ('020')& CLASE_PREDIO = 'N') THEN 'T05' /*Oficinas*/
WHEN (CODIGO_USO IN ('015','058')) THEN 'T05' /*Oficinas*/
WHEN (CLASE_CONSTRUCCION = "C" & CODIGO_USO IN ('020')& CLASE_PREDIO = 'N') THEN 'T05' /*Oficinas*/
WHEN (CLASE_CONSTRUCCION = "C" & CODIGO_USO IN ('015', '018', '029', '030', '058', '065', '067')) THEN 'T05' /*Oficinas*/


/*T06 Institucional*/
WHEN (((AREA_USO < 350 & MAX_NUM_PISO <= 5) | (AREA_USO > 350)) & 
  CODIGO_USO IN ('012')) THEN 'T06' /*Institucional*/

/*T07 Depósitos*/
WHEN (CODIGO_USO IN ('022')& CLASE_PREDIO = 'N') THEN 'T07' /*Depósitos*/

/*T08 Colegios y Universidades 1-3 pisos*/
WHEN (CODIGO_USO IN ('013')) THEN 'T08' /*Colegios y Universidades 1-3 pisos*/

/*T09 Clínicas y Hospitales*/
WHEN (CODIGO_USO IN ('017')) THEN 'T09' /*Clínicas y Hospitales*/

/*T10 Aulas de Clase*/
WHEN (CODIGO_USO IN ('064')) THEN 'T10' /*Aulas de Clase*/

/*T11 Hoteles*/
WHEN (CODIGO_USO IN ('021')) THEN 'T11' /*Hoteles*/

/*T12 Edificio de Parqueo*/
WHEN (CODIGO_USO IN ('024')) THEN 'T12' /*Edificio de Parqueo*/

/*T13 Parqueadero NPH*/
WHEN (CODIGO_USO IN ('096')) THEN 'T13' /*Parqueadero NPH*/

/*T14 Oficinas Operativas*/
WHEN (CODIGO_USO IN ('005')) THEN 'T14' /*Oficinas Operativas*/

/*T15 Enramadas*/
WHEN (CODIGO_USO IN ('070')) THEN 'T15' /*Enramadas*/

/*T16 Anexos constructivos*/
WHEN (CODIGO_USO IN ('071','072','073','076','077')) THEN 'T16' /*Anexos constructivos*/

/*T17 Piscinas*/
WHEN (CODIGO_USO IN ('031')) THEN 'T17' /*Piscinas*/

/*T18 Coliseos*/
WHEN (CODIGO_USO IN ('032')) THEN 'T18' /*Coliseos*/

/*T19 Bodegas con Adecuación Comercial*/
WHEN (CODIGO_USO IN ('008','014','023')) THEN 'T19' /*Bodegas con Adecuación Comercial*/

/*T20 Moteles, amoblados, residencias*/
WHEN (CODIGO_USO IN ('026')) THEN 'T20' /*Moteles, amoblados, residencias*/

/*T26 Colegios y Universidades 4 o mas pisos*/
WHEN (CODIGO_USO IN ('016')) THEN 'T26' /*Colegios y Universidades 4 o mas pisos*/

WHEN (CODIGO_USO IN ('047','055','057','062','066','074','075','098')) THEN 'AV_ESP_USO' 
WHEN (CODIGO_USO IN ('006','007','041','042','094','095')) THEN 'AV_ESP_CC' 


/*1.2 Tablas de Valor PH*/

WHEN (CODIGO_USO IN ('048') ) THEN 'T21' /*Parqueo libre  PH */
WHEN (CODIGO_USO IN ('049')) THEN 'T22' /*Parqueo cubierto PH */
WHEN (CODIGO_USO IN ('050')) THEN 'T12' /* Edificio de parqueo PH */
WHEN (CODIGO_USO IN ('051')) THEN 'T23' /* Depósito (Lockers) PH */ 
WHEN (CODIGO_USO IN ('052')) THEN 'T17' /*Piscinas PH */
WHEN (CODIGO_USO IN ('082')) THEN 'T14' /*Oficinas operativas PH*/
WHEN (CODIGO_USO IN ('027')) THEN 'T20' /*Moteles, amoblados, residencias*/



ELSE 'M0'
		END AS MODELO_USO1

			FROM VISTA_USOS_MULTIPLES
			ORDER BY CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO, CODIGO_CONSTRUCCION, CODIGO_RESTO, CODIGO_USO,UNIDAD_CALIFICADA;
QUIT;

/**************************************************************************************************************/
/* AVALÚOS ESPECIALES "AV_ESP_TOP" POR UNIDAD CALIFICADA */
/**************************************************************************************************************/

DATA VISTA_USOS_MULTIPLES_2; SET VISTA_USOS_MULTIPLES_1; /* AVALÚOS ESPECIALES "AV_ESP_TOP" POR UNIDAD CALIFICADA */
IF MODELO_USO1 = 'T01' AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000000) THEN MODELO_USO1 = 'AV_ESP_TOP';
IF MODELO_USO1 = 'T02' AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000000) THEN MODELO_USO1 = 'AV_ESP_TOP';
IF MODELO_USO1 = 'T03' AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000000) THEN MODELO_USO1 = 'AV_ESP_TOP';
IF MODELO_USO1 = 'T04' AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000000) THEN MODELO_USO1 = 'AV_ESP_TOP';
IF MODELO_USO1 = 'T05' AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000000) THEN MODELO_USO1 = 'AV_ESP_TOP';
IF MODELO_USO1 = 'T06' AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 10000) THEN MODELO_USO1 = 'AV_ESP_TOP';
IF MODELO_USO1 = 'T07' AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 100000) THEN MODELO_USO1 = 'AV_ESP_TOP';
IF MODELO_USO1 = 'T08' AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 10000) THEN MODELO_USO1 = 'AV_ESP_TOP';
IF MODELO_USO1 = 'T09' AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000000) THEN MODELO_USO1 = 'AV_ESP_TOP';
IF MODELO_USO1 = 'T10' AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000000) THEN MODELO_USO1 = 'AV_ESP_TOP';
IF MODELO_USO1 = 'T11' AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 10000) THEN MODELO_USO1 = 'AV_ESP_TOP';
IF MODELO_USO1 = 'T12' AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000000) THEN MODELO_USO1 = 'AV_ESP_TOP';
IF MODELO_USO1 = 'T13' AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000000) THEN MODELO_USO1 = 'AV_ESP_TOP';
IF MODELO_USO1 = 'T14' AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 10000) THEN MODELO_USO1 = 'AV_ESP_TOP';
IF MODELO_USO1 = 'T15' AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000000) THEN MODELO_USO1 = 'AV_ESP_TOP';
IF MODELO_USO1 = 'T16' AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000000) THEN MODELO_USO1 = 'AV_ESP_TOP';
IF MODELO_USO1 = 'T17' AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 100000) THEN MODELO_USO1 = 'AV_ESP_TOP';
IF MODELO_USO1 = 'T18' AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000000) THEN MODELO_USO1 = 'AV_ESP_TOP';
IF MODELO_USO1 = 'T19' AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 100000) THEN MODELO_USO1 = 'AV_ESP_TOP';
IF MODELO_USO1 = 'T20' AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 5000) THEN MODELO_USO1 = 'AV_ESP_TOP';
IF MODELO_USO1 = 'T21' AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000) THEN MODELO_USO1 = 'AV_ESP_TOP';
IF MODELO_USO1 = 'T22' AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 1000) THEN MODELO_USO1 = 'AV_ESP_TOP';
IF MODELO_USO1 = 'T23' AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 100) THEN MODELO_USO1 = 'AV_ESP_TOP';
IF MODELO_USO1 = 'T24' AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 100000) THEN MODELO_USO1 = 'AV_ESP_TOP';
IF MODELO_USO1 = 'T25' AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 100000) THEN MODELO_USO1 = 'AV_ESP_TOP';
IF MODELO_USO1 = 'T26' AND (EDAD > 100 OR PUNTAJE > 100 OR AREA_USO > 10000) THEN MODELO_USO1 = 'AV_ESP_TOP';
RUN;

/**************************************************************************************************************/
/*PREDIOS QUE LIQUITARON POR USO MULTIPLE COMBINADO CON MODELO */
/**************************************************************************************************************/

DATA M0; SET VISTA_USOS_MULTIPLES_2;  /*PREDIOS QUE LIQUITARON POR USO MULTIPLE COMBINADO CON MODELO */
IF MODELO_USO1 IN 
('M01_1','M01_2','M01_3','M02_4','M02_5','M02_6','M03','M04','M05','M06_1','M06_2','M06_3','M06_4','M06_5','M06_6');
MODELO_PH = 1;
KEEP CODIGO_BARRIO CODIGO_MANZANA CODIGO_PREDIO CODIGO_CONSTRUCCION CODIGO_RESTO MODELO_PH;
RUN;

PROC SORT DATA=M0 NODUPKEY; BY CODIGO_BARRIO CODIGO_MANZANA CODIGO_PREDIO CODIGO_CONSTRUCCION CODIGO_RESTO; RUN;

/**************************************************************************************************************/
/*PREDIOS QUE LIQUITARON POR USO MULTIPLE COMBINADO CON AVESP */
/**************************************************************************************************************/

DATA AV_ESP; SET VISTA_USOS_MULTIPLES_2; /*PREDIOS QUE LIQUITARON POR USO MULTIPLE COMBINADO CON AVESP */
IF MODELO_USO1 IN ('AV_ESP_USO','AV_ESP_CC','AV_ESP_TOP'); 
MODELO_AVES = 1;
KEEP CODIGO_BARRIO CODIGO_MANZANA CODIGO_PREDIO CODIGO_CONSTRUCCION CODIGO_RESTO MODELO_AVES; RUN;

PROC SORT DATA=AV_ESP NODUPKEY; BY CODIGO_BARRIO CODIGO_MANZANA CODIGO_PREDIO CODIGO_CONSTRUCCION CODIGO_RESTO; RUN;

/**************************************************************************************************************/
/* SE PEGAN A LA BASE DE USOS MÚLTIPLES LAS VARIABLES CORRESPONDIENTES A PREDIOS DE USOS MÚLTIPLES QUE SE MEZCLAN CON MODELOS Y AVALÚOS ESPECIALES */
/*AV_ESP_MUL - Combinacion Model-Tabla*/
/**************************************************************************************************************/

PROC SQL; 
CREATE TABLE VISTA_USOS_MULTIPLES_DEF AS /* SE PEGAN A LA BASE DE USOS MÚLTIPLES LAS VARIABLES CORRESPONDIENTES A PREDIOS DE USOS MÚLTIPLES QUE SE MEZCLAN CON MODELOS Y AVALÚOS ESPECIALES */	
SELECT A.*, B.MODELO_PH,
CASE 
WHEN (B.MODELO_PH = 1) THEN 'AV_ESP_MUL'  /*AV_ESP_MUL - Combinacion Model-Tabla*/
ELSE MODELO_USO1 END AS MODELO_USO2,
C.MODELO_AVES
FROM VISTA_USOS_MULTIPLES_2 AS A LEFT JOIN M0 AS B
				ON	A.CODIGO_BARRIO = B.CODIGO_BARRIO &
					A.CODIGO_MANZANA = B.CODIGO_MANZANA &
					A.CODIGO_PREDIO = B.CODIGO_PREDIO &
					A.CODIGO_CONSTRUCCION = B.CODIGO_CONSTRUCCION &
					A.CODIGO_RESTO = B.CODIGO_RESTO
LEFT JOIN AV_ESP AS C
				ON	A.CODIGO_BARRIO = C.CODIGO_BARRIO &
					A.CODIGO_MANZANA = C.CODIGO_MANZANA &
					A.CODIGO_PREDIO = C.CODIGO_PREDIO &
					A.CODIGO_CONSTRUCCION = C.CODIGO_CONSTRUCCION &
					A.CODIGO_RESTO = C.CODIGO_RESTO;
QUIT;

/**************************************************************************************************************/
/* SE PEGAN A LA BASE TOTAL DE PREDIOS LAS VARIABLES CORRESPONDIENTES A PREDIOS DE USOS MÚLTIPLES QUE SE MEZCLAN CON MODELOS Y AVALÚOS ESPECIALES */
/**************************************************************************************************************/

PROC SQL; 
CREATE TABLE VISTA_NUEVO_MODELO_D AS	 /* SE PEGAN A LA BASE TOTAL DE PREDIOS LAS VARIABLES CORRESPONDIENTES A PREDIOS DE USOS MÚLTIPLES QUE SE MEZCLAN CON MODELOS Y AVALÚOS ESPECIALES */
SELECT A.*,  B.MODELO_USO1 AS MODELO_USO_0,
B.MODELO_PH AS UM_MODELO_PH,
B.MODELO_AVES AS UM_MODELO_AVES, /*UM == USO MÚLTIPLE*/
CASE 
WHEN (B.MODELO_USO2 NE " ") THEN B.MODELO_USO2
ELSE A.MODELO_0
END AS MODELO_USO 
FROM UNIDAD_LIQUIDACION AS A 
LEFT JOIN VISTA_USOS_MULTIPLES_DEF AS B
				ON	A.CODIGO_BARRIO = B.CODIGO_BARRIO &
					A.CODIGO_MANZANA = B.CODIGO_MANZANA &
					A.CODIGO_PREDIO = B.CODIGO_PREDIO &
					A.CODIGO_CONSTRUCCION = B.CODIGO_CONSTRUCCION &
					A.CODIGO_RESTO = B.CODIGO_RESTO &
					A.CODIGO_USO = B.CODIGO_USO	&
					A.UNIDAD_CALIFICADA = B.UNIDAD_CALIFICADA &
					A.AREA_USO = B.AREA_USO &
					A.CLASE_CONSTRUCCION = B.CLASE_CONSTRUCCION ;
QUIT;


/**************************************************************************************************************/
/* SE CREA UNA VARIABLE AVESP_USOM CORRESPONDIENTE A LOS USOS CUYOS MODELOS SON "AV_ESP_MUL" Y "AV_ESP_USO" */
/**************************************************************************************************************/


DATA AVESP_USOM; SET VISTA_NUEVO_MODELO_D; /*PREDIOS QUE SE LIQUIDARON POR AVALUO ESPECIAL EN USO MULTIPLE --COMBINACIONES CON AVESP */
IF MODELO_USO IN ('AV_ESP_MUL', 'AV_ESP_USO'); 
IF MODELO_USO IN ('AV_ESP_MUL') THEN AVESP_USOM = 1;
IF MODELO_USO IN ('AV_ESP_USO') THEN AVESP_USOM = 2;
KEEP CODIGO_BARRIO CODIGO_MANZANA CODIGO_PREDIO CODIGO_CONSTRUCCION CODIGO_RESTO AVESP_USOM; 
RUN;

PROC SORT DATA = AVESP_USOM NODUPKEY; BY CODIGO_BARRIO CODIGO_MANZANA CODIGO_PREDIO CODIGO_CONSTRUCCION CODIGO_RESTO; RUN;

PROC SQL; CREATE TABLE VISTA_NUEVO_MODELO_E AS	
		SELECT A.*, 
CASE WHEN (B.AVESP_USOM = .) THEN 0 ELSE B.AVESP_USOM END AS AVESP_USOM,
A.MODELO_0 AS MODELO_OR, A.MODELO_USO AS MODELO_USO_OR,
/*CASE WHEN (AVESP_USOM = 1) THEN "AV_ESP_MUL" ELSE A.MODELO_0 END AS MODELO_0,*/
ROUND(A.AREA_TERRENO, .01) AS AREA_TERRENO
			FROM VISTA_NUEVO_MODELO_D AS A LEFT JOIN AVESP_USOM AS B
				ON	A.CODIGO_BARRIO = B.CODIGO_BARRIO &
					A.CODIGO_MANZANA = B.CODIGO_MANZANA &
					A.CODIGO_PREDIO = B.CODIGO_PREDIO &
					A.CODIGO_CONSTRUCCION = B.CODIGO_CONSTRUCCION &
					A.CODIGO_RESTO = B.CODIGO_RESTO;
QUIT;

DATA VISTA_NUEVO_MODELO_E;
SET VISTA_NUEVO_MODELO_E;
IF AVESP_USOM = 1 THEN MODELO_0 = 'AV_ESP_MUL';
RUN;


/**************************************************************************************************************/
/* EL SIGUIENTE BLOQUE NO SE BORRA PORQUE RAÚL TIENE MIEDO Y DUDAS EXISTENCIALES */
/**************************************************************************************************************/

/*
DATA VISTA_NUEVO_MODELO_E;SET VISTA_NUEVO_MODELO_E0;
MODELO_OR = MODELO_0;
MODELO_USO_OR = MODELO_USO;
IF AVESP_USOM = 1 THEN MODELO_0 = 'AV_ESP_MUL';*/
/*IF AVESP_USOM=2 THEN MODELO_0='AV_ESP_USO'; este lo modifico segun documento version 5*/
/*IF (MODELO_USO='T01' AND AREA_TERRENO <49 AND MARCA_MANZANA=3) THEN MARCA_MANZANA=4; esta condición se supone que ya la tienen en cuenta en la tabla no hay necesidad de programarla*/
/*IF (MODELO_USO='T06' AND AREA_USO <350) THEN MODELO_USO='T01';
IF (MODELO_USO ='T05' AND CLASE_CONSTRUCCION = 'R')  THEN MODELO_USO='T01';
IF  (MODELO_0 ='T05' AND CLASE_CONSTRUCCION = 'R')  THEN MODELO_0='T01';
IF (MODELO_0='T06' AND AREA_USO <350) THEN MODELO_0='T01'; /*SE CAMBIO PORQUE INDICARON QUE ERA EL AREA DEL USO PREDOMINNANTE*/
/*AREA_TERRENO = ROUND(AREA_TERRENO, .01);
RUN;*/

/**************************************************************************************************************/
/* ATIPICOS DE COMERCIO Y OFICINAS. */
/**************************************************************************************************************/

PROC SQL;CREATE TABLE VISTA_NUEVO_MODELO_E1 AS SELECT A.*,
CASE WHEN (B.ATIP_OF_COM=1) THEN 1 ELSE 0 END  AS ATIP_OFI_COM
				FROM VISTA_NUEVO_MODELO_E AS A LEFT JOIN COMUN.MARCO_ATIPICOS_OFIC_COMER AS B
				ON	A.CODIGO_BARRIO = B.CODIGO_BARRIO &
					A.CODIGO_MANZANA = B.CODIGO_MANZANA &
					A.CODIGO_PREDIO = B.CODIGO_PREDIO &
					A.CODIGO_CONSTRUCCION = B.CODIGO_CONSTRUCCION &
					A.CODIGO_RESTO = B.CODIGO_RESTO;
QUIT;

/**************************************************************************************************************/
/* ASIGNACIÓN DE MODELOS POR ESTRATOS Y TABLAS ESPECIFICAS POR ESTRATO Y MARCA MANZANA. */
/**************************************************************************************************************/

DATA VISTA_NUEVO_MODELO_F;SET VISTA_NUEVO_MODELO_E; /* ASIGNACIÓN DE MODELOS POR ESTRATOS Y TABLAS ESPECIFICAS POR ESTRATO Y MARCA MANZANA. */

IF MODELO_0 = 'T01' AND ZHF12 NE '1' AND MARCA_MANZANA = 1 THEN MODELO_0 = 'T01-1'; 
IF MODELO_0 = 'T01' AND ZHF12 NE '1' AND MARCA_MANZANA = 2 THEN MODELO_0 = 'T01-2'; 
IF MODELO_0 = 'T01' AND ZHF12 NE '1' AND MARCA_MANZANA = 3 THEN MODELO_0 = 'T01-3'; 
IF MODELO_0 = 'T01' AND ZHF12 NE '1' AND MARCA_MANZANA = 4 THEN MODELO_0 = 'T01-4'; 
IF MODELO_0 = 'T01' AND ZHF12 NE '1' AND MARCA_MANZANA = 5 THEN MODELO_0 = 'T01-5'; 
IF MODELO_0 = 'T01' AND ZHF12 NE '1' AND MARCA_MANZANA = 6 THEN MODELO_0 = 'T01-6';
IF MODELO_0 = 'T01' AND ZHF12 NE '1' AND MARCA_MANZANA = 7 THEN MODELO_0 = 'T01-7';
IF MODELO_0 = 'T01' AND ZHF12 NE '1' AND MARCA_MANZANA = 8 THEN MODELO_0 = 'T01-8';

IF MODELO_0 = 'T01' AND ZHF12 = '1'  AND ZHF13 = '1' THEN MODELO_0 = 'T01-1'; 
IF MODELO_0 = 'T01' AND ZHF12 = '1'  AND ZHF13 = '2' THEN MODELO_0 = 'T01-2'; 
IF MODELO_0 = 'T01' AND ZHF12 = '1'  AND ZHF13 = '3' THEN MODELO_0 = 'T01-3'; 
IF MODELO_0 = 'T01' AND ZHF12 = '1'  AND ZHF13 = '4' THEN MODELO_0 = 'T01-4'; 
IF MODELO_0 = 'T01' AND ZHF12 = '1'  AND ZHF13 = '5' THEN MODELO_0 = 'T01-5'; 
IF MODELO_0 = 'T01' AND ZHF12 = '1'  AND ZHF13 = '6' THEN MODELO_0 = 'T01-6';
IF MODELO_0 = 'T01' AND ZHF12 = '1'  AND ZHF13 = '7' THEN MODELO_0 = 'T01-7'; 
IF MODELO_0 = 'T01' AND ZHF12 = '1'  AND ZHF13 = '8' THEN MODELO_0 = 'T01-8';

IF MODELO_0 = 'T02' AND MARCA_MANZANA IN (1,2,3) THEN MODELO_0 = 'T02-1'; 
IF MODELO_0 = 'T02' AND MARCA_MANZANA IN (4,5,8) THEN MODELO_0 = 'T02-2';
IF MODELO_0 = 'T02' AND MARCA_MANZANA IN (6) THEN MODELO_0 = 'T02-3';
IF MODELO_0 = 'T02' AND MARCA_MANZANA IN (7) THEN MODELO_0 = 'T02-4';
IF MODELO_0 = 'T05' AND MARCA_MANZANA IN (1,2,3) THEN MODELO_0 = 'T05-1'; 
IF MODELO_0 = 'T05' AND MARCA_MANZANA IN (4,5,8) THEN MODELO_0 = 'T05-2';
IF MODELO_0 = 'T05' AND MARCA_MANZANA IN (6) THEN MODELO_0 = 'T05-3';
IF MODELO_0 = 'T05' AND MARCA_MANZANA IN (7) THEN MODELO_0 = 'T05-4';

IF MODELO_USO = 'T01' AND ZHF12 NE '1' AND MARCA_MANZANA = 1 THEN MODELO_USO = 'T01-1'; 
IF MODELO_USO = 'T01' AND ZHF12 NE '1' AND MARCA_MANZANA = 2 THEN MODELO_USO = 'T01-2'; 
IF MODELO_USO = 'T01' AND ZHF12 NE '1' AND MARCA_MANZANA = 3 THEN MODELO_USO = 'T01-3'; 
IF MODELO_USO = 'T01' AND ZHF12 NE '1' AND MARCA_MANZANA = 4 THEN MODELO_USO = 'T01-4'; 
IF MODELO_USO = 'T01' AND ZHF12 NE '1' AND MARCA_MANZANA = 5 THEN MODELO_USO = 'T01-5'; 
IF MODELO_USO = 'T01' AND ZHF12 NE '1' AND MARCA_MANZANA = 6 THEN MODELO_USO = 'T01-6';
IF MODELO_USO = 'T01' AND ZHF12 NE '1' AND MARCA_MANZANA = 7 THEN MODELO_USO = 'T01-7';
IF MODELO_USO = 'T01' AND ZHF12 NE '1' AND MARCA_MANZANA = 8 THEN MODELO_USO = 'T01-8';

IF MODELO_USO = 'T01' AND ZHF12 = '1'  AND ZHF13 = '1' THEN MODELO_USO = 'T01-1'; 
IF MODELO_USO = 'T01' AND ZHF12 = '1'  AND ZHF13 = '2' THEN MODELO_USO = 'T01-2'; 
IF MODELO_USO = 'T01' AND ZHF12 = '1'  AND ZHF13 = '3' THEN MODELO_USO = 'T01-3'; 
IF MODELO_USO = 'T01' AND ZHF12 = '1'  AND ZHF13 = '4' THEN MODELO_USO = 'T01-4'; 
IF MODELO_USO = 'T01' AND ZHF12 = '1'  AND ZHF13 = '5' THEN MODELO_USO = 'T01-5'; 
IF MODELO_USO = 'T01' AND ZHF12 = '1'  AND ZHF13 = '6' THEN MODELO_USO = 'T01-6';
IF MODELO_USO = 'T01' AND ZHF12 = '1'  AND ZHF13 = '7' THEN MODELO_USO = 'T01-7'; 
IF MODELO_USO = 'T01' AND ZHF12 = '1'  AND ZHF13 = '8' THEN MODELO_USO = 'T01-8';

IF MODELO_USO = 'T02' AND MARCA_MANZANA IN (1,2,3) THEN MODELO_USO = 'T02-1'; 
IF MODELO_USO = 'T02' AND MARCA_MANZANA IN (4,5,8) THEN MODELO_USO = 'T02-2';
IF MODELO_USO = 'T02' AND MARCA_MANZANA =6 THEN MODELO_USO = 'T02-3';
IF MODELO_USO = 'T02' AND MARCA_MANZANA =7 THEN MODELO_USO = 'T02-4';
IF MODELO_USO = 'T05' AND MARCA_MANZANA IN (1,2,3) THEN MODELO_USO = 'T05-1'; 
IF MODELO_USO = 'T05' AND MARCA_MANZANA IN (4,5,8) THEN MODELO_USO = 'T05-2';
IF MODELO_USO = 'T05' AND MARCA_MANZANA IN (6) THEN MODELO_USO = 'T05-3';
IF MODELO_USO = 'T05' AND MARCA_MANZANA IN (7) THEN MODELO_USO = 'T05-4';

IF MODELO_0 IN ('M06_1','M06_2','M06_3') THEN MODELO_0 = 'M06_123';
IF MODELO_0 IN ('M06_4','M06_5','M06_6') THEN MODELO_0 = 'M06_456';
IF MODELO_USO IN ('M06_1','M06_2','M06_3') THEN MODELO_USO = 'M06_123';
IF MODELO_USO IN ('M06_4','M06_5','M06_6') THEN MODELO_USO = 'M06_456';
RUN;

/**************************************************************************************************************/
/* ASIGNACIÓN DE LOS NOMBRES DE LOS MODELOS. */
/**************************************************************************************************************/

PROC SQL; CREATE TABLE VISTA_MODELO_UNID_LIQ AS /* ASIGNACIÓN DE LOS NOMBRES DE LOS MODELOS. */
 SELECT A.*,
CASE
WHEN (A.MODELO_0 IN ('M01_1') )THEN "M01. Residencial PH, estrato 1"
WHEN (A.MODELO_0 IN ('M01_2') )THEN "M01. Residencial PH, estrato 2"
WHEN (A.MODELO_0 IN ('M01_3') )THEN "M01. Residencial PH, estrato 3"
WHEN (A.MODELO_0 IN ('M02_4') )THEN "M02. Residencial PH, estrato 4"
WHEN (A.MODELO_0 IN ('M02_5') )THEN "M02. Residencial PH, estrato 5"
WHEN (A.MODELO_0 IN ('M02_6') )THEN "M02. Residencial PH, estrato 6"
WHEN (A.MODELO_0 IN ('M03') )THEN "M03. Oficinas PH"
WHEN (A.MODELO_0 IN ('M04') )THEN "M04. Comercio PH"
WHEN (A.MODELO_0 IN ('M05') )THEN "M05. Bodegas + Industria PH"
WHEN (A.MODELO_0 IN ('M06_123') )THEN "M06. Bifamiliar, estrato 1, 2 y 3"
WHEN (A.MODELO_0 IN ('M06_456') )THEN "M06. Bifamiliar, estrato 4, 5 y 6"
WHEN (A.MODELO_0 IN ('T01-1') )THEN "T01_1. Residencial Tipo 1"
WHEN (A.MODELO_0 IN ('T01-2') )THEN "T01_2. Residencial Tipo 2"
WHEN (A.MODELO_0 IN ('T01-3') )THEN "T01_3. Residencial Tipo 3"
WHEN (A.MODELO_0 IN ('T01-4') )THEN "T01_4. Residencial Tipo 4"
WHEN (A.MODELO_0 IN ('T01-5') )THEN "T01_5. Residencial Tipo 5"
WHEN (A.MODELO_0 IN ('T01-6') )THEN "T01_6. Residencial Tipo 6"
WHEN (A.MODELO_0 IN ('T01-7') )THEN "T01_7. Residencial Tipo 7"
WHEN (A.MODELO_0 IN ('T01-8') )THEN "T01_8. Residencial Tipo 8"
WHEN (A.MODELO_0 IN ('T02-1') )THEN "T02_1. Adecuación Comercial Res Tipo 1"
WHEN (A.MODELO_0 IN ('T02-2') )THEN "T02_2. Adecuación Comercial Res Tipo 2"
WHEN (A.MODELO_0 IN ('T02-3') )THEN "T02_3. Adecuación Comercial Res Tipo 3"
WHEN (A.MODELO_0 IN ('T02-4') )THEN "T02_3. Adecuación Comercial Res Tipo 4"
WHEN (A.MODELO_0 IN ('T03') )THEN "T03. Bodegas e Industria"
WHEN (A.MODELO_0 IN ('T04') )THEN "T04. Bodega Económica"
WHEN (A.MODELO_0 IN ('T05-1') )THEN "T05_1. Oficinas Res Tipo 1"
WHEN (A.MODELO_0 IN ('T05-2') )THEN "T05_2. Oficinas Res Tipo 2"
WHEN (A.MODELO_0 IN ('T05-3') )THEN "T05_3. Oficinas Res Tipo 3"
WHEN (A.MODELO_0 IN ('T05-4') )THEN "T05_4. Oficinas Res Tipo 4"
WHEN (A.MODELO_0 IN ('T06') )THEN "T06. Institucional"
WHEN (A.MODELO_0 IN ('T07') )THEN "T07. Depósitos"
WHEN (A.MODELO_0 IN ('T08') )THEN "T08. Colegios y Universidades 1-3 Pisos"
WHEN (A.MODELO_0 IN ('T09') )THEN "T09. Clínicas y Hospitales"
WHEN (A.MODELO_0 IN ('T10') )THEN "T10. Aulas de Clase"
WHEN (A.MODELO_0 IN ('T11') )THEN "T11. Hoteles"
WHEN (A.MODELO_0 IN ('T12') )THEN "T12. Edificio de parqueo PH"
WHEN (A.MODELO_0 IN ('T13') )THEN "T13. Parqueadero NPH"
WHEN (A.MODELO_0 IN ('T14') )THEN "T14. Oficinas operativas PH"
WHEN (A.MODELO_0 IN ('T15') )THEN "T15. Enramadas"
WHEN (A.MODELO_0 IN ('T16') )THEN "T16. Anexos constructivos"
WHEN (A.MODELO_0 IN ('T17') )THEN "T17. Piscinas"
WHEN (A.MODELO_0 IN ('T18') )THEN "T18. Coliseos"
WHEN (A.MODELO_0 IN ('T19') )THEN "T19. Bodegas con Adecuación Comercial"
WHEN (A.MODELO_0 IN ('T20') )THEN "T20. Moteles, amoblados, residencias"
WHEN (A.MODELO_0 IN ('T21') )THEN "T21. Parqueo libre PH"
WHEN (A.MODELO_0 IN ('T22') )THEN "T22. Parqueo cubierto PH"
WHEN (A.MODELO_0 IN ('T23') )THEN "T23. Depósito (Lockers) PH"
WHEN (A.MODELO_0 IN ('T24') )THEN "T24. Complemento Residencial Material Desecho" 
WHEN (A.MODELO_0 IN ('T25') )THEN "T25. Complemento Residencial Material Prefabricado" 
WHEN (A.MODELO_0 IN ('T26') )THEN "T26. Colegios y Universidades 4 Pisos o más"
WHEN (A.MODELO_0 IN ('LOTES_PH')) THEN "LOTES_PH"
WHEN (A.MODELO_0 IN ('LOTES_NPH')) THEN "LOTES_NPH"
WHEN (A.MODELO_0 IN ('LOTES_30')) THEN "LOTES_30"
WHEN (A.MODELO_0 IN ('AV_ESP_BIC')) THEN "AV_ESP_BIC - Bienes Interés Cultural"
WHEN (A.MODELO_0 IN ('AV_ESP_USO')) THEN "AV_ESP_USO - Usos Especiales"
WHEN (A.MODELO_0 IN ('AV_ESP_CC')) THEN  "AV_ESP_CC - Centro Comercial"
WHEN (A.MODELO_0 IN ('PRED_CESP')) THEN  "PRED_CESP - Predios Especiales"
WHEN (A.MODELO_0 IN ('AV_ESP_TOP')) THEN  "AV_ESP_TOP - Predios Especiales"
WHEN (A.MODELO_0 IN ('AV_ESP_MUL')) THEN "AV_ESP_MUL - Combinacion Model-Tabla"
WHEN (A.MODELO_0 IN ('USOS MULTIPLES')) THEN "Usos Múltiples"

ELSE 'M0'
		END AS NOMBRE_MODELO_0 
		  FROM VISTA_NUEVO_MODELO_F AS A;
QUIT;


/**************************************************************************************************************/
/* VARIABLE DE ACTUALIZADO. */
/**************************************************************************************************************/

PROC SQL; 	CREATE TABLE PRUEBA.VISTA_MODELO_UNID_LIQ AS/* VARIABLE DE ACTUALIZADO. */
SELECT A.*, 
CASE WHEN (B.FASE=1) THEN 1 ELSE 0 END  AS ACTUALIZADO
				FROM  VISTA_MODELO_UNID_LIQ  AS A
 				LEFT JOIN ODBCLIB.ACT_DEPENDENCIA_BARRIOS AS B
				ON	A.CODIGO_BARRIO = B.CODIGO_BARRIO  ;
QUIT;


/**************************************************************************************************************/
/* SE SELECCIONAN LOS PREDIOS A LIQUIDAR POR UNIDAD CALIFICADA. */
/**************************************************************************************************************/

/* Esta linea está sujeta a cambios. */
/* SE COMENTÓ LA LINEA PORQUE LA ASIGNACIÓN DE VALORES UNITARIOS SE VA A REALIZAR POR UNIDAD CALIFICADA*/
DATA PRUEBA.BD_PREDIOS_MAS_USOMU; SET PRUEBA.VISTA_MODELO_UNID_LIQ; /* SE SELECCIONAN LOS PREDIOS A LIQUIDAR POR UNIDAD CALIFICADA. */
/*IF MODELO_0 IN ('USOS MULTIPLES') OR (MODELO_0 NOT IN ('USOS MULTIPLES') AND UNIDAD_LIQUIDACION =1); */
RUN; 



/**************************************************************************************************************/
								/* PROGRAMACION TABLAS NPH */
/**************************************************************************************************************/

/**************************************************************************************************************/
/* ASIGNACIÓN DE CORRELATIVA TABLAS NPH SISTEMAS */
/**************************************************************************************************************/



DATA PRUEBA.BD_PREDIOS_MAS_USOMU_V2 ;SET PRUEBA.BD_PREDIOS_MAS_USOMU; /*CORRELATIVA TABLAS NPH SISTEMAS*/

AREA_CONSTRUIDA = ROUND(AREA_CONSTRUIDA, .01);
AREA_USO = ROUND(AREA_USO, .01);
AREA_TERRENO = ROUND(AREA_TERRENO, .01);

IF MODELO_USO = 'T01-1' THEN  EC_MO_ID = 388 ;
IF MODELO_USO = 'T01-2' THEN  EC_MO_ID = 389 ;
IF MODELO_USO = 'T01-3' THEN  EC_MO_ID = 390 ;
IF MODELO_USO = 'T01-4' THEN  EC_MO_ID = 391 ;
IF MODELO_USO = 'T01-5' THEN  EC_MO_ID = 392 ;
IF MODELO_USO = 'T01-6' THEN  EC_MO_ID = 393 ;
IF MODELO_USO = 'T01-7' THEN  EC_MO_ID = 394 ;
IF MODELO_USO = 'T01-8' THEN  EC_MO_ID = 483 ;

IF MODELO_USO = 'T02-1' THEN  EC_MO_ID = 395 ;
IF MODELO_USO = 'T02-2' THEN  EC_MO_ID = 396 ;
IF MODELO_USO = 'T02-3' THEN  EC_MO_ID = 397 ;
IF MODELO_USO = 'T02-4' THEN  EC_MO_ID = 503 ;

IF MODELO_USO = 'T05-1' THEN  EC_MO_ID = 398 ;
IF MODELO_USO = 'T05-2' THEN  EC_MO_ID = 399 ;
IF MODELO_USO = 'T05-3' THEN  EC_MO_ID = 400 ;
IF MODELO_USO = 'T05-4' THEN  EC_MO_ID = 523 ;

IF MODELO_USO = 'T03' THEN  EC_MO_ID = 283;
IF MODELO_USO = 'T04' THEN  EC_MO_ID = 284;
IF MODELO_USO = 'T06' THEN  EC_MO_ID = 286;
IF MODELO_USO = 'T07' THEN  EC_MO_ID = 287;
IF MODELO_USO = 'T08' THEN  EC_MO_ID = 288;
IF MODELO_USO = 'T09' THEN  EC_MO_ID = 289;
IF MODELO_USO = 'T10' THEN  EC_MO_ID = 290;
IF MODELO_USO = 'T11' THEN  EC_MO_ID = 291;
IF MODELO_USO = 'T12' THEN  EC_MO_ID = 292;
IF MODELO_USO = 'T13' THEN  EC_MO_ID = 6;
IF MODELO_USO = 'T14' THEN  EC_MO_ID = 7;
IF MODELO_USO = 'T15' THEN  EC_MO_ID = 8;
IF MODELO_USO = 'T16' THEN  EC_MO_ID = 9;
IF MODELO_USO = 'T17' THEN  EC_MO_ID = 42;
IF MODELO_USO = 'T18' THEN  EC_MO_ID = 11;
IF MODELO_USO = 'T19' THEN  EC_MO_ID = 12;
IF MODELO_USO = 'T20' THEN  EC_MO_ID = 13;
IF MODELO_USO = 'T21' THEN  EC_MO_ID = 14;
IF MODELO_USO = 'T22' THEN  EC_MO_ID = 15;
IF MODELO_USO = 'T23' THEN  EC_MO_ID = 16;
IF MODELO_USO = 'T24' THEN  EC_MO_ID = 17;
IF MODELO_USO = 'T25' THEN  EC_MO_ID = 50;
IF MODELO_USO = 'T26' THEN  EC_MO_ID = 51;
IF MODELO_USO = 'T27' THEN  EC_MO_ID = 52;
IF MODELO_USO = 'T28' THEN  EC_MO_ID = 221;

IF MODELO_0 IN ('T01-1', 'T01-2', 'T01-3', 'T01-4', 'T01-5', 'T01-6', 'T01-7','T01-8', 'T02-1', 'T02-2', 'T02-3', 'T03', 
'T04', 'T05-1', 'T05-2', 'T05-3', 'T06', 'T07', 'T08', 'T09', 'T10', 'T11', 'T12', 'T13', 'T14', 'T15', 'T16', 
'T17', 'T18', 'T19', 'T20', 'T21', 'T22', 'T23', 'T24', 'T25', 'T26', 'USOS MULTIPLES') THEN LIQUIDACION='TABLA';
IF MODELO_0 IN ('AV_ESP_USO', 'AV_ESP_CC', 'AV_ESP_BIC', 'PRED_CESP', 'AV_ESP_TOP','AV_ESP_MUL', 'AV_COMER','AV_ESP_TAB','AV_ESP_MOD', 'AV_ESP_IND', 'REVIS_CAT','AUTO_AV_CAT') THEN LIQUIDACION='AVESP';
IF MODELO_0 IN ('LOTES_NPH','LOTES_PH', 'LOTES_30') THEN LIQUIDACION='LOTES';
IF MODELO_0 IN ('M01_1', 'M01_2', 'M01_3', 'M02_4', 'M02_5', 'M02_6', 'M03', 'M04','M05','M06_123','M06_456') THEN LIQUIDACION='MODEL';
RUN;

proc import datafile = "\\prowin04\cavellaneda\EJERCICIOS\EJERCICIOS 2021\VERIFICACION_CALCULOS\210923_CONSTRUCCION_INSUMO_SIE_TABLAS_VALOR\output\210924_ARCHIVO_CARGUE_VR_UNIT_ESTADISTICA.xlsx"
 out  =  CONSOLIDADO_TABLAS_VALORES
 dbms  =  xlsx
 replace;
 sheet  =  "Consolidado_est";
run;

proc sql;
CREATE TABLE PRUEBA.PREDIOS_VALORES_TABLAS_NPH2 AS SELECT A.*, B.VAL_METRO_CUAD AS VALOR_UNITARIO_&VIGENCIA.
FROM PRUEBA.BD_PREDIOS_MAS_USOMU_V2 AS A 
LEFT JOIN CONSOLIDADO_TABLAS_VALORES AS B
ON A.EC_MO_ID = B.EC_MO_ID AND
A.PUNTAJE = B.PUNTAJE1 AND 
A.EDAD = B.EDAD_PREDIO1;
QUIT;

/**************************************************************************************************************/
/* CALCULO VALORES_CONSTRUCCION USOS MULTIPLES*/
/**************************************************************************************************************/

DATA UMULT_VISTA_VUNITAR_X_AREA; SET  PRUEBA.PREDIOS_VALORES_TABLAS_NPH; /* CALCULO VALORES_CONSTRUCCION USOS MULTIPLES*/
IF  LIQUIDACION = 'TABLA'; 
VU_AREA = VALOR_UNITARIO_&VIGENCIA. * AREA_USO; RUN;

/**************************************************************************************************************/
/* SE CALCULA EL VALOR TOTAL DE LA CONSTRUCCIÓN DEL PREDIO (LA SUMA POR UNIDADES CALIFICADAS). */
/**************************************************************************************************************/

PROC SQL; CREATE TABLE UMULT_PRED_VCONST AS /* SE CALCULA EL VALOR TOTAL DE LA CONSTRUCCIÓN DEL PREDIO (LA SUMA POR UNIDADES CALIFICADAS). */
SELECT CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO, CODIGO_CONSTRUCCION, CODIGO_RESTO,
SUM(VU_AREA) AS VALOR_CONSTRUCCION_COM_&VIGENCIA.
FROM UMULT_VISTA_VUNITAR_X_AREA
GROUP BY CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO, CODIGO_CONSTRUCCION, CODIGO_RESTO;
QUIT;

PROC SQL;CREATE TABLE UMULT_PRED_VCONST2 AS SELECT A.*,
B.VALOR_CONSTRUCCION_COM_&VIGENCIA. AS VALOR_CONSTRUCCION_COM_&VIGENCIA._UM
FROM UMULT_VISTA_VUNITAR_X_AREA AS A LEFT JOIN UMULT_PRED_VCONST AS B ON 
A.CODIGO_BARRIO = B.CODIGO_BARRIO &
A.CODIGO_MANZANA = B.CODIGO_MANZANA &
A.CODIGO_PREDIO = B.CODIGO_PREDIO &
A.CODIGO_CONSTRUCCION = B.CODIGO_CONSTRUCCION &
A.CODIGO_RESTO = B.CODIGO_RESTO
ORDER BY A.CODIGO_BARRIO, A.CODIGO_MANZANA, A.CODIGO_PREDIO, A.CODIGO_CONSTRUCCION, A.CODIGO_RESTO;
QUIT;

/**************************************************************************************************************/
/* SE CONCATENAN LAS DOS BASES CORRESPONDIENTES A TABLAS Y LIQUIDACIONES DIFERENTES A TABLAS. */
/**************************************************************************************************************/
					
DATA PREDIOS_VALORES_TABLA_UR; SET PRUEBA.PREDIOS_VALORES_TABLAS_NPH; /* SE CONCATENAN LAS DOS BASES CORRESPONDIENTES A TABLAS Y LIQUIDACIONES DIFERENTES A TABLAS. */
IF LIQUIDACION NOT IN ('TABLA'); RUN;

DATA PRUEBA.BD_PREDIOS_MAS_USOMU_V3; SET PREDIOS_VALORES_TABLA_UR UMULT_PRED_VCONST2; RUN;

DATA PRUEBA.VISTA_USOS_MULTIPLES_DEF; SET PRUEBA.BD_PREDIOS_MAS_USOMU_V3;
IF MODELO_0 IN ('USOS MULTIPLES'); RUN;


/*************************************************************************************************************************/
/****************** EMPIEZA LA RUTINA PARA ARMAR LA BASE PARA MODELOS CREANDO TODAS LAS VARIABLES DUMMY ******************/
/*************************************************************************************************************************/

/**************************************************************************************************************/
/*1. PEGADO CENTRALIDADES (PREDIOS + UM)*/
/**************************************************************************************************************/

PROC SORT DATA=ODBCLIB.CENTRALIDADES NODUPKEY OUT=PRUEBA.CENTRALIDADES; BY COD_BARRIO; RUN;

PROC SQL;	CREATE TABLE PREDIO_VISTA_PROD_1 AS /*CENTRALIDADES*/
		SELECT A.*, B.COD_ZONA_CIU AS CENTRALIDAD
			FROM PRUEBA.BD_PREDIOS_MAS_USOMU_V3 AS A LEFT JOIN PRUEBA.CENTRALIDADES AS B
				ON	A.CODIGO_BARRIO = B.COD_BARRIO
			ORDER BY CODIGO_LOCALIDAD, A.CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO, CODIGO_CONSTRUCCION,
			CODIGO_RESTO, CODIGO_USO, UNIDAD_CALIFICADA;
QUIT;


/**************************************************************************************************************/
/*2. CALCULO DE DENSIDAD (PREDIOS + UM)*/
/**************************************************************************************************************/

PROC SQL; CREATE TABLE BARMANPRED AS SELECT
CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO, SUM(AREA_TERRENO) AS AREA_TERRENO_BMP, COUNT(*) AS NUMERO_UNIDADES,
 COUNT(*) AS NUMERO_UNIDADES_BMP, SUM(AREA_CONSTRUIDA) AS AREA_CONSTRUIDA_BMP
FROM COMUN.PREDIO_&FECHA_CORTE. GROUP BY CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO;
QUIT;

DATA DENSIDAD; SET BARMANPRED; 
IF AREA_TERRENO_BMP NE 0 THEN DENSIDAD = NUMERO_UNIDADES/AREA_TERRENO_BMP;ELSE DENSIDAD =0;
KEEP CODIGO_BARRIO CODIGO_MANZANA CODIGO_PREDIO DENSIDAD  NUMERO_UNIDADES AREA_TERRENO_BMP DENSIDAD NUMERO_UNIDADES_BMP AREA_CONSTRUIDA_BMP;
RUN;

PROC SQL; 	CREATE TABLE PREDIO_VISTA_PROD_2 AS
		SELECT A.*, B.DENSIDAD
			FROM  PREDIO_VISTA_PROD_1 AS A LEFT JOIN DENSIDAD AS B
				ON	A.CODIGO_BARRIO = B.CODIGO_BARRIO &
					A.CODIGO_MANZANA = B.CODIGO_MANZANA &
					A.CODIGO_PREDIO = B.CODIGO_PREDIO;					
QUIT;

/**************************************************************************************************************/
/*3. PEGADO DISTANCIAS (PREDIOS + UM) Y NUMERO PISO*/
/**************************************************************************************************************/
/*
PROC IMPORT OUT=PRUEBA.DISTANCIAS_LOTE_0
            DATAFILE="\\prowin04\cavellaneda\EJERCICIOS\EJERCICIOS 2021\VERIFICACION_CALCULOS\Verificacion_calculos\input\Dist_Agos022021.dbf"
            DBMS=DBF REPLACE;
RUN;
*/


DATA PRUEBA.DISTANCIAS_LOTE_0; 
SET ODBCLIB.TABLA_DISTANCIAS_2009; 
IF VIGENCIAS = &VIGENCIA.; 
RUN;  /*DISTANCIAS*/


PROC SQL; 	CREATE TABLE DISTANCIAS_LOTE AS	
		SELECT CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO,
ROUND(COL_PUB,.000000001) AS COL_PUB, 
ROUND(COL_PRIV,.000000001) AS COL_PRIV,
ROUND(CARCEL,.000000001) AS CARCELES, 
ROUND(CAI,.000000001) AS CAI,
ROUND(UNIVERS,.000000001) AS UNIVERS,
ROUND(HOSPS123,.000000001) AS HOSP123,
ROUND(CLINIC123,.000000001) AS CLINIC123,
ROUND(D_I_MILITA,.000000001) AS IN_MIL_POL,
ROUND(URI_UPJ,.000000001) AS URI_UPJ,
ROUND(CENTCOMERC,.000000001) AS CENTCOMERC,
ROUND(D_PAR_METR,.000000001) AS PKMETROP,
ROUND(D_PAR_ZONA,.000000001) AS PKZONAL,
ROUND(D_PAR_VECI,.000000001) AS  PKVENCIN,
ROUND(PKBOLSIL,.000000001) AS PKBOLSIL,
ROUND(D_ESTAC_TRANSMILENIO,.000000001) AS  ESTACTM,
ROUND(D_PORTAL_TRANSMILENIO,.000000001) AS PORTALTM,
ROUND(DIST_AEROP,.000000001) AS  AEROPTO,
ROUND(ZOINFLRUID,.000000001) AS  ZOINFLRUID,
ROUND(RSDJ,.000000001) AS  RSDJ,
ROUND(RFREGION,.000000001) AS  RFREGION,
ROUND(RFNAL,.000000001) AS  RFNAL,
ROUND(ZMPA,.000000001) AS  ZMPA,
ROUND(D_ESTRATO_1,.000000001) AS  EST01,
ROUND(D_ESTRATO_2,.000000001) AS  EST02,
ROUND(D_ESTRATO_3,.000000001) AS  EST03,
ROUND(D_ESTRATO_4,.000000001) AS  EST04,
ROUND(D_ESTRATO_5,.000000001) AS  EST05,
ROUND(D_ESTRATO_6,.000000001) AS  EST06
FROM PRUEBA.DISTANCIAS_LOTE_0;
QUIT;
/*
PROC SQL; 	CREATE TABLE DISTANCIAS_LOTE AS	
		SELECT LOTLOTE_ID,
		SUBSTR(LOTLOTE_ID, 1, 6) AS CODIGO_BARRIO,
		SUBSTR(LOTLOTE_ID, 8, 2) AS CODIGO_MANZANA,
		SUBSTR(LOTLOTE_ID, 11, 2) AS CODIGO_PREDIO,
ROUND(COL_PUB,.000000001) AS COL_PUB, 
ROUND(COL_PRIV,.000000001) AS COL_PRIV,
ROUND(CARCELES,.000000001) AS CARCELES,
ROUND(CAI,.000000001) AS CAI,
ROUND(UNIVERS,.000000001) AS UNIVERS,
ROUND(HOSP123,.000000001) AS HOSP123,
ROUND(CLINIC123,.000000001) AS CLINIC123,
ROUND(IN_MIL_POL,.000000001) AS IN_MIL_POL,
ROUND(URI_UPJ,.000000001) AS URI_UPJ,
ROUND(CENTCOMERC,.000000001) AS CENTCOMERC,
ROUND(PKMETROP,.000000001) AS PKMETROP,
ROUND(PKZONAL,.000000001) AS PKZONAL,
ROUND(PKVECIN,.000000001) AS  PKVENCIN,
ROUND(PKBOLSIL,.000000001) AS PKBOLSIL,
ROUND(ESTACTM,.000000001) AS  ESTACTM,
ROUND(PORTALTM,.000000001) AS PORTALTM,
ROUND(AEROPTO,.000000001) AS  AEROPTO,
ROUND(ZOINFLRUID,.000000001) AS  ZOINFLRUID,
ROUND(RSDJ,.000000001) AS  RSDJ,
ROUND(RFREGION,.000000001) AS  RFREGION,
ROUND(RFNAL,.000000001) AS  RFNAL,
ROUND(ZMPA,.000000001) AS  ZMPA,
ROUND(EST01,.000000001) AS  EST01,
ROUND(EST02,.000000001) AS  EST02,
ROUND(EST03,.000000001) AS  EST03,
ROUND(EST04,.000000001) AS  EST04,
ROUND(EST05,.000000001) AS  EST05,
ROUND(EST06,.000000001) AS  EST06
FROM PRUEBA.DISTANCIAS_LOTE_0;
QUIT;*/

PROC SORT DATA=DISTANCIAS_LOTE NODUPKEY OUT=TABLA_DISTANCIAS; BY CODIGO_BARRIO CODIGO_MANZANA CODIGO_PREDIO; RUN;

PROC SQL; CREATE TABLE PREDIO_VISTA_PROD_3 AS SELECT A.*, B.*,
CASE
			WHEN SUBSTR(CODIGO_RESTO,1,2) = '00' THEN 1
			WHEN SUBSTR(CODIGO_RESTO,1,1) = '9' THEN 1
			ELSE INPUT(SUBSTR(CODIGO_RESTO,1,2),BEST3.)
		END AS NUMERO_PISO
FROM PREDIO_VISTA_PROD_2 AS A LEFT JOIN TABLA_DISTANCIAS AS B 
ON	A.CODIGO_BARRIO  = B.CODIGO_BARRIO &
	A.CODIGO_MANZANA = B.CODIGO_MANZANA &
	A.CODIGO_PREDIO  = B.CODIGO_PREDIO;
QUIT;

/**************************************************************************************************************/
/*4. PEGADO CARGUE_CARTOGRAFIA (PREDIOS + UM) para la vigencia*/
/**************************************************************************************************************/

PROC SQL; 	CREATE TABLE PREDIO_VISTA_PROD_4 AS
		SELECT A.*, B.COORDENADA_X, B.COORDENADA_Y, B.MAX_NUM_PISOS
   		    FROM PREDIO_VISTA_PROD_3 AS A 
            LEFT JOIN          
			ODBCLIB.CARGUE_CARTOGRAFIA AS B /*COORDENADAS Y MAX_NUM_PISOS CARTOGRAFIA*/
				ON	A.CODIGO_BARRIO = B.CODIGO_BARRIO &
					A.CODIGO_MANZANA = B.CODIGO_MANZANA &
					A.CODIGO_PREDIO = B.CODIGO_PREDIO
			ORDER BY A.CODIGO_BARRIO, A.CODIGO_MANZANA, A.CODIGO_PREDIO, CODIGO_CONSTRUCCION, CODIGO_RESTO,
			CODIGO_USO, UNIDAD_CALIFICADA;
QUIT;

/**************************************************************************************************************/
/*5.  VALOR_M2_TERRENO_COM (VALORES REFERENCIA) de ODBCLIB.VALORES_REFERENCIA  DE 3 VIGENCIAS */
/**************************************************************************************************************/

PROC SQL; 	CREATE TABLE VALORES_REFERENCIA_&VIGENCIA_ANT_ANT. AS 
		SELECT CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO, VIGENCIA, VALOR
			FROM ODBCLIB.VALORES_REFERENCIA_&VIGENCIA_ANT_ANT. 
			 WHERE VIGENCIA = &VIGENCIA_ANT_ANT.  /*OJO CAMBIAR A 2019*/
			ORDER BY CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO;
QUIT;

PROC SORT 	DATA = VALORES_REFERENCIA_&VIGENCIA_ANT_ANT. NODUPKEY; BY CODIGO_BARRIO CODIGO_MANZANA CODIGO_PREDIO; RUN;

PROC SQL; 	CREATE TABLE VALORES_REFERENCIA_&VIGENCIA_ANT. AS /*Valor de m2 de terreno comercial de ODBCLIB.VALORES_REFERENCIA para la vigencia 2019  OJOOO MODIFICAR A 2019*/
		SELECT CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO, VIGENCIA, VALOR
			FROM ODBCLIB.VALORES_REFERENCIA_&VIGENCIA_ANT. /* OJO EN PRODUCCION ES = ODBCLIB.VALORES_REFERENCIA CAMBIO PORQUE SE DEBE TOMAR DE ACÁ, SIEMPRE COMPARA CON SISTEMAS EL NUMERO DE REGISTROS*/
			 WHERE VIGENCIA = &VIGENCIA_ANT.  /*OJO CAMBIAR A 2019*/
			ORDER BY CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO;
QUIT;

PROC SORT 	DATA = VALORES_REFERENCIA_&VIGENCIA_ANT. NODUPKEY; BY CODIGO_BARRIO CODIGO_MANZANA CODIGO_PREDIO; RUN;


PROC SQL; 	CREATE TABLE VALORES_REFERENCIA_&VIGENCIA. AS /*Valor de m2 de terreno comercial de ODBCLIB.VALORES_REFERENCIA para la vigencia 2019  OJOOO MODIFICAR A 2019*/
		SELECT CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO, VIGENCIA, VALOR
			FROM ODBCLIB.VALORES_REFERENCIA /* OJO EN PRODUCCION ES = ODBCLIB.VALORES_REFERENCIA CAMBIO PORQUE SE DEBE TOMAR DE ACÁ, SIEMPRE COMPARA CON SISTEMAS EL NUMERO DE REGISTROS*/
			 WHERE VIGENCIA = &VIGENCIA.  /*OJO CAMBIAR A 2020*/
			ORDER BY CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO;
QUIT;

PROC SORT 	DATA = VALORES_REFERENCIA_&VIGENCIA. NODUPKEY; BY CODIGO_BARRIO CODIGO_MANZANA CODIGO_PREDIO; RUN;



PROC SQL;	CREATE TABLE PRUEBA.PREDIO_VISTA_PROD_7 AS
		SELECT A.*, B.VALOR AS VALOR_M2_TERRENO_COM_&VIGENCIA_ANT_ANT_2.,
		C.VALOR AS VALOR_M2_TERRENO_COM_&VIGENCIA_ANT_2.,
		D.VALOR AS VALOR_M2_TERRENO_COM_&VIGENCIA_2.,
		D.VALOR AS VALOR_REFERENCIA_&VIGENCIA.
		FROM PREDIO_VISTA_PROD_4 AS A 
        LEFT JOIN VALORES_REFERENCIA_&VIGENCIA_ANT_ANT. AS B
				ON	A.CODIGO_BARRIO = B.CODIGO_BARRIO &
					A.CODIGO_MANZANA = B.CODIGO_MANZANA &
					A.CODIGO_PREDIO = B.CODIGO_PREDIO
        LEFT JOIN VALORES_REFERENCIA_&VIGENCIA_ANT. AS C
				ON	A.CODIGO_BARRIO = C.CODIGO_BARRIO &
					A.CODIGO_MANZANA = C.CODIGO_MANZANA &
					A.CODIGO_PREDIO = C.CODIGO_PREDIO
		LEFT JOIN VALORES_REFERENCIA_&VIGENCIA. AS D
				ON	A.CODIGO_BARRIO = D.CODIGO_BARRIO &
					A.CODIGO_MANZANA = D.CODIGO_MANZANA &
					A.CODIGO_PREDIO = D.CODIGO_PREDIO
   ORDER BY A.CODIGO_BARRIO, A.CODIGO_MANZANA, A.CODIGO_PREDIO, CODIGO_CONSTRUCCION, CODIGO_RESTO,
			CODIGO_USO, UNIDAD_CALIFICADA;
QUIT;


/**************************************************************************************************************/
/* 6. SE PEGA LA INFORMACIÓN DE VALORES DE TERRENO CORREGIDOS PARA LA VIGENCIA ANTERIOR */
/**************************************************************************************************************/


DATA VALORES_TERRENO; SET ODBCLIB.VALORES_TERRENO_&VIGENCIA_ANT.; /* 6. SE PEGA LA INFORMACIÓN DE VALORES DE TERRENO CORREGIDOS PARA LA VIGENCIA ANTERIOR */
IF VIGENCIA = &VIGENCIA_ANT.;
KEEP CODIGO_BARRIO CODIGO_MANZANA CODIGO_PREDIO CODIGO_CONSTRUCCION CODIGO_RESTO VALR_TERR_TRAN vigencia; RUN;

PROC SORT DATA = VALORES_TERRENO NODUPKEY; BY CODIGO_BARRIO CODIGO_MANZANA CODIGO_PREDIO CODIGO_CONSTRUCCION CODIGO_RESTO; RUN;


PROC SQL;  	CREATE TABLE PRUEBA.PREDIO_VISTA_PROD_8 AS  /*VALOR_M2_TERRENO_COR_18 DE TABLA VALORES TERRENO VIGENCIA=2018 */
		SELECT A.*, B.VALR_TERR_TRAN AS VALOR_M2_TERRENO_COR_&VIGENCIA_ANT_2.
			FROM PRUEBA.PREDIO_VISTA_PROD_7 AS A LEFT JOIN VALORES_TERRENO AS B
				ON	A.CODIGO_BARRIO = B.CODIGO_BARRIO &
					A.CODIGO_MANZANA = B.CODIGO_MANZANA &
					A.CODIGO_PREDIO = B.CODIGO_PREDIO &
					A.CODIGO_CONSTRUCCION = B.CODIGO_CONSTRUCCION &
                    A.CODIGO_RESTO = B.CODIGO_RESTO;
QUIT;


/**************************************************************************************************************/
/* VARIABLES DE CAMBIO DE PROTEGIDO A NO PROTEGIDO Y VICEVERSA. */
/**************************************************************************************************************/

DATA PREDIO_VISTA_PROD_9; SET PRUEBA.PREDIO_VISTA_PROD_8; /*CAMBIO DE SUELO: PROTEGIDO A NO PORTEGIDO O VICEVERSA*/
ZHF_1_2020 = SUBSTR(ZHF_2020, 1, 1);
ZHF_1_&VIGENCIA. = SUBSTR(ZHF_&VIGENCIA., 1, 1);
MODELO_0_ORIGINAL = MODELO_0;
IF ZHF_1_2020 = 5 AND ZHF_1_&VIGENCIA. = 6 THEN ZHF_5_6 = 1;
IF ZHF_1_2020 = 6 AND ZHF_1_&VIGENCIA. = 5 THEN ZHF_6_5 = 1;
RUN;
 
/**************************************************************************************************************/
/*10. IDENTIFICADOR EDIFICIO-CONJUNTO*/
/**************************************************************************************************************/

PROC SQL; 	CREATE TABLE TORRE_CONJUNTO AS SELECT /*10 IDENTIFICADOR NUMERO DE EDIFICIOS (CONJUNTO)*/
	CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO, COUNT(CODIGO_CONSTRUCCION) AS N_TORRES
	 FROM PREDIO_VISTA_PROD_9 
	 WHERE( UNIDAD_LIQUIDACION=1 AND CODIGO_CONSTRUCCION NOT IN ('000','901','999'))
GROUP BY CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO ;
QUIT;

DATA TORRE_CONJUNTO1;SET TORRE_CONJUNTO;
put @20 TIPO_PH $char17.;
IF N_TORRES=1 THEN TIPO_PH = '1 EDIFICIO';
IF N_TORRES=2 THEN TIPO_PH = '2 EDIFICIOS';
IF N_TORRES IN (3,4,5) THEN TIPO_PH = '3-5 EDIFICIOS';
IF N_TORRES>5 THEN TIPO_PH = 'MAYOR 5 EDIFICIOS'; RUN;

PROC SQL;	CREATE TABLE PREDIO_VISTA_PROD_10 AS
		SELECT A.*, B.N_TORRES, B.TIPO_PH
			FROM PREDIO_VISTA_PROD_9 AS A LEFT JOIN TORRE_CONJUNTO1 AS B
				ON	A.CODIGO_BARRIO = B.CODIGO_BARRIO &
					A.CODIGO_MANZANA = B.CODIGO_MANZANA &
					A.CODIGO_PREDIO=B.CODIGO_PREDIO;
QUIT;


/**************************************************************************************************************/
/*10. CREACION DE VARIABLES DUMMY 
/* RELACION_AREA, DUMMIES: (LOCALIDAD, ESTRATO, ZHF, EDAD, NUMERO_PISO DISTANCIAS, CENTRALIDADES)  */
/**************************************************************************************************************/


/*Creación de variables dummy*/
PROC SQL; 	CREATE TABLE PREDIO_VISTA_PROD_12 AS /* RELACION_AREA, DUMMIES: (LOCALIDAD, ESTRATO, ZHF, EDAD, NUMERO_PISO DISTANCIAS, CENTRALIDADES)  */
		SELECT *, 
		CASE WHEN AREA_TERRENO = 0 THEN 0 ELSE (AREA_CONSTRUIDA / AREA_TERRENO) END AS RELACION_AREA,	

		CASE WHEN CODIGO_LOCALIDAD = 1 THEN 1 ELSE 0 END AS USAQUEN,
		CASE WHEN CODIGO_LOCALIDAD = 2 THEN 1 ELSE 0 END AS CHAPINERO,
		CASE WHEN CODIGO_LOCALIDAD = 3 THEN 1 ELSE 0 END AS SANTAFE,
		CASE WHEN CODIGO_LOCALIDAD = 4 THEN 1 ELSE 0 END AS SAN_CRISTOBAL,
		CASE WHEN CODIGO_LOCALIDAD = 5 THEN 1 ELSE 0 END AS USME,
		CASE WHEN CODIGO_LOCALIDAD = 6 THEN 1 ELSE 0 END AS TUNJUELITO,
		CASE WHEN CODIGO_LOCALIDAD = 7 THEN 1 ELSE 0 END AS BOSA,
		CASE WHEN CODIGO_LOCALIDAD = 8 THEN 1 ELSE 0 END AS KENNEDY,
		CASE WHEN CODIGO_LOCALIDAD = 9 THEN 1 ELSE 0 END AS FONTIBON,
		CASE WHEN CODIGO_LOCALIDAD = 10 THEN 1 ELSE 0 END AS ENGATIVA,
		CASE WHEN CODIGO_LOCALIDAD = 11 THEN 1 ELSE 0 END AS SUBA,
		CASE WHEN CODIGO_LOCALIDAD = 12 THEN 1 ELSE 0 END AS B_UNIDOS,
		CASE WHEN CODIGO_LOCALIDAD = 13 THEN 1 ELSE 0 END AS TEUSAQUILLO,
		CASE WHEN CODIGO_LOCALIDAD = 14 THEN 1 ELSE 0 END AS MARTIRES,
		CASE WHEN CODIGO_LOCALIDAD = 15 THEN 1 ELSE 0 END AS A_NARINO,
		CASE WHEN CODIGO_LOCALIDAD = 16 THEN 1 ELSE 0 END AS P_ARANDA,
		CASE WHEN CODIGO_LOCALIDAD = 17 THEN 1 ELSE 0 END AS CANDELARIA,
		CASE WHEN CODIGO_LOCALIDAD = 18 THEN 1 ELSE 0 END AS RAFAEL_U_U,
		CASE WHEN CODIGO_LOCALIDAD = 19 THEN 1 ELSE 0 END AS C_BOLIVAR,

		CASE WHEN CODIGO_ESTRATO = 1 THEN 1 ELSE 0 END AS ESTRATO1,
		CASE WHEN CODIGO_ESTRATO = 2 THEN 1 ELSE 0 END AS ESTRATO2,
		CASE WHEN CODIGO_ESTRATO = 3 THEN 1 ELSE 0 END AS ESTRATO3,
		CASE WHEN CODIGO_ESTRATO = 4 THEN 1 ELSE 0 END AS ESTRATO4,
		CASE WHEN CODIGO_ESTRATO = 5 THEN 1 ELSE 0 END AS ESTRATO5,
		CASE WHEN CODIGO_ESTRATO = 6 THEN 1 ELSE 0 END AS ESTRATO6,

		CASE WHEN SUBSTR(ZHF,2,1) = '2' THEN 1 ELSE 0 END AS AREA_ACT2,
		CASE WHEN SUBSTR(ZHF,2,1) = '3' THEN 1 ELSE 0 END AS AREA_ACT3,
		CASE WHEN SUBSTR(ZHF,2,1) = '4' THEN 1 ELSE 0 END AS AREA_ACT4,
		CASE WHEN SUBSTR(ZHF,2,1) = '5' THEN 1 ELSE 0 END AS AREA_ACT5,
		CASE WHEN SUBSTR(ZHF,2,1) = '6' THEN 1 ELSE 0 END AS AREA_ACT6,
		CASE WHEN SUBSTR(ZHF,2,1) = '8' THEN 1 ELSE 0 END AS AREA_ACT8,

		CASE WHEN SUBSTR(ZHF,2,2) = '71' THEN 1 ELSE 0 END AS AREA_ACT71,
		CASE WHEN SUBSTR(ZHF,2,2) = '72' THEN 1 ELSE 0 END AS AREA_ACT72,
		CASE WHEN SUBSTR(ZHF,2,2) = '73' THEN 1 ELSE 0 END AS AREA_ACT73,
		CASE WHEN SUBSTR(ZHF,2,2) = '74' THEN 1 ELSE 0 END AS AREA_ACT74,
		CASE WHEN SUBSTR(ZHF,2,2) = '75' THEN 1 ELSE 0 END AS AREA_ACT75,

		CASE WHEN SUBSTR(ZHF,4,1) = '1' THEN 1 ELSE 0 END AS ZHF_4_TRAT_DESARR,
		CASE WHEN SUBSTR(ZHF,4,1) = '2' THEN 1 ELSE 0 END AS ZHF_4_TRAT_CONSOL,
		CASE WHEN SUBSTR(ZHF,4,1) = '3' THEN 1 ELSE 0 END AS ZHF_4_TRAT_RENOV,
		CASE WHEN SUBSTR(ZHF,4,1) = '4' THEN 1 ELSE 0 END AS ZHF_4_TRAT_CONSERV,
		CASE WHEN SUBSTR(ZHF,4,1) = '5' THEN 1 ELSE 0 END AS ZHF_4_TRAT_MEJ,

		CASE WHEN SUBSTR(ZHF,6,1) = '1' THEN 1 ELSE 0 END AS ZHF_6_TOPOG_PLANA,
		CASE WHEN SUBSTR(ZHF,6,1) = '2' THEN 1 ELSE 0 END AS ZHF_6_TOPOG_INCL,
		CASE WHEN SUBSTR(ZHF,6,1) = '3' THEN 1 ELSE 0 END AS ZHF_6_TOPOG_EMP,

		CASE WHEN SUBSTR(ZHF,10,1) = '0' THEN 1 ELSE 0 END AS ZHF_10_EST_VIA_SIN_VIA,
		CASE WHEN SUBSTR(ZHF,10,1) = '1' THEN 1 ELSE 0 END AS ZHF_10_EST_VIA_MALO,
		CASE WHEN SUBSTR(ZHF,10,1) = '2' THEN 1 ELSE 0 END AS ZHF_10_EST_VIA_REG,
		CASE WHEN SUBSTR(ZHF,10,1) = '3' THEN 1 ELSE 0 END AS ZHF_10_EST_VIA_BUENO,
		CASE WHEN SUBSTR(ZHF,10,1) = '4' THEN 1 ELSE 0 END AS ZHF_10_EST_VIA_EXC,

		CASE WHEN SUBSTR(ZHF,11,1) = '0' THEN 1 ELSE 0 END AS ZHF_11_INF_VIA_SIN,
		CASE WHEN SUBSTR(ZHF,11,1) = '1' THEN 1 ELSE 0 END AS ZHF_11_INF_VIA_LOCAL,
		CASE WHEN SUBSTR(ZHF,11,1) = '2' THEN 1 ELSE 0 END AS ZHF_11_INF_VIA_ZO_INT,
		CASE WHEN SUBSTR(ZHF,11,1) = '3' THEN 1 ELSE 0 END AS ZHF_11_INF_VIA_ART_COM,
		CASE WHEN SUBSTR(ZHF,11,1) = '4' THEN 1 ELSE 0 END AS ZHF_11_INF_VIA_ART_BAS,

		CASE WHEN SUBSTR(ZHF,12,1) = '0' THEN 1 ELSE 0 END AS ZHF_12_ACT_ECON_NO_ED,
		CASE WHEN SUBSTR(ZHF,12,1) = '1' THEN 1 ELSE 0 END AS ZHF_12_ACT_ECON_RES,
		CASE WHEN SUBSTR(ZHF,12,1) = '2' THEN 1 ELSE 0 END AS ZHF_12_ACT_ECON_COM,
		CASE WHEN SUBSTR(ZHF,12,1) = '3' THEN 1 ELSE 0 END AS ZHF_12_ACT_ECON_IND,
		CASE WHEN SUBSTR(ZHF,12,1) = '4' THEN 1 ELSE 0 END AS ZHF_12_ACT_ECON_EQUIP,
		CASE WHEN SUBSTR(ZHF,12,1) = '5' THEN 1 ELSE 0 END AS ZHF_12_ACT_ECON_ESPPUB,
		CASE WHEN SUBSTR(ZHF,12,1) = '6' THEN 1 ELSE 0 END AS ZHF_12_ACT_ECON_REC_DEP,

		CASE WHEN SUBSTR(ZHF,12,2) = '11' THEN 1 ELSE 0 END AS ZHF_1213_11,
		CASE WHEN SUBSTR(ZHF,12,2) = '12' THEN 1 ELSE 0 END AS ZHF_1213_12,
		CASE WHEN SUBSTR(ZHF,12,2) = '13' THEN 1 ELSE 0 END AS ZHF_1213_13,
		CASE WHEN SUBSTR(ZHF,12,2) = '14' THEN 1 ELSE 0 END AS ZHF_1213_14,
		CASE WHEN SUBSTR(ZHF,12,2) = '15' THEN 1 ELSE 0 END AS ZHF_1213_15,
		CASE WHEN SUBSTR(ZHF,12,2) = '16' THEN 1 ELSE 0 END AS ZHF_1213_16,

		CASE WHEN SUBSTR(ZHF,12,2) = '17' THEN 1 ELSE 0 END AS ZHF_1213_17,
		CASE WHEN SUBSTR(ZHF,12,2) = '18' THEN 1 ELSE 0 END AS ZHF_1213_18,
		

		CASE WHEN SUBSTR(ZHF,12,2) = '21' THEN 1 ELSE 0 END AS ZHF_1213_21,
		CASE WHEN SUBSTR(ZHF,12,2) = '22' THEN 1 ELSE 0 END AS ZHF_1213_22,
		CASE WHEN SUBSTR(ZHF,12,2) = '23' THEN 1 ELSE 0 END AS ZHF_1213_23,
		CASE WHEN SUBSTR(ZHF,12,2) = '24' THEN 1 ELSE 0 END AS ZHF_1213_24,


		CASE WHEN SUBSTR(ZHF,12,2) = '31' THEN 1 ELSE 0 END AS ZHF_1213_31,
		CASE WHEN SUBSTR(ZHF,12,2) = '32' THEN 1 ELSE 0 END AS ZHF_1213_32,
		CASE WHEN SUBSTR(ZHF,12,2) = '33' THEN 1 ELSE 0 END AS ZHF_1213_33,
		CASE WHEN SUBSTR(ZHF,12,2) = '34' THEN 1 ELSE 0 END AS ZHF_1213_34,

		CASE WHEN SUBSTR(ZHF,12,2) = '40' THEN 1 ELSE 0 END AS ZHF_1213_40,
		CASE WHEN SUBSTR(ZHF,12,2) = '41' THEN 1 ELSE 0 END AS ZHF_1213_41,
		CASE WHEN SUBSTR(ZHF,12,2) = '42' THEN 1 ELSE 0 END AS ZHF_1213_42,
		CASE WHEN SUBSTR(ZHF,12,2) = '43' THEN 1 ELSE 0 END AS ZHF_1213_43,
		CASE WHEN SUBSTR(ZHF,12,2) = '44' THEN 1 ELSE 0 END AS ZHF_1213_44,
		CASE WHEN SUBSTR(ZHF,12,2) = '45' THEN 1 ELSE 0 END AS ZHF_1213_45,
		CASE WHEN SUBSTR(ZHF,12,2) = '46' THEN 1 ELSE 0 END AS ZHF_1213_46,
		CASE WHEN SUBSTR(ZHF,12,2) = '47' THEN 1 ELSE 0 END AS ZHF_1213_47,
		CASE WHEN SUBSTR(ZHF,12,2) = '48' THEN 1 ELSE 0 END AS ZHF_1213_48,
		CASE WHEN SUBSTR(ZHF,12,2) = '49' THEN 1 ELSE 0 END AS ZHF_1213_49,
		
		CASE WHEN COMPLEMENTO_INDUSTRIA = '511' THEN 1 ELSE 0 END AS CIND_MADERA,
		CASE WHEN COMPLEMENTO_INDUSTRIA = '512' THEN 1 ELSE 0 END AS CIND_MET_LIV,
		CASE WHEN COMPLEMENTO_INDUSTRIA = '513' THEN 1 ELSE 0 END AS CIND_MET_MED,
		CASE WHEN COMPLEMENTO_INDUSTRIA = '514' THEN 1 ELSE 0 END AS CIND_MET_PES,
		CASE WHEN COMPLEMENTO_INDUSTRIA = '515' THEN 1 ELSE 0 END AS CIND_ALT_MAY,

		CASE WHEN CONSERVACION_HISTORICA = 'I' THEN 1 ELSE 0 END AS CONSERVACION_I,
		CASE WHEN CONSERVACION_HISTORICA = 'T' THEN 1 ELSE 0 END AS CONSERVACION_T,
		CASE WHEN CONSERVACION_HISTORICA = 'M' THEN 1 ELSE 0 END AS CONSERVACION_M,
        CASE WHEN CONSERVACION_HISTORICA = 'N' THEN 1 ELSE 0 END AS CONSERVACION_N,

		CASE WHEN  (EDAD <= 5)         THEN 1 ELSE 0 END AS DUMMY_NUEVO,
		CASE WHEN  (5  < EDAD <= 20)  THEN 1 ELSE 0 END AS DUMMY_EDAD_6_20,
		CASE WHEN  (20 < EDAD <= 30)  THEN 1 ELSE 0 END AS DUMMY_EDAD_20_30,
		CASE WHEN  (EDAD > 30)        THEN 1 ELSE 0 END AS DUMMY_VIEJOS,

	
/*Dummys generadas del Análisis de reducción de Variables de los modelos son categorizaciones*/

		CASE WHEN TIPO_PH='1 EDIFICIO' THEN  1 ELSE 0 END AS EDIFICIO_1,
		CASE WHEN TIPO_PH='2 EDIFICIOS' THEN  1 ELSE 0 END AS EDIFICIOS_2,
		CASE WHEN TIPO_PH='3-5 EDIFICIOS' THEN  1 ELSE 0 END AS EDIFICIOS_3_5,
		CASE WHEN TIPO_PH='MAYOR 5 EDIFICIOS' THEN  1 ELSE 0 END AS EDIFICIOS_M_5,

		CASE    WHEN SUBSTR(CODIGO_RESTO,1,1) = '9' THEN  1 ELSE 0 END AS SOTANO,
		CASE	WHEN (1 <= NUMERO_PISO <= 3) THEN 1 ELSE 0   END AS PISO_1_3,
		CASE 	WHEN (4 <= NUMERO_PISO <= 5) THEN 1 ELSE 0    END AS PISO_4_5,
		CASE 	WHEN (6 <= NUMERO_PISO <=10) THEN 1 ELSE 0    END AS PISO_6_10,
		CASE 	WHEN (10 < NUMERO_PISO <=20) THEN 1 ELSE 0   END AS PISO_11_20,
		CASE 	WHEN (NUMERO_PISO > 20)      THEN 1 ELSE 0    END AS PISO_M_20,
		
		CASE	WHEN (0  <= CARCELES <= 100) THEN 1 ELSE 0    END AS CARCEL_0_100,
		CASE 	WHEN (100 < CARCELES <= 200) THEN 1 ELSE 0    END AS CARCEL_100_200,
		CASE 	WHEN (200 < CARCELES <= 500) THEN 1 ELSE 0    END AS CARCEL_200_500,
		CASE 	WHEN  (CARCELES > 500)       THEN 1 ELSE 0    END AS CARCEL_M_500,

        CASE	WHEN (0  <= ESTACTM <= 100)  THEN 1 ELSE 0    END AS ESTACTM_0_100,
		CASE 	WHEN (100 < ESTACTM <= 200)  THEN 1 ELSE 0    END AS ESTACTM_100_200,
		CASE 	WHEN (200 < ESTACTM <= 500)  THEN 1 ELSE 0    END AS ESTACTM_200_500,
		CASE 	WHEN (ESTACTM> 500)          THEN 1 ELSE 0    END AS ESTACTM_M_500,

		CASE	WHEN (0  <= ZMPA <= 50) 	 THEN 1 ELSE 0    END AS ZMPA_0_50,
		CASE 	WHEN (50 < ZMPA <= 100) 	 THEN 1 ELSE 0    END AS ZMPA_50_100,
		CASE 	WHEN (ZMPA> 100)        	 THEN 1 ELSE 0    END AS ZMPA_M_100,

		CASE	WHEN (0  <= ZOINFLRUID <= 100) THEN 1 ELSE 0    END AS ZOINFLRUID_0_100,
		CASE 	WHEN (100 < ZOINFLRUID <= 200) THEN 1 ELSE 0    END AS ZOINFLRUID_100_200,
		CASE 	WHEN (200 < ZOINFLRUID <= 500) THEN 1 ELSE 0    END AS ZOINFLRUID_200_500,
		CASE 	WHEN (ZOINFLRUID> 500)         THEN 1 ELSE 0    END AS ZOINFLRUID_M_500,

		CASE	WHEN (0  <= CENTCOMERC <= 100) THEN 1 ELSE 0    END AS CENTCOMERC_0_100,
		CASE 	WHEN (100 < CENTCOMERC <= 200) THEN 1 ELSE 0    END AS CENTCOMERC_100_200,
		CASE 	WHEN (200 < CENTCOMERC <= 500) THEN 1 ELSE 0    END AS CENTCOMERC_200_500,
		CASE 	WHEN (CENTCOMERC> 500)         THEN 1 ELSE 0    END AS CENTCOMERC_M_500,

		CASE	WHEN (0  <= CLINIC123  <= 100) THEN 1 ELSE 0    END AS CLINIC123_0_100,
		CASE 	WHEN (100 < CLINIC123  <= 200) THEN 1 ELSE 0    END AS CLINIC123_100_200,
		CASE 	WHEN (200 < CLINIC123  <= 500) THEN 1 ELSE 0    END AS CLINIC123_200_500,
		CASE 	WHEN (CLINIC123 > 500)         THEN 1 ELSE 0    END AS CLINIC123_M_500,

		CASE	WHEN (0  <= HOSP123  <= 100)   THEN 1 ELSE 0    END AS HOSP123_0_100,
		CASE 	WHEN (100 < HOSP123  <= 200)   THEN 1 ELSE 0    END AS HOSP123_100_200,
		CASE 	WHEN (200 < HOSP123  <= 500)   THEN 1 ELSE 0    END AS HOSP123_200_500,
		CASE 	WHEN (HOSP123 > 500)           THEN 1 ELSE 0    END AS HOSP123_M_500,

      	CASE	WHEN (0  <= PORTALTM <= 100) THEN 1 ELSE 0    END AS PORTALTM_0_100,
    	CASE 	WHEN (100 < PORTALTM <= 200) THEN 1 ELSE 0    END AS PORTALTM_100_200,
		CASE 	WHEN (200 < PORTALTM <= 500) THEN 1 ELSE 0    END AS PORTALTM_200_500,
		CASE 	WHEN (PORTALTM > 500)        THEN 1 ELSE 0    END AS PORTALTM_M_500,

		CASE	WHEN (0  <= RSDJ <= 100) THEN 1 ELSE 0    END AS RSDJ_0_100,
    	CASE 	WHEN (100 < RSDJ <= 200) THEN 1 ELSE 0    END AS RSDJ_100_200,
		CASE 	WHEN (200 < RSDJ <= 500) THEN 1 ELSE 0    END AS RSDJ_200_500,
		CASE 	WHEN (RSDJ > 500)        THEN 1 ELSE 0    END AS RSDJ_M_500,
		
/*ZOINFLRUID, ZMPA, RSDJ, diatancia a los estratos, reserva regional  y nacional (RFREGION - RFNAL)*/
       CASE	WHEN (ZOINFLRUID = 0) 	 THEN 1 ELSE 0    END AS R_ZOINFLRUID,
       CASE	WHEN (ZMPA = 0) 	 THEN 1 ELSE 0    END AS R_ZMPA,
       CASE	WHEN (RSDJ = 0) 	 THEN 1 ELSE 0    END AS R_RSDJ,
	   CASE	WHEN (EST01 = 0) 	 THEN 1 ELSE 0    END AS R_EST01,
	   CASE	WHEN (EST02 = 0) 	 THEN 1 ELSE 0    END AS R_EST02,
	   CASE	WHEN (EST03 = 0) 	 THEN 1 ELSE 0    END AS R_EST03,
	   CASE	WHEN (EST04 = 0) 	 THEN 1 ELSE 0    END AS R_EST04,
	   CASE	WHEN (EST05 = 0) 	 THEN 1 ELSE 0    END AS R_EST05,
	   CASE	WHEN (EST06 = 0) 	 THEN 1 ELSE 0    END AS R_EST06,
	   CASE	WHEN (RFREGION = 0)  THEN 1 ELSE 0    END AS R_RFREGION,
	   CASE	WHEN (RFNAL = 0) 	 THEN 1 ELSE 0    END AS R_RFNAL,

/*Centralidades*/
CASE WHEN CENTRALIDAD = 'CENT_ALAMOS' THEN 1 ELSE 0 END AS CENT_ALAMOS,
CASE WHEN CENTRALIDAD = 'CENT_AMERICAS' THEN 1 ELSE 0 END AS CENT_AMERICAS,
CASE WHEN CENTRALIDAD = 'CENT_BOSA' THEN 1 ELSE 0 END AS CENT_BOSA,
CASE WHEN CENTRALIDAD = 'CENT_CLL_72_CLL_100' THEN 1 ELSE 0 END AS CENT_CLL_72_CLL_100,
CASE WHEN CENTRALIDAD = 'CENT_CENTRO_H_INT' THEN 1 ELSE 0 END AS CENT_CENTRO_H_INT,
CASE WHEN CENTRALIDAD = 'CENT_CHAPINERO' THEN 1 ELSE 0 END AS CENT_CHAPINERO,
CASE WHEN CENTRALIDAD = 'CENT_CORABASTOS' THEN 1 ELSE 0 END AS CENT_CORABASTOS,
CASE WHEN CENTRALIDAD = 'CENT_DANUB_RIO_TUNJ' THEN 1 ELSE 0 END AS CENT_DANUB_RIO_TUNJ,
CASE WHEN CENTRALIDAD = 'CENT_DELICIAS_ENS' THEN 1 ELSE 0 END AS CENT_DELICIAS_ENS,
CASE WHEN CENTRALIDAD = 'CENT_EJE_INTEG_LLAN_NUSME' THEN 1 ELSE 0 END AS CENT_EJE_INTEG_LLAN_NUSME,
CASE WHEN CENTRALIDAD = 'CENT_FERIAS' THEN 1 ELSE 0 END AS CENT_FERIAS,
CASE WHEN CENTRALIDAD = 'CENT_FONT_AEROP_ENG' THEN 1 ELSE 0 END AS CENT_FONT_AEROP_ENG,
CASE WHEN CENTRALIDAD = 'CENT_PRADO_VERANIEGO' THEN 1 ELSE 0 END AS CENT_PRADO_VERANG,
CASE WHEN CENTRALIDAD = 'CENT_QUIRIGUA_BOLIV' THEN 1 ELSE 0 END AS CENT_QUIRIGUA_BOLIV,
CASE WHEN CENTRALIDAD = 'CENT_RESTREPO_SANT' THEN 1 ELSE 0 END AS CENT_RESTREPO_SANT,
CASE WHEN CENTRALIDAD = 'CENT_SALITRE_Z_IND' THEN 1 ELSE 0 END AS CENT_SALITRE_Z_IND,
CASE WHEN CENTRALIDAD = 'CENT_SIETE_AGOSTO' THEN 1 ELSE 0 END AS CENT_SIETE_AGOSTO,
CASE WHEN CENTRALIDAD = 'CENT_SUBA' THEN 1 ELSE 0 END AS CENT_SUBA,
CASE WHEN CENTRALIDAD = 'CENT_TOBERIN_LA_PAZ' THEN 1 ELSE 0 END AS CENT_TOBERIN_LA_PAZ,
CASE WHEN CENTRALIDAD = 'CENT_USAQUEN_H_STA_BARB' THEN 1 ELSE 0 END AS CENT_USAQUEN_H_STA_BARB,
CASE WHEN CENTRALIDAD = 'CENT_VEINTE_JULIO' THEN 1 ELSE 0 END AS CENT_VEINTE_JULIO

FROM PREDIO_VISTA_PROD_10
ORDER BY CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO, CODIGO_CONSTRUCCION, CODIGO_RESTO, CODIGO_USO, UNIDAD_CALIFICADA;
QUIT;

/**************************************************************************************************************/
/*10. TIPOLOGÍAS
/* TIPOLOGIAS CONSTRUCTIVAS, GRUPO ACABADOS, GRUPO DE BAÑOS, GRUPO COCINA*/
/**************************************************************************************************************/


DATA PREDIO_VISTA_PROD_13; SET PREDIO_VISTA_PROD_12; /* TIPOLOGIAS CONSTRUCTIVAS, GRUPO ACABADOS, GRUPO DE BAÑOS, GRUPO COCINA*/
Tip1=0;
Tip2=0;
Tip3=0;
Tip4=0;
Tip5=0;
Tip6=0;
Tip7=0;
Tip8=0;
Tip9=0;
Tip10=0;

/* Tipología constructiva*/	
IF  (((ARMAZON_ESTRUCTURA="111" AND MUROS_ESTRUCTURA="121") OR
((ARMAZON_ESTRUCTURA="111" OR ARMAZON_ESTRUCTURA="113") AND 
  MUROS_ESTRUCTURA="123" AND CUBIERTA_ESTRUCTURA="132"))) OR 
((ARMAZON_ESTRUCTURA="111" AND (MUROS_ESTRUCTURA~="121" AND MUROS_ESTRUCTURA~="122" AND MUROS_ESTRUCTURA~="123" AND MUROS_ESTRUCTURA~="124" AND MUROS_ESTRUCTURA~="125")))
THEN Tip1=1;


IF  ((((ARMAZON_ESTRUCTURA="111" OR ARMAZON_ESTRUCTURA="113") AND MUROS_ESTRUCTURA="125" AND (CUBIERTA_ESTRUCTURA="132" OR CUBIERTA_ESTRUCTURA="133")
AND (COMPLEMENTO_INDUSTRIA ~="511" AND COMPLEMENTO_INDUSTRIA ~="512" AND COMPLEMENTO_INDUSTRIA ~="513" AND COMPLEMENTO_INDUSTRIA ~="514" AND COMPLEMENTO_INDUSTRIA ~="515")) OR
((ARMAZON_ESTRUCTURA="111" OR ARMAZON_ESTRUCTURA="113") AND MUROS_ESTRUCTURA="125" AND (CUBIERTA_ESTRUCTURA="132" OR CUBIERTA_ESTRUCTURA="134")
AND (COMPLEMENTO_INDUSTRIA ~="511" AND COMPLEMENTO_INDUSTRIA ~="512" AND COMPLEMENTO_INDUSTRIA ~="513" AND COMPLEMENTO_INDUSTRIA ~="514" AND COMPLEMENTO_INDUSTRIA ~="515"))))
OR
((ARMAZON_ESTRUCTURA="113" AND MUROS_ESTRUCTURA="121") OR (ARMAZON_ESTRUCTURA="113" AND MUROS_ESTRUCTURA="124"))
THEN Tip2=1;

IF ((ARMAZON_ESTRUCTURA="111" AND MUROS_ESTRUCTURA="122") AND (CUBIERTA_ESTRUCTURA="133" OR CUBIERTA_ESTRUCTURA="134")) OR
(ARMAZON_ESTRUCTURA="113" AND MUROS_ESTRUCTURA="122" AND (CUBIERTA_ESTRUCTURA="133" OR CUBIERTA_ESTRUCTURA="134")) OR
((ARMAZON_ESTRUCTURA="111" OR ARMAZON_ESTRUCTURA="113") AND MUROS_ESTRUCTURA="122" AND CUBIERTA_ESTRUCTURA="132")
THEN Tip3=1;


IF  ((ARMAZON_ESTRUCTURA="114" OR ARMAZON_ESTRUCTURA="115") AND MUROS_ESTRUCTURA="124")
THEN Tip4=1;

IF  (ARMAZON_ESTRUCTURA="112" AND MUROS_ESTRUCTURA="124")
OR  ((ARMAZON_ESTRUCTURA="112" AND
(MUROS_ESTRUCTURA~="121" AND MUROS_ESTRUCTURA~="122" AND MUROS_ESTRUCTURA~="123" AND MUROS_ESTRUCTURA~="124" AND MUROS_ESTRUCTURA~="125") AND
CUBIERTA_ESTRUCTURA="132"))
THEN Tip5=1;

IF (((ARMAZON_ESTRUCTURA="111" OR ARMAZON_ESTRUCTURA="113") AND MUROS_ESTRUCTURA="125" AND (CUBIERTA_ESTRUCTURA="132" OR CUBIERTA_ESTRUCTURA="133")
AND (COMPLEMENTO_INDUSTRIA="511" OR COMPLEMENTO_INDUSTRIA="512" OR COMPLEMENTO_INDUSTRIA="513" OR COMPLEMENTO_INDUSTRIA="514" OR COMPLEMENTO_INDUSTRIA="515")) OR
((ARMAZON_ESTRUCTURA="111" OR ARMAZON_ESTRUCTURA="113") AND MUROS_ESTRUCTURA="125" AND (CUBIERTA_ESTRUCTURA="132" OR CUBIERTA_ESTRUCTURA="134")
AND (COMPLEMENTO_INDUSTRIA="511" OR COMPLEMENTO_INDUSTRIA="512" OR COMPLEMENTO_INDUSTRIA="513" OR COMPLEMENTO_INDUSTRIA="514" OR COMPLEMENTO_INDUSTRIA="515")))
THEN Tip6=1;

IF  ((ARMAZON_ESTRUCTURA="114" OR ARMAZON_ESTRUCTURA="115") AND MUROS_ESTRUCTURA="125"
AND (COMPLEMENTO_INDUSTRIA ~="511" AND COMPLEMENTO_INDUSTRIA ~="512" AND COMPLEMENTO_INDUSTRIA ~="513" AND COMPLEMENTO_INDUSTRIA ~="514" AND COMPLEMENTO_INDUSTRIA ~="515"))
OR
(ARMAZON_ESTRUCTURA="113" AND MUROS_ESTRUCTURA="125" AND CUBIERTA_ESTRUCTURA="136"
AND (COMPLEMENTO_INDUSTRIA ~="511" AND COMPLEMENTO_INDUSTRIA ~="512" AND COMPLEMENTO_INDUSTRIA ~="513" AND COMPLEMENTO_INDUSTRIA ~="514" AND COMPLEMENTO_INDUSTRIA ~="515"))
THEN Tip7=1;


IF  ((ARMAZON_ESTRUCTURA="114" OR ARMAZON_ESTRUCTURA="115") AND MUROS_ESTRUCTURA="125"
AND (COMPLEMENTO_INDUSTRIA="511" OR COMPLEMENTO_INDUSTRIA="512" OR COMPLEMENTO_INDUSTRIA="513" OR COMPLEMENTO_INDUSTRIA="514" OR COMPLEMENTO_INDUSTRIA="515"))
OR
(ARMAZON_ESTRUCTURA="113" AND MUROS_ESTRUCTURA="125" AND CUBIERTA_ESTRUCTURA="136"
AND (COMPLEMENTO_INDUSTRIA="511" OR COMPLEMENTO_INDUSTRIA="512" OR COMPLEMENTO_INDUSTRIA="513" OR COMPLEMENTO_INDUSTRIA="514" OR COMPLEMENTO_INDUSTRIA="515"))
THEN Tip8=1;

IF  ((ARMAZON_ESTRUCTURA="114" OR ARMAZON_ESTRUCTURA="115")
AND (MUROS_ESTRUCTURA~="121" AND MUROS_ESTRUCTURA~="122" AND MUROS_ESTRUCTURA~="123" AND MUROS_ESTRUCTURA~="124" AND MUROS_ESTRUCTURA~="125")
AND (COMPLEMENTO_INDUSTRIA ~="511" AND COMPLEMENTO_INDUSTRIA ~="512" AND COMPLEMENTO_INDUSTRIA ~="513" AND COMPLEMENTO_INDUSTRIA ~="514" AND COMPLEMENTO_INDUSTRIA ~="515"))
THEN Tip9=1;

IF  ((ARMAZON_ESTRUCTURA="114" OR ARMAZON_ESTRUCTURA="115")
AND (MUROS_ESTRUCTURA~="121" AND MUROS_ESTRUCTURA~="122" AND MUROS_ESTRUCTURA~="123" AND MUROS_ESTRUCTURA~="124" AND MUROS_ESTRUCTURA~="125")
AND (COMPLEMENTO_INDUSTRIA="511" OR COMPLEMENTO_INDUSTRIA="512" OR COMPLEMENTO_INDUSTRIA="513" OR COMPLEMENTO_INDUSTRIA="514" OR COMPLEMENTO_INDUSTRIA="515"))
THEN Tip10=1;

/*Grupos de acabados principales*/
GA1=0;
GA2=0;
GA3=0;
GA4=0;
 
IF (FACHADA_ACABADOS="211" AND CONSERVACION_ACABADOS="241")
THEN GA1=1;

IF FACHADA_ACABADOS="212" AND
(CONSERVACION_ACABADOS="241" OR CONSERVACION_ACABADOS="242" OR CONSERVACION_ACABADOS="243" OR
(CONSERVACION_ACABADOS~="241" AND CONSERVACION_ACABADOS~="242" AND CONSERVACION_ACABADOS~="243" AND CONSERVACION_ACABADOS~="244"))
THEN GA2=1;

IF ((FACHADA_ACABADOS="213" OR FACHADA_ACABADOS="214") AND (CONSERVACION_ACABADOS="242" OR CONSERVACION_ACABADOS="243")) OR
(FACHADA_ACABADOS="213" AND (CONSERVACION_ACABADOS="241" OR CONSERVACION_ACABADOS="244"))
THEN GA3=1;

IF (FACHADA_ACABADOS="215" AND (CONSERVACION_ACABADOS="243" OR CONSERVACION_ACABADOS="244"))  OR
(FACHADA_ACABADOS="214" AND CONSERVACION_ACABADOS="244")
THEN GA4=1; 

/*Grupos de baños*/
GB1=0; 
GB2=0;
GB3=0;
GB4=0;
GB5=0;
GB6=0;

IF (TAMANO_BANO="311") OR
(TAMANO_BANO~="311" AND TAMANO_BANO~="312" AND TAMANO_BANO~="313" AND TAMANO_BANO~="314")
THEN GB1=1; 

IF (TAMANO_BANO="312" AND ENCHAPE_BANO~="325" AND MOBILIARIO_BANO="331")
THEN GB2=1;

IF TAMANO_BANO="312" AND ENCHAPE_BANO~="325" AND (MOBILIARIO_BANO="332" OR MOBILIARIO_BANO="333")
THEN GB3=1;

IF TAMANO_BANO="313" AND ENCHAPE_BANO~="325" AND (MOBILIARIO_BANO="332" OR MOBILIARIO_BANO="333" OR MOBILIARIO_BANO="334")
THEN GB4=1;

IF TAMANO_BANO="314" AND ENCHAPE_BANO~="325" AND (MOBILIARIO_BANO="333" OR MOBILIARIO_BANO="334")
THEN GB5=1;

IF ENCHAPE_BANO="325" AND (MOBILIARIO_BANO="334" OR MOBILIARIO_BANO="335")
THEN GB6=1;

/*Grupos de cocina*/
GC1=0;
GC2=0;
GC3=0;
GC4=0;

IF (TAMANO_COCINA="411") OR
(TAMANO_COCINA~="411" AND TAMANO_COCINA~="412" AND TAMANO_COCINA~="413" AND TAMANO_COCINA~="414")
THEN GC1=1;

IF (TAMANO_COCINA="412" AND ENCHAPE_COCINA~="425" AND
(MOBILIARIO_COCINA="431" OR MOBILIARIO_COCINA="432" OR MOBILIARIO_COCINA="433" OR MOBILIARIO_COCINA="434" OR
(MOBILIARIO_COCINA~="431" AND MOBILIARIO_COCINA~="432" AND MOBILIARIO_COCINA~="433" AND MOBILIARIO_COCINA~="434" AND MOBILIARIO_COCINA~="435")))
THEN GC2=1;

IF (TAMANO_COCINA="413" OR TAMANO_COCINA="414") AND ENCHAPE_COCINA~="425" AND
(MOBILIARIO_COCINA="432" OR MOBILIARIO_COCINA="433" OR MOBILIARIO_COCINA="434")
THEN GC3=1;

IF ENCHAPE_COCINA="425" AND (MOBILIARIO_COCINA="434" OR MOBILIARIO_COCINA="435")
THEN GC4=1;

RUN;


/**************************************************************************************************************/
/*10. SE PEGAN LOS VALORES TOTALES E INTEGRALES DE LA VIGENCIA ANTERIOR */
/**************************************************************************************************************/

PROC SQL; CREATE TABLE PREDIO_VISTA_PROD_15 /*PEGADO INFORMACION 2018 PARA COMPARACION Y VARIACIONES*/
AS SELECT C.CHIP, A.*, B.AVALUO_TOTAL_PUNTUAL_COM_&VIGENCIA_ANT., B.VALOR_INTEGRAL_COM_&VIGENCIA_ANT.
FROM PREDIO_VISTA_PROD_13 AS A
LEFT JOIN COMUN.PREDIO_FINAL_&VIGENCIA_ANT. AS B
				ON	A.CODIGO_BARRIO = B.CODIGO_BARRIO &
					A.CODIGO_MANZANA = B.CODIGO_MANZANA &
					A.CODIGO_PREDIO = B.CODIGO_PREDIO &
					A.CODIGO_CONSTRUCCION = B.CODIGO_CONSTRUCCION &
                    A.CODIGO_RESTO = B.CODIGO_RESTO
LEFT JOIN ODBCLIB.IDENTIFICADOR AS C
				ON	A.CODIGO_BARRIO = C.CODIGO_BARRIO &
					A.CODIGO_MANZANA = C.CODIGO_MANZANA &
					A.CODIGO_PREDIO = C.CODIGO_PREDIO &
					A.CODIGO_CONSTRUCCION = C.CODIGO_CONSTRUCCION &
                    A.CODIGO_RESTO = C.CODIGO_RESTO;
QUIT;


/**************************************************************************************************************/
/*10. CÁLCULO DE LA DENSIAD, NÚMERO DE UNIDADES RESIDENCIALES & TOTAL TERRENO RESIDENCIALES POR BMP. */
/**************************************************************************************************************/


PROC SQL;  CREATE TABLE BARMANPRED_RES AS SELECT
CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO, 
SUM(AREA_CONSTRUIDA) AS AREA_CONSTRUIDA_RES_BMP, SUM(AREA_TERRENO) AS AREA_TERRENO_RES_BMP, COUNT(*) AS NUMERO_UNIDADES_RES_BMP
FROM (SELECT * FROM PREDIO_VISTA_PROD_15 WHERE (CODIGO_USO IN ('037','038','001','002','009','019','020','022') & UNIDAD_LIQUIDACION = 1))
GROUP BY CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO;
QUIT;

PROC SQL;	CREATE TABLE PREDIO_VISTA_PROD_18 AS
		SELECT A.*, B.AREA_TERRENO_RES_BMP, B.NUMERO_UNIDADES_RES_BMP,
			C.AREA_CONSTRUIDA_BMP, C.AREA_TERRENO_BMP, C.NUMERO_UNIDADES_BMP
			FROM  PREDIO_VISTA_PROD_15 AS A
            LEFT JOIN BARMANPRED_RES AS B
				ON	A.CODIGO_BARRIO = B.CODIGO_BARRIO &
					A.CODIGO_MANZANA = B.CODIGO_MANZANA &
					A.CODIGO_PREDIO = B.CODIGO_PREDIO
            LEFT JOIN DENSIDAD AS C
				ON	A.CODIGO_BARRIO = C.CODIGO_BARRIO &
					A.CODIGO_MANZANA = C.CODIGO_MANZANA &
					A.CODIGO_PREDIO = C.CODIGO_PREDIO;					
QUIT;

/**************************************************************************************************************/
/*10. 
/**************************************************************************************************************/


/**************************************************************************************************************/
/*10. EN LA SIGUIENTE PARTE SE PEGA LA INFO DE PM Y OFERTAS A LA BASE. ESTÁ PENDIENTE INCLUIR LOS VALORES. */
/**************************************************************************************************************/

/**************************************************************************************************************/
/* EN CUANTO LA BASE DE OFERTAS, SE PEGAN LAS VARIABLES VALOR_INTEGRAL_OF, AVALUO_PREDIO_OF, OFERTA POR CHIP */
/* LA BASE DE OFERTAS ES COMUN.OFERTA_PH_2020 */
/**************************************************************************************************************/

/**************************************************************************************************************/
/* EN CUANTO LA BASE DE PUNTOS MUESTRA, SE TRAEN LAS VARIABLES A.AVL_OBSERVACIONES,A.AVL_ZONAHF,	*/
/* A.AVL_TVLRCOMPUNUNITARIO AS	VALOR_UNIT_TERRENO_2020, A.AVL_TVLRCOMPUNTOTAL AS VALOR_TOTAL_TERRENO_2020, */
/* A.AVL_CONVLRPUNCOMTOTAL	 AS VALOR_CONSTRUCCION_2020, A.AVL_INTPUNTUAL AS	VALOR_INTEGRAL_PM, */
/* A.AVL_AVALUOTOTALPUNTUAL AS	AVALUO_PREDIO_PM, 1 AS PUNTO_MUESTRA POR LLAVE */
/* LA BASE DE PUM ES COMUN.FOCA_ANALISIS_VALORES_2020 */
/**************************************************************************************************************/
/* TIPO_MUESTRA_2020 SE TRAE DE COMUN.TIPO_PUNTO_MUESTRA_2020 POR CHIP */
/**************************************************************************************************************/

PROC SQL;
CREATE TABLE PRUEBA.PREDIO_VISTA_PROD_22
AS SELECT A.*, B.EXCLUSION, B.F_EXP AS F_EXPANSION, B.PUNTO_MUESTRA, B.INCLUSION_FORZOSA
FROM PREDIO_VISTA_PROD_18 AS A
LEFT JOIN COMUN.MARCO_FINAL_2022 AS B 
				ON	A.CODIGO_BARRIO = B.CODIGO_BARRIO &
					A.CODIGO_MANZANA = B.CODIGO_MANZANA &
					A.CODIGO_PREDIO = B.CODIGO_PREDIO &
					A.CODIGO_CONSTRUCCION = B.CODIGO_CONSTRUCCION &
                    A.CODIGO_RESTO = B.CODIGO_RESTO;
QUIT;




proc import datafile = "&RUTA.\Verificacion_calculos\input\211006_PM.xlsx"
 out  =  COMUN.FOCA_ANALISIS_VALORES_2022
 dbms  =  xlsx
 replace;
 sheet  =  "Sheet1";
run;

proc import datafile = "&RUTA.\Verificacion_calculos\input\Ofertas_depuradas_PH.xlsx"
 out  =  COMUN.OFERTA_PH_2022
 dbms  =  xlsx
 replace;
 sheet  =  "OFERTAS ENTREGABLES";
run;


PROC SQL;
CREATE TABLE OFERTAS_PH_2022 AS SELECT DISTINCT 
CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO, CODIGO_CONSTRUCCION, CODIGO_RESTO,
VALOR_FINAL_ESTADISTICA AS AVALUO_PREDIO_OF, VALOR_INTEGRAL_ESTADISTICA AS VALOR_INTEGRAL_OF, ESTADO_FINAL, 1 AS OFERTA
FROM COMUN.OFERTA_PH_2022
WHERE ESTADO_FINAL = "Válida censo";
QUIT;


PROC SORT DATA=OFERTAS_PH_2022 NODUPKEY; BY CODIGO_BARRIO CODIGO_MANZANA CODIGO_PREDIO CODIGO_CONSTRUCCION CODIGO_RESTO;RUN;

PROC SQL; CREATE TABLE FOCA_PMUESTRA_PH_2022 AS SELECT DISTINCT
A.CHIP, A.CODIGO_BARRIO, A.CODIGO_MANZANA, A.CODIGO_PREDIO, A.CODIGO_CONSTRUCCION, A.CODIGO_RESTO, 
/*A.AVL_OBSERVACIONES,A.AVL_ZONAHF,	
A.AVL_TVLRCOMPUNUNITARIO AS	VALOR_UNIT_TERRENO_2020,
A.AVL_TVLRCOMPUNTOTAL AS VALOR_TOTAL_TERRENO_2020,
A.AVL_CONVLRPUNCOMTOTAL	 AS VALOR_CONSTRUCCION_2020,*/
A.AVL_INTPUNTUAL AS	VALOR_INTEGRAL_PM,
A.AVL_AVALUOTOTALPUNTUAL AS	AVALUO_PREDIO_PM,
1 AS PM_EFECTIVO
FROM
COMUN.FOCA_ANALISIS_VALORES_2022 AS A
WHERE A.AVL_INTPUNTUAL > 0 AND A.AVL_INTPUNTUAL NE .;
QUIT;

PROC SORT DATA=FOCA_PMUESTRA_PH_2022 NODUPKEY; BY CODIGO_BARRIO CODIGO_MANZANA CODIGO_PREDIO CODIGO_CONSTRUCCION CODIGO_RESTO;RUN;

PROC SQL;
CREATE TABLE PRUEBA.PREDIO_VISTA_PROD_23
AS SELECT A.*, B.*, C.*
FROM PRUEBA.PREDIO_VISTA_PROD_22 AS A 
LEFT JOIN FOCA_PMUESTRA_PH_2022 AS B 
ON A.CODIGO_BARRIO = B.CODIGO_BARRIO AND
A.CODIGO_MANZANA = B.CODIGO_MANZANA AND
A.CODIGO_PREDIO = B.CODIGO_PREDIO AND 
A.CODIGO_CONSTRUCCION = B.CODIGO_CONSTRUCCION AND 
A.CODIGO_RESTO = B.CODIGO_RESTO
LEFT JOIN OFERTAS_PH_2022 AS C 
ON A.CODIGO_BARRIO = C.CODIGO_BARRIO AND
A.CODIGO_MANZANA = C.CODIGO_MANZANA AND
A.CODIGO_PREDIO = C.CODIGO_PREDIO AND 
A.CODIGO_CONSTRUCCION = C.CODIGO_CONSTRUCCION AND 
A.CODIGO_RESTO = C.CODIGO_RESTO;
QUIT;

/* EL SIGUIENTE BLOQUE SE DEJA COMENTADO PARA RECORDAR QUE LAS OFT SOLO SE UTILIZAN PARA LOS MODELOS 2, 3, 4, 5 Y 6 PH */

/*
DATA REVISA;
SET COMUN.MARCO_FINAL_2022;
IF PUNTO_MUESTRA = 1 OR (OFERTA = 1 AND MODELO_0 IN ("M01_2", "M01_3", "M02_4", "M02_5", "M02_6")) and
MODELO_0 IN ("M01_1", "M01_2", "M01_3", "M02_4", "M02_5", "M02_6", "M03", "M04", "M05", "M06_123", "M06_456") AND EXCLUSION = "INCLUSION";
KEEP MODELO_0 CHIP F_EXP INCLUSION_FORZOSA PUNTO_MUESTRA PUNTO_MUESTRA_EFECTIVO OFERTA EXCLUSION;
RUN;
*/
PROC SQL; CREATE TABLE PRUEBA.PREDIO_VISTA_PROD_23 AS SELECT 
A.*,
CASE WHEN (A.PM_EFECTIVO = 1) THEN 1 
	 WHEN (A.OFERTA = 1 AND A.MODELO_0 IN ('M01_2', 'M01_3', 'M02_4', 'M02_5', 'M02_6')) THEN 1 
ELSE 0 END  AS FOCA_MODELACION, 
CASE WHEN (A.PM_EFECTIVO = 1) THEN VALOR_INTEGRAL_PM 
	 WHEN (A.OFERTA = 1 AND A.MODELO_0 IN ('M01_2', 'M01_3', 'M02_4', 'M02_5', 'M02_6')) THEN VALOR_INTEGRAL_OF 
ELSE 0 END  AS VALOR_INTEGRAL,
CASE WHEN (A.PM_EFECTIVO = 1) THEN AVALUO_PREDIO_PM
	 WHEN (A.OFERTA = 1 AND A.MODELO_0 IN ('M01_2', 'M01_3', 'M02_4', 'M02_5', 'M02_6')) THEN AVALUO_PREDIO_OF
ELSE 0 END  AS AVALUO_PREDIO
FROM PRUEBA.PREDIO_VISTA_PROD_23 AS A;
QUIT;


DATA PRUEBA.PREDIO_VISTA_PROD_23;
SET PRUEBA.PREDIO_VISTA_PROD_23;
IF MODELO_0 NOT IN ("M01_1", "M01_2", "M01_3", "M02_4", "M02_5", "M02_6", "M03", "M04", "M05", "M06_123", "M06_456") THEN FOCA_MODELACION = 0;
RUN;
/*
DATA REVISA;
SET PRUEBA.PREDIO_VISTA_PROD_23;
IF PUNTO_MUESTRA = 1 OR (OFERTA = 1 AND MODELO_0 IN ("M01_2", "M01_3", "M02_4", "M02_5", "M02_6")) and
MODELO_0 IN ("M01_1", "M01_2", "M01_3", "M02_4", "M02_5", "M02_6", "M03", "M04", "M05", "M06_123", "M06_456") AND EXCLUSION = "INCLUSION";
KEEP MODELO_0 CHIP PM_EFECTIVO
F_EXP INCLUSION_FORZOSA PUNTO_MUESTRA PUNTO_MUESTRA_EFECTIVO OFERTA EXCLUSION
FOCA_MODELACION
VALOR_INTEGRAL_PM
VALOR_INTEGRAL_OF
VALOR_INTEGRAL;
RUN;
*/
/**************************************************************************************************************/
/*10. INFORMACIÓN DE MUTACIONES FISICAS. */
/**************************************************************************************************************/

PROC SQL; CREATE TABLE PRUEBA.PREDIO_VISTA_PROD_23 AS SELECT A.*,B.MUTADOS
FROM PRUEBA.PREDIO_VISTA_PROD_23 AS A 
LEFT JOIN (SELECT DISTINCT CHIP, 1 AS MUTADOS FROM ODBCLIB.TMP_MUT_FISICA_2021) AS B ON
A.CHIP = B.CHIP;
QUIT;


/**************************************************************************************************************/
/*10. CÁLCULO DE VARIABLES DUMMY PARA LOS MODELOS. */
/**************************************************************************************************************/


DATA PRUEBA.PREDIO_VISTA_DUMMIES; SET PRUEBA.PREDIO_VISTA_PROD_23; /*CREACION DE VARIABLES PARTICULARES DE PARA MODELOS Y DUMMIES*/
VALOR_REFERENCIA_2019 = VALOR_M2_TERRENO_COM_20;
/*M01.2. Residencial PH, estrato 2*/

IF CODIGO_BARRIO IN('006516') THEN DUMMY_TINTAL=1; ELSE DUMMY_TINTAL=0;
IF CODIGO_BARRIO IN('003201','003202') THEN DUMMY_CRUCBER=1; ELSE DUMMY_CRUCBER=0;
IF CODIGO_BARRIO IN('003104') THEN DUMMY_CONCORDIA=1; ELSE DUMMY_CONCORDIA=0;
IF CODIGO_BARRIO IN('003105','003103') THEN DUMMY_EGIPTOAGUAS=1; ELSE DUMMY_EGIPTOAGUAS=0;

DUMMY_SOB_2020_M01_2=0;
DUMMY_SUB_2020_M01_2=0;
IF ( CODIGO_BARRIO IN('001429','002455','002579','004627','009252') AND AREA_CONSTRUIDA < 46.520 AND PUNTAJE < 44 AND AREA_TERRENO >= 25.855 AND AREA_TERRENO <33.000) THEN DUMMY_SOB_2020_M01_2 = 1 ;
IF ( CODIGO_BARRIO IN('001309','001312','001413','002406','002524','003201','003202','004565','004632','004643','005636','005637') AND AREA_CONSTRUIDA >= 49.100 AND AREA_CONSTRUIDA <59.310 AND PUNTAJE >= 32 AND DENSIDAD >= 0.033774154) THEN DUMMY_SOB_2020_M01_2 = 1 ;
IF ( CODIGO_BARRIO IN('001309','001312','001413','002406','002524','003201','003202','004565','004632','004643','005636','005637') AND AREA_CONSTRUIDA < 46.465 AND PUNTAJE < 32) THEN DUMMY_SOB_2020_M01_2 = 1 ;
IF ( CODIGO_BARRIO IN('003202','004605','005631','009252') AND AREA_CONSTRUIDA >= 59.310 AND AREA_CONSTRUIDA <89.450 AND EDAD >= 33) THEN DUMMY_SOB_2020_M01_2 = 1 ;
IF ( CODIGO_BARRIO IN('001427','001428','002427','004568','004573','004588','004618','005632','006516','006521','006531','009226','009235') AND PUNTAJE < 33 AND DENSIDAD > 0.027609816 AND DENSIDAD <0.031082517) THEN DUMMY_SOB_2020_M01_2 = 1 ;
IF ( CODIGO_BARRIO IN('001101','001416','001429','002412','002455','002579','004513','004605','004627','005631','006103','006518','009210','009248','009252') AND AREA_CONSTRUIDA < 59.310 AND PUNTAJE >= 44 AND AREA_TERRENO >= 32.550 AND AREA_TERRENO <70.445) THEN DUMMY_SOB_2020_M01_2 = 1 ;
IF ( CODIGO_BARRIO IN('001308','001319','002518','003203','009267') AND AREA_CONSTRUIDA < 54.500) THEN DUMMY_SOB_2020_M01_2 = 1 ;
IF ( CODIGO_BARRIO IN('003202','004605','005631','009252') AND AREA_CONSTRUIDA >= 59.310 AND EDAD < 17) THEN DUMMY_SOB_2020_M01_2 = 1 ;
IF ( CODIGO_BARRIO IN('001116','001434','002424','002501','002513','002632','004539','004554','009205','009220','009230')) THEN DUMMY_SOB_2020_M01_2 = 1 ;

IF ( CODIGO_BARRIO IN('001101','002455','002529') AND PUNTAJE < 36 AND AREA_CONSTRUIDA >= 42.00) THEN DUMMY_SUB_2020_M01_2 = 1 ;
IF ( CODIGO_BARRIO IN('002544','008528','009262') AND AREA_TERRENO < 28.950) THEN DUMMY_SUB_2020_M01_2 = 1 ;
IF ( CODIGO_BARRIO IN('001416','002417','002599','003202','004553','004632','004643','005632','005669','006103') AND AREA_TERRENO >= 27.030 AND PUNTAJE < 36 AND AREA_CONSTRUIDA >= 42.00 AND DENSIDAD >= 0.037071451) THEN DUMMY_SUB_2020_M01_2 = 1 ;
IF ( CODIGO_BARRIO IN('002402','002418','002544','003203','008528','009251','009262') AND AREA_TERRENO >= 28.950) THEN DUMMY_SUB_2020_M01_2 = 1 ;
IF ( CODIGO_BARRIO IN('001101','001301','001416','002413','002417','002455','002529','002599','003202','004538','004553','004632','004643','005632','005636','005666','005669','006103','009233','009245') AND AREA_TERRENO >= 21.570 AND AREA_TERRENO <22.365 AND PUNTAJE >= 36 AND AREA_CONSTRUIDA >= 44.75) THEN DUMMY_SUB_2020_M01_2 = 1 ;

/*M01.3. Residencial PH, estrato 3*/

DUMMY_SOB_2020_M01_3=0;
DUMMY_SUB_2020_M01_3=0;
IF ( CODIGO_BARRIO IN('002306','004212','004504','005619','006406','008507','009102','009117') AND DENSIDAD >= 0.014912715 AND EDAD >= 6 AND EDAD <=26 AND IN_MIL_POL < 1858.15098 AND COL_PUB >= 243.777958 AND COL_PUB <=306.206310) THEN DUMMY_SUB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('001114','002306','002401','002415','002416','002422','004212','004503','004504','004505','004525','005602','005619','005625','006315','006404','006406','006502','006506','006507','006531','007304','008101','008501','008503','008507','008516','008521','009102','009103','009106','009117','009135','009210','009217','009228','009242','009248') AND DENSIDAD >= 0.066923294 AND EDAD < 6 AND AREA_CONSTRUIDA >= 72.980) THEN DUMMY_SUB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('001114','002306','002401','004212','004503','004504','004525','005619','006315','006406','006502','006506','007304','008101','008501','008507','008516','009102','009106','009117','009135','009217','009228') AND DENSIDAD >= 0.014912715 AND EDAD >= 6 AND IN_MIL_POL >= 1948.62940 AND COL_PUB >= 206.182222 AND COL_PUB <=233.912750) THEN DUMMY_SUB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('002306','004212','004504','005619','006406','008507','009102','009117') AND DENSIDAD >= 0.014912715 AND EDAD >= 6 AND EDAD <=26 AND IN_MIL_POL < 407.88967 AND COL_PUB >= 621.960978 AND AREA_CONSTRUIDA < 61.450) THEN DUMMY_SUB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('001114','004503','006315','007304','009106','009135') AND DENSIDAD >= 0.014912715 AND EDAD >= 26 AND IN_MIL_POL >= 609.79006 AND IN_MIL_POL <=1858.15098 AND COL_PUB >= 343.502438 AND AREA_CONSTRUIDA < 50.250) THEN DUMMY_SUB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('001114','004503','006315','007304','009106','009135') AND DENSIDAD >= 0.014912715 AND EDAD >= 26 AND IN_MIL_POL >= 609.79006 AND IN_MIL_POL  <=1858.15098 AND COL_PUB >= 343.502438 AND AREA_CONSTRUIDA >= 65.700) THEN DUMMY_SUB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('001114','004503','006315','007304','009106','009135') AND DENSIDAD >= 0.014912715 AND EDAD >= 26 AND IN_MIL_POL < 609.79006 AND COL_PUB >= 85.240403) THEN DUMMY_SUB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('001114','002306','002401','004212','004503','004504','004525','005619','006315','006406','006502','006506','007304','008101','008501','008507','008516','009102','009106','009117','009135','009217','009228') AND DENSIDAD >= 0.014912715 AND EDAD >= 6 AND IN_MIL_POL >= 1937.41377 AND IN_MIL_POL  <=1948.62940 AND COL_PUB >= 85.240403) THEN DUMMY_SUB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('001114','002306','002401','004212','004503','004504','004525','005619','006315','006406','006502','006506','007304','008101','008501','008507','008516','009102','009106','009117','009135','009217','009228') AND DENSIDAD >= 0.014912715 AND EDAD >= 6 AND IN_MIL_POL>= 1858.15098 AND IN_MIL_POL <=1864.32235 AND COL_PUB >= 85.240403) THEN DUMMY_SUB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('001202','003102','005626','005640','005650','007209','008214') AND DENSIDAD >= 0.013747980 AND DENSIDAD <=0.026498296 AND EDAD >= 20 AND IN_MIL_POL >= 406.95229 AND PUNTAJE >= 54) THEN DUMMY_SUB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('001202','003102','005626','005640','005650','007209','008214') AND DENSIDAD >= 0.047486462 AND DENSIDAD <=0.063523781 AND EDAD >= 5 AND IN_MIL_POL >= 406.95229 AND PUNTAJE >= 54) THEN DUMMY_SUB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('003101','004111','005403','005623','005641','005680','006101','006109','006208','006409','007203','008519','009211') AND DENSIDAD >= 0.013747980 AND EDAD >= 5 AND EDAD <=6 AND IN_MIL_POL >= 406.95229) THEN DUMMY_SUB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('001202','002308','004402','004403','005502','005503','007203') AND DENSIDAD >= 0.013747980 AND EDAD < 5 AND COL_PUB >= 379.401809) THEN DUMMY_SUB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('002311','005623','005635','005650','006402','006508') AND DENSIDAD < 0.013747980 AND AREA_CONSTRUIDA < 98.250 AND PUNTAJE >= 51) THEN DUMMY_SUB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('005621','005623','005641','007209','008108','008523') AND DENSIDAD >= 0.013747980 AND EDAD < 5) THEN DUMMY_SUB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('001210','002311','003109','004106','004403','006320','008107') AND DENSIDAD >= 0.013747980 AND DENSIDAD <=0.052816010 AND EDAD >= 5 AND EDAD <=39 AND AREA_CONSTRUIDA >= 50.100 AND AREA_CONSTRUIDA <=59.720) THEN DUMMY_SUB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('002415','005625','006404','006406','009103','009210') AND DENSIDAD < 0.014912715 AND EDAD >= 6 AND COL_PUB < 513.126560 AND AREA_CONSTRUIDA >= 95.050) THEN DUMMY_SUB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('004111','007203') AND DENSIDAD >= 0.031260904 AND EDAD >= 6 AND IN_MIL_POL >= 406.95229 AND IN_MIL_POL <=2356.93923 AND PUNTAJE < 44) THEN DUMMY_SUB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('002416','002422','005602','006507','006531','008503','008521') AND DENSIDAD < 0.066923294 AND EDAD < 5 AND COL_PUB < 434.761848 AND AREA_CONSTRUIDA >= 60.890) THEN DUMMY_SUB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('003101','004111','005403','005623','005641','005680','006101','006109','006208','006409','007203','008519','009211') AND DENSIDAD >= 0.031260904 AND EDAD >= 6 AND IN_MIL_POL >= 1529.07930 AND IN_MIL_POL <=2356.93923 AND COL_PUB >= 473.735318 AND COL_PUB <=557.408522 AND PUNTAJE >= 44) THEN DUMMY_SUB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('002311','005623','005635','005650','006402','006508') AND DENSIDAD < 0.013747980 AND IN_MIL_POL < 2155.18678 AND AREA_CONSTRUIDA < 98.250 AND PUNTAJE < 42) THEN DUMMY_SUB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('001209','002309','004402','005626','005640','009241') AND DENSIDAD < 0.013747980 AND AREA_CONSTRUIDA < 98.250) THEN DUMMY_SUB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('002422','006531','008503') AND DENSIDAD < 0.066923294 AND EDAD < 6 AND IN_MIL_POL < 1567.99955 AND AREA_CONSTRUIDA >= 51.865 AND AREA_CONSTRUIDA <=60.485) THEN DUMMY_SUB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('002416','005602','006507','008521') AND DENSIDAD < 0.066923294 AND EDAD < 6 AND AREA_CONSTRUIDA < 60.890) THEN DUMMY_SUB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('001202','001209','002308','002309','003101','003102','004111','004402','005403','005503','005621','005623','005626','005635','005640','005641','005650','005680','006101','006109','006208','006409','006508','007203','007209','008108','008214','008505','008519','008523','009211','009241') AND DENSIDAD >= 0.013747980 AND EDAD >= 22 AND IN_MIL_POL < 406.95229) THEN DUMMY_SUB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('001210','002311','003109','004106','004403','006320','008107') AND DENSIDAD >= 0.052816010 AND EDAD >= 5 AND EDAD <=39 AND AREA_CONSTRUIDA >= 50.100) THEN DUMMY_SUB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('001114','002306','002401','004212','004503','004504','004525','005619','006315','006406','006502','006506','007304','008101','008501','008507','008516','009102','009106','009117','009135','009217','009228') AND DENSIDAD >= 0.014912715 AND EDAD >= 6 AND COL_PUB >= 81.852895 AND COL_PUB <=85.240403) THEN DUMMY_SUB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('002415','005625','006404','006406','009103','009210') AND DENSIDAD < 0.014912715 AND EDAD >= 6 AND COL_PUB < 513.126560 AND AREA_CONSTRUIDA < 76.000) THEN DUMMY_SUB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('002416','002422','005602','006507','006531','008503','008521') AND DENSIDAD < 0.066923294 AND EDAD >= 5 AND EDAD <=6 AND AREA_CONSTRUIDA >= 60.890) THEN DUMMY_SUB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('001403','002104','004504','004544','005602','005605','005619','005623','006423','007204','008214','008505','009101','009103','009232') AND AREA_CONSTRUIDA >= 54.550 AND DENSIDAD >= 0.065999747 AND UNIVERS >= 1018.64398 AND IN_MIL_POL >= 1274.77341) THEN DUMMY_SOB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('001429','002421','004505','004548','005641','005644','006405','006505','006507','008506','009135','009212','009213','009217') AND AREA_CONSTRUIDA < 88.100 AND COL_PUB < 322.85202 AND CAI >= 892.43565 AND CAI <=1541.67111 AND UNIVERS >= 880.64476 AND UNIVERS <=1085.96163 AND IN_MIL_POL < 2745.10766 AND PKMETROP >= 438.0047) THEN DUMMY_SOB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('004402','008501','009102','009210','009241') AND AREA_CONSTRUIDA < 47.565 AND COL_PUB >= 111.65394 AND COL_PUB<=719.80107 AND COL_PRIV < 129.159293 AND PUNTAJE >= 50 AND URI_UPJ < 6825.8041 AND PKMETROP >= 623.6922) THEN DUMMY_SOB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('002415','002419','004304','004401','005632','006406','009105') AND AREA_CONSTRUIDA >= 46.435 AND AREA_CONSTRUIDA<=54.550 AND COL_PUB >= 533.84126 AND EDAD < 33 AND PUNTAJE < 46) THEN DUMMY_SOB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('006423','009232') AND AREA_CONSTRUIDA >= 62.045 AND DENSIDAD < 0.061424444 AND COL_PRIV >= 127.888240 AND UNIVERS >= 1018.64398 AND IN_MIL_POL < 1274.77341 AND URI_UPJ < 5872.9313) THEN DUMMY_SOB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('004518','005509','005616','008213','009116','009219','009226') AND AREA_CONSTRUIDA >= 56.420 AND COL_PUB < 752.76283 AND CAI >= 893.07096 AND CAI <=999.90765 AND EDAD < 32) THEN DUMMY_SOB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('001111','001114','002301','003102','005625','005647','006104','006521','007303','009133','009214') AND DENSIDAD >= 0.021860488 AND DENSIDAD <=0.033557612 AND CAI < 720.79975 AND COL_PRIV < 474.116827 AND PUNTAJE >= 50) THEN DUMMY_SOB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('001111','001114','001206','001406','002301','002305','002306','003102','003108','004104','004506','005203','005502','005505','005508','005611','005612','005625','005647','006103','006104','006106','006407','006515','006521','007303','007307','007308','008105','008108','008425','009133','009214') AND AREA_CONSTRUIDA >= 62.260 AND DENSIDAD >= 0.104553340 AND COL_PRIV < 474.116827 AND UNIVERS < 1219.24829) THEN DUMMY_SOB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('004518','005509','005616','008213','009116','009219','009226') AND AREA_CONSTRUIDA >= 56.420 AND DENSIDAD >= 0.068090946 AND COL_PUB >= 296.74817 AND COL_PUB<=752.76283 AND CAI < 893.07096 AND EDAD >= 12 AND EDAD <=32) THEN DUMMY_SOB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('002304','004108','004510','004511','005603','005617','006210','008407','009201') AND AREA_CONSTRUIDA >= 68.300 AND DENSIDAD < 0.052559739 AND EDAD >= 11) THEN DUMMY_SOB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('001204','004101','006502','007106','008107') AND AREA_CONSTRUIDA < 56.420 AND COL_PUB < 752.76283 AND EDAD < 32) THEN DUMMY_SOB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('001403','004504','005602','006423','008505','009232') AND AREA_CONSTRUIDA >= 54.550 AND DENSIDAD < 0.061424444 AND COL_PRIV < 127.888240 AND UNIVERS >= 1018.64398 AND IN_MIL_POL < 1274.77341 AND URI_UPJ < 5872.9313) THEN DUMMY_SOB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('004518','006415','006516','008523') AND AREA_CONSTRUIDA < 53.000 AND COL_PUB < 752.76283 AND CAI >= 1003.41814 AND EDAD < 32 AND COL_PRIV >= 98.989142 AND PUNTAJE < 55) THEN DUMMY_SOB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('002306','004506','005508','006106','006407','007308') AND DENSIDAD >= 0.046538061 AND DENSIDAD <=0.104553340 AND CAI < 720.79975 AND COL_PRIV < 474.116827 AND UNIVERS < 910.34876 AND PUNTAJE >= 36) THEN DUMMY_SOB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('001405','002427','004303','004514','004518','006415','006516','008213','008523','009116','009203','009263') AND AREA_CONSTRUIDA < 53.000 AND COL_PUB < 752.76283 AND CAI >= 581.03927 AND EDAD < 32 AND COL_PRIV >= 98.989142 AND PUNTAJE >= 62) THEN DUMMY_SOB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('004310','004525','004530','007209','007403') AND AREA_CONSTRUIDA >= 56.420 AND DENSIDAD < 0.030552332 AND COL_PUB >= 155.68803 AND COL_PUB<=752.76283 AND CAI < 698.28720 AND EDAD < 32 AND IN_MIL_POL >= 831.03128) THEN DUMMY_SOB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('004310','004525','004530','005503','005601','006101','007209','007403','008101','008529','009248') AND AREA_CONSTRUIDA >= 56.420 AND DENSIDAD < 0.063266941 AND COL_PUB < 155.68803 AND EDAD < 32 AND IN_MIL_POL >= 831.03128) THEN DUMMY_SOB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('004310','004525','004530','005503','005601','006101','007209','007403','008101','008529','009248') AND AREA_CONSTRUIDA >= 56.420 AND COL_PUB < 752.76283 AND EDAD < 32 AND IN_MIL_POL < 831.03128) THEN DUMMY_SOB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('002304','004108','004510','004511','005603','005617','006210','008407','009201') AND AREA_CONSTRUIDA < 51.670 AND DENSIDAD < 0.052559739 AND EDAD >= 11) THEN DUMMY_SOB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('005625','005647','009214') AND DENSIDAD >= 0.038030045 AND DENSIDAD <=0.046538061 AND CAI < 720.79975 AND COL_PRIV < 474.116827 AND PUNTAJE >= 36) THEN DUMMY_SOB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('001403','002104','004504','004544','005602','005605','005619','005623','006423','007204','008214','008505','009101','009103','009232') AND AREA_CONSTRUIDA >= 54.550 AND AREA_CONSTRUIDA<=72.600 AND CAI < 390.00371 AND EDAD >= 25 AND UNIVERS < 1018.64398) THEN DUMMY_SOB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('001403','004504','005602','006423','008505','009232') AND AREA_CONSTRUIDA >= 54.550 AND UNIVERS >= 1018.64398 AND IN_MIL_POL < 1274.77341 AND URI_UPJ >= 5872.9313) THEN DUMMY_SOB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('001405','002427','004303','004514','004518','006415','006516','008213','008523','009116','009203','009263') AND AREA_CONSTRUIDA < 53.000 AND COL_PUB < 752.76283 AND CAI >= 581.03927 AND EDAD < 32 AND COL_PRIV < 98.989142) THEN DUMMY_SOB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('004310','004525','004530','005503','005601','006101','007209','007403','008101','008529','009248') AND AREA_CONSTRUIDA >= 56.420 AND DENSIDAD >= 0.043089478 AND DENSIDAD <=0.063266941 AND COL_PUB >= 155.68803 AND  COL_PUB  <=752.76283 AND EDAD < 32 AND IN_MIL_POL >= 831.03128) THEN DUMMY_SOB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('001111','001114','001206','002301','002306','003102','004506','005203','005502','005505','005508','005611','005612','005625','005647','006104','006106','006407','006521','007303','007308','008108','009133','009214') AND DENSIDAD < 0.104553340 AND COL_PRIV < 474.116827 AND PUNTAJE < 36) THEN DUMMY_SOB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('001111','001114','001206','001406','002301','002305','002306','003102','003108','004104','004506','005203','005502','005505','005508','005611','005612','005625','005647','006103','006104','006106','006407','006515','006521','007303','007307','007308','008105','008108','008425','009133','009214') AND AREA_CONSTRUIDA < 52.010 AND DENSIDAD >= 0.104553340 AND COL_PRIV < 474.116827 AND UNIVERS < 1219.24829) THEN DUMMY_SOB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('001111','001114','001206','001406','002301','002305','002306','003102','003108','004104','004506','005203','005502','005505','005508','005611','005612','005625','005647','006103','006104','006106','006407','006515','006521','007303','007307','007308','008105','008108','008425','009133','009214') AND COL_PRIV >= 474.116827 AND UNIVERS >= 402.09976) THEN DUMMY_SOB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('001204','001405','002427','003101','004101','004105','004303','004310','004514','004518','004525','004530','005501','005503','005509','005601','005616','005626','006101','006415','006502','006516','007105','007106','007209','007403','008101','008107','008213','008523','008529','009116','009203','009219','009226','009248','009263') AND AREA_CONSTRUIDA >= 61.735 AND COL_PUB >= 752.76283) THEN DUMMY_SOB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('001111','001114','001206','002301','002306','003102','004506','005203','005502','005505','005508','005611','005612','005625','005647','006104','006106','006407','006521','007303','007308','008108','009133','009214') AND AREA_CONSTRUIDA >= 62.205 AND DENSIDAD < 0.104553340 AND CAI >= 1056.35304 AND COL_PRIV < 474.116827 AND PUNTAJE >= 36) THEN DUMMY_SOB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('005203','005612','008108') AND DENSIDAD < 0.046538061 AND CAI < 720.79975 AND COL_PRIV < 474.116827 AND PUNTAJE >= 36) THEN DUMMY_SOB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('001109','001110','001404','002107','002205','003106','004308','006512','007207','007306','008103') AND DENSIDAD < 0.052559739) THEN DUMMY_SOB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('002415','002419','004304','004401','005632','006406','009105') AND AREA_CONSTRUIDA >= 46.435 AND AREA_CONSTRUIDA  <=54.550 AND EDAD < 33 AND PUNTAJE >= 46 AND PUNTAJE <=62) THEN DUMMY_SOB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('002104','005605','005619') AND AREA_CONSTRUIDA >= 54.550 AND UNIVERS >= 1018.64398 AND IN_MIL_POL < 1274.77341) THEN DUMMY_SOB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('004518','005509','005616','008213','009116','009219','009226') AND AREA_CONSTRUIDA >= 56.420 AND COL_PUB < 296.74817 AND CAI < 893.07096 AND EDAD < 32 AND URI_UPJ >= 1296.7837) THEN DUMMY_SOB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('004108','004510','005107','005305') AND DENSIDAD >= 0.052559739) THEN DUMMY_SOB_2020_M01_3 = 1 ;
IF ( CODIGO_BARRIO IN('002304','004108','004510','004511','005603','005617','006210','008407','009201') AND DENSIDAD < 0.052559739 AND EDAD < 11) THEN DUMMY_SOB_2020_M01_3 = 1 ;

/*M02.4. Residencial PH, estrato 4*/

DUMMY_SUB_2020_M02_4 = 0;
DUMMY_SOB_2020_M02_4 = 0;
IF ( CODIGO_BARRIO IN('007206','008406') AND EDAD >= 8 AND PKBOLSIL >= 51.013098 AND PKBOLSIL <=59.579022 AND CAI < 1209.26183) THEN DUMMY_SUB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('005606','006217','006312','006313','006320','006423','007101','008207','008510','008511','008515','008519','008528','009128') AND EDAD >= 37 AND AREA_CONSTRUIDA >= 34.020 AND AREA_CONSTRUIDA <=66.600 AND PKBOLSIL < 688.734609 AND CAI < 758.48553) THEN DUMMY_SUB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('005606','006217','006312','006313','006320','006423','007101','008207','008510','008511','008515','008519','008528','009128') AND AREA_CONSTRUIDA < 32.650 AND PKBOLSIL >= 306.625096 AND PKBOLSIL <=361.139732) THEN DUMMY_SUB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('006311','009114') AND EDAD >= 8 AND PKBOLSIL >= 601.556132) THEN DUMMY_SUB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('005606','006217','006313','006423','008528') AND EDAD >= 6 AND EDAD <=33 AND AREA_CONSTRUIDA >= 34.020 AND AREA_CONSTRUIDA<=110.700 AND PKBOLSIL >= 278.125622 AND PKBOLSIL <=287.516718) THEN DUMMY_SUB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('008503','008518') AND EDAD >= 7 AND EDAD <=8 AND AREA_CONSTRUIDA < 70.000 AND CAI >= 478.90407) THEN DUMMY_SUB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('005104','005105','008204','008205','008503','008518','009108','009122') AND EDAD < 8 AND AREA_CONSTRUIDA >= 76.850 AND PKBOLSIL >= 471.974561) THEN DUMMY_SUB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('005104','005105','008204','008205','008503','008518','009108','009122') AND EDAD < 8 AND AREA_CONSTRUIDA < 70.000 AND CAI >= 230.02602 AND CAI <=478.90407) THEN DUMMY_SUB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('005606','006217','006312','006313','006320','006423','007101','008207','008510','008511','008515','008519','008528','009128') AND AREA_CONSTRUIDA >= 32.650 AND AREA_CONSTRUIDA <=34.020 AND PKBOLSIL >= 306.625096) THEN DUMMY_SUB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('005117','005307','006202','007206','008204','008406','008530','009102','009115','009210') AND EDAD >= 8 AND AREA_CONSTRUIDA >= 33.000 AND AREA_CONSTRUIDA <=40.435 AND PKBOLSIL >= 59.579022 AND PKBOLSIL  <=601.556132 AND CAI < 1209.26183) THEN DUMMY_SUB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('008425') AND EDAD >= 8 AND EDAD <=36 AND PKBOLSIL < 601.556132 AND CAI < 1209.26183) THEN DUMMY_SUB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('005117','005307','006202','007206','008204','008406','008425','008530','009102','009115','009210') AND EDAD >= 8 AND PKBOLSIL < 601.556132 AND CAI >= 1209.26183) THEN DUMMY_SUB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('008503','008518') AND EDAD >= 3 AND EDAD <=5 AND AREA_CONSTRUIDA >= 46.855 AND AREA_CONSTRUIDA <=61.405 AND CAI >= 478.90407) THEN DUMMY_SUB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('005104','005105','008204','008205','008503','008518','009108','009122') AND EDAD < 3 AND AREA_CONSTRUIDA < 70.000 AND CAI >= 478.90407) THEN DUMMY_SUB_2020_M02_4 = 1 ;

IF ( CODIGO_BARRIO IN('005403','006303','006312','007202','008206','008503','008509') AND COL_PUB < 2071.53431 AND EST03 < 731.926160 AND AREA_CONSTRUIDA >= 92.015 AND AREA_CONSTRUIDA <=115.650 AND URI_UPJ >= 4512.8072 AND URI_UPJ <=4894.9041 AND PUNTAJE < 70) THEN DUMMY_SOB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('005403','006303','006312','007202','008205','008206','008503','008509','008511','008515','008518') AND COL_PRIV < 588.137686 AND COL_PUB >= 1261.57290 AND COL_PUB  <=2071.53431 AND EST03 >= 885.977667 AND AREA_CONSTRUIDA >= 62.815 AND URI_UPJ >= 1779.6200) THEN DUMMY_SOB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('006405','008207') AND COL_PRIV >= 463.582402 AND COL_PRIV  <=970.870999 AND COL_PUB < 2267.25399 AND PKVENCIN >= 38.551198 AND PKVENCIN <=463.217963 AND EST03 < 489.652436 AND AREA_CONSTRUIDA >= 59.615 AND AREA_CONSTRUIDA <=73.610 AND URI_UPJ < 5340.8064 AND PUNTAJE >= 73) THEN DUMMY_SOB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('006405','008207') AND COL_PRIV >= 463.582402 AND COL_PRIV <=970.870999 AND COL_PUB < 2267.25399 AND PKVENCIN >= 38.551198 AND PKVENCIN <=463.217963 AND EST03 < 489.652436 AND AREA_CONSTRUIDA >= 78.425 AND URI_UPJ < 5340.8064 AND PUNTAJE >= 73) THEN DUMMY_SOB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('005207','006201','006217','006301','006320','006405','008207','008502','008512','009121','009127','009133') AND COL_PRIV >= 970.870999 AND COL_PUB < 2267.25399 AND PKVENCIN >= 38.551198 AND PKVENCIN <=463.217963 AND EST03 < 489.652436 AND URI_UPJ < 5340.8064) THEN DUMMY_SOB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('005103','005207','005507','006201','006217','006301','006320','006405','008207','008208','008502','008512','009121','009127','009133') AND COL_PRIV >= 146.408705 AND COL_PUB < 2267.25399 AND PKVENCIN < 38.551198 AND AREA_CONSTRUIDA < 91.720) THEN DUMMY_SOB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('005103','005207','005507','006201','006217','006301','006320','006405','008207','008208','008502','008512','009121','009127','009133') AND COL_PRIV < 146.408705 AND COL_PUB < 2267.25399 AND PKVENCIN >= 176.970761 AND PKVENCIN <=463.217963 AND PUNTAJE < 62) THEN DUMMY_SOB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('003102','004502','004551','005101','005102','005103','005104','005107','005110','005111','005113','005117','005207','005305','005306','005307','005402','005403','005506','005507','005603','005606','005607','005663','005668','005669','006110','006201','006202','006208','006209','006216','006217','006301','006302','006303','006311','006312','006313','006316','006319','006320','006405','006502','007102','007103','007105','007106','007201','007202','007203','007206','007208','007209','008105','008201','008202','008203','008204','008205','008206','008207','008208','008212','008306','008425','008501','008502','008503','008506','008508','008509','008510','008511','008512','008515','008518','008519','008521','008525','008526','008532','008533','009102','009103','009104','009105','009106','009108','009110','009113','009114','009115','009116','009117','009120','009121','009122','009127','009128','009129','009130','009133','009135','009210','009211','009212','009214','009215','009219','009241') AND COL_PUB >= 2267.25399) THEN DUMMY_SOB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('005106','007104','008544') AND COL_PRIV >= 591.765320 AND COL_PRIV <=611.425117 AND COL_PUB >= 242.82316 AND PKVENCIN >= 24.279327 AND EST03 >= 66.110552 AND EST03 <=878.544266 AND PUNTAJE >= 47 AND PUNTAJE <=72) THEN DUMMY_SOB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('005105','005106','007205','008406','008528','008530','008544') AND COL_PRIV >= 38.762251 AND COL_PRIV  <=185.121228 AND PKVENCIN >= 24.279327 AND EST03 >= 44.956749 AND AREA_CONSTRUIDA < 73.175 AND PUNTAJE >= 72) THEN DUMMY_SOB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('005401','006423','006512','007101','007207','008107','008517') AND COL_PRIV >= 38.762251 AND COL_PUB >= 633.89084 AND PKVENCIN >= 24.279327 AND EST03 >= 44.956749 AND AREA_CONSTRUIDA >= 108.160 AND PUNTAJE >= 72) THEN DUMMY_SOB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('005401','006423','006512','007101','007207','008107','008517') AND COL_PRIV >= 38.762251 AND COL_PUB >= 588.95705 AND  COL_PUB <=633.89084 AND PKVENCIN >= 24.279327 AND EST03 >= 44.956749 AND AREA_CONSTRUIDA >= 38.330 AND PUNTAJE >= 72) THEN DUMMY_SOB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('004531','005304','007107','007401','008108','008111','008112','008214','008411') AND COL_PRIV >= 138.554334 AND COL_PUB >= 661.56243 AND PKVENCIN >= 24.279327 AND PKVENCIN <=288.870186 AND URI_UPJ < 4808.7748 AND PUNTAJE >= 66 AND PUNTAJE <=75) THEN DUMMY_SOB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('008414','009213') AND AREA_CONSTRUIDA >= 72.930) THEN DUMMY_SOB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('004531','005304','007107','007401','008108','008111','008112','008214','008411') AND COL_PRIV >= 138.554334 AND PKVENCIN >= 24.279327 AND PKVENCIN <=288.870186 AND AREA_CONSTRUIDA >= 89.600 AND AREA_CONSTRUIDA <=117.500 AND URI_UPJ >= 4808.7748) THEN DUMMY_SOB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('006423','007207') AND COL_PRIV >= 38.762251 AND PKVENCIN >= 24.279327 AND EST03 < 66.110552 AND AREA_CONSTRUIDA >= 84.900 AND PUNTAJE >= 47 AND PUNTAJE <=72) THEN DUMMY_SOB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('005403','006303','006312','007202','008205','008206','008503','008509','008511','008515','008518') AND COL_PRIV >= 588.137686 AND COL_PUB < 2071.53431 AND EST03 >= 885.977667 AND AREA_CONSTRUIDA >= 62.815 AND URI_UPJ >= 1779.6200) THEN DUMMY_SOB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('005402','005403','006208','006303','006312','006313','007202','008205','008206','008503','008509','008510','008511','008515','008518','009110') AND COL_PUB >= 2071.53431 AND COL_PUB <=2267.25399 AND AREA_CONSTRUIDA >= 62.815 AND URI_UPJ >= 1779.6200 AND URI_UPJ  <=3888.2757) THEN DUMMY_SOB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('005103','006301','009127','009133') AND COL_PRIV >= 146.408705 AND COL_PRIV <=463.582402 AND COL_PUB < 2267.25399 AND PKVENCIN >= 38.551198 AND PKVENCIN <=463.217963 AND EST03 < 67.380505 AND URI_UPJ < 5340.8064 AND PUNTAJE >= 62) THEN DUMMY_SOB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('005507','008208') AND COL_PRIV >= 463.582402 AND COL_PUB < 2267.25399 AND PKVENCIN >= 38.551198 AND PKVENCIN <=463.217963 AND URI_UPJ < 5340.8064) THEN DUMMY_SOB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('005103','005207','005507','006201','006217','006301','006320','006405','008207','008208','008502','008512','009121','009127','009133') AND COL_PUB < 2267.25399 AND PKVENCIN >= 463.217963) THEN DUMMY_SOB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('005105','005106','005401','006423','006512','007101','007104','007205','007207','008107','008406','008517','008528','008530','008544') AND COL_PRIV >= 38.762251 AND PKVENCIN >= 24.279327 AND URI_UPJ >= 2627.5977 AND PUNTAJE < 47) THEN DUMMY_SOB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('005401','006423','006512','007101','007207','008107','008517') AND COL_PRIV >= 38.762251 AND COL_PUB >= 633.89084 AND PKVENCIN >= 110.586348 AND EST03 >= 44.956749 AND AREA_CONSTRUIDA >= 77.220 AND AREA_CONSTRUIDA <78.050 AND PUNTAJE >= 72) THEN DUMMY_SOB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('007107') AND COL_PRIV >= 38.762251 AND COL_PRIV <=138.554334 AND PKVENCIN >= 24.279327 AND PKVENCIN <=288.870186) THEN DUMMY_SOB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('004531','005304','007107','007401','008108','008111','008112','008214','008411') AND COL_PRIV >= 38.762251 AND PKVENCIN >= 288.870186 AND AREA_CONSTRUIDA >= 60.950) THEN DUMMY_SOB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('004531','005105','005106','005304','005401','006423','006512','007101','007104','007107','007205','007207','007401','008107','008108','008111','008112','008214','008406','008411','008517','008528','008530','008544') AND COL_PRIV >= 38.762251 AND PKVENCIN < 24.279327) THEN DUMMY_SOB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('004531','005105','005106','005304','005401','006423','006512','007101','007104','007107','007205','007207','007401','008107','008108','008111','008112','008214','008406','008411','008517','008528','008530','008544') AND COL_PRIV < 38.762251) THEN DUMMY_SOB_2020_M02_4 = 1 ;
IF ( CODIGO_BARRIO IN('008414','009213') AND AREA_CONSTRUIDA < 66.305) THEN DUMMY_SOB_2020_M02_4 = 1 ;

/*M02.5. Residencial PH, estrato 5*/

DUMMY_SOB_2020_M02_5=0;
DUMMY_SUB_2020_M02_5=0;
IF ( CODIGO_BARRIO IN('008306','008311','008314') AND COORDENADA_Y < 108594.58 AND UNIVERS < 399.76186 AND AREA_CONSTRUIDA >= 146.69 AND AREA_CONSTRUIDA <=160.70) THEN DUMMY_SUB_2020_M02_5 = 1 ;
IF ( CODIGO_BARRIO IN('008306','008311','008314') AND COORDENADA_Y >= 108594.58) THEN DUMMY_SUB_2020_M02_5 = 1 ;
IF ( CODIGO_BARRIO IN('008306','008311','008314') AND COORDENADA_Y < 108594.58 AND UNIVERS < 399.76186 AND AREA_CONSTRUIDA >= 88.55 AND AREA_CONSTRUIDA <=106.15) THEN DUMMY_SUB_2020_M02_5 = 1 ;

IF ( CODIGO_BARRIO IN('008313','008314','008514','009113') AND PKMETROP >= 1457.8911 AND COORDENADA_Y < 119299.43 AND AREA_CONSTRUIDA < 412.87 AND PUNTAJE >= 58 AND PUNTAJE<=60 AND EST06 >= 104.86428 AND PKBOLSIL >= 105.26558) THEN DUMMY_SOB_2020_M02_5 = 1 ;
IF ( CODIGO_BARRIO IN('008313','008314','008514','009113') AND PKMETROP < 1457.8911) THEN DUMMY_SOB_2020_M02_5 = 1 ;
IF ( CODIGO_BARRIO IN('008312','009129') AND PUNTAJE >= 77) THEN DUMMY_SOB_2020_M02_5 = 1 ;


/*M02.6. Residencial PH, estrato 6*/
DUMMY_SOB_2020_M02_6=0;
DUMMY_SUB_2020_M02_6=0;

IF ( COL_PUB >= 161.69336  AND CODIGO_BARRIO IN('008305','008308','008401','008408','008411','008412','008418') AND DENSIDAD >= 0.091469496 AND DENSIDAD<=0.155505738 AND COORDENADA_Y >= 106006.36 AND PKVENCIN >= 249.11913 AND EST01 < 3565.3983 AND PKBOLSIL < 742.53425 AND CLINIC123 < 1378.107 AND PKMETROP >= 3884.3799) THEN DUMMY_SOB_2020_M02_6 = 1 ;
IF ( COL_PUB >= 161.69336 AND CODIGO_BARRIO IN('008305','008308','008401','008408','008411','008412','008418') AND DENSIDAD < 0.155505738 AND COORDENADA_Y >= 106006.36 AND PKVENCIN >= 24.87652 AND EST01 >= 3565.3983) THEN DUMMY_SOB_2020_M02_6 = 1 ;
IF ( COL_PUB >= 161.69336 AND CODIGO_BARRIO IN('008305','008308','008401','008408','008411','008412','008418') AND DENSIDAD < 0.155505738 AND COORDENADA_Y >= 106006.36 AND PKVENCIN >= 24.87652 AND EST01 >=1065.1788 AND EST01<=3565.3983 AND PKBOLSIL < 668.04041 AND CLINIC123 < 1378.107 AND PKMETROP < 3884.3799 AND AREA_CONSTRUIDA >= 31.85 AND PKZONAL >= 2066.2146 AND EST04 >= 794.22607) THEN DUMMY_SOB_2020_M02_6 = 1 ;
IF ( COL_PUB >= 161.69336 AND CODIGO_BARRIO IN('008310','008406','008538','009249') AND DENSIDAD < 0.045474751 AND COORDENADA_Y >= 114250.99 AND UNIVERS >= 1798.9511) THEN DUMMY_SOB_2020_M02_6 = 1 ;
IF ( COL_PUB < 161.69336) THEN DUMMY_SOB_2020_M02_6 = 1 ;
IF ( COL_PUB >= 161.69336 AND CODIGO_BARRIO IN('008305','008308','008401','008408','008411','008412','008418') AND DENSIDAD < 0.155505738 AND COORDENADA_Y >= 106006.36 AND PKVENCIN>=24.87652 AND PKVENCIN<=249.11913 AND EST01 < 3565.3983 AND PKBOLSIL < 742.53425 AND CLINIC123 < 1378.107 AND PKMETROP >= 3884.3799) THEN DUMMY_SOB_2020_M02_6 = 1 ;
IF ( COL_PUB >= 161.69336 AND CODIGO_BARRIO IN('008401') AND DENSIDAD < 0.155505738 AND COORDENADA_Y >= 106006.36 AND PKVENCIN >= 24.87652 AND EST01 < 3565.3983 AND PKBOLSIL >= 742.53425) THEN DUMMY_SOB_2020_M02_6 = 1 ;
IF ( COL_PUB >= 161.69336 AND CODIGO_BARRIO IN('008202','008203','008301','008302','008303','008304','008305','008307','008308','008309','008311','008315','008401','008403','008405','008407','008408','008411','008412','008415','008416','008417','008418','008536','009112','009121','009128','009136','009222','009231') AND DENSIDAD < 0.155505738 AND COORDENADA_Y < 106006.36 AND PKVENCIN >= 24.87652 AND PKVENCIN<102.71714) THEN DUMMY_SOB_2020_M02_6 = 1 ;

IF ( CODIGO_BARRIO IN('008406','008407','008408') AND PUNTAJE >= 88 AND COL_PRIV >= 294.50477) THEN DUMMY_SUB_2020_M02_6 = 1 ;
IF ( CODIGO_BARRIO IN('008301','008304','008403') AND EDAD >= 9 AND EDAD<=54 AND DENSIDAD < 0.0179328261 AND AREA_CONSTRUIDA < 81.34) THEN DUMMY_SUB_2020_M02_6 = 1 ;
IF ( CODIGO_BARRIO IN('008307','008412') AND EDAD < 9 AND PUNTAJE < 75) THEN DUMMY_SUB_2020_M02_6 = 1 ;
IF ( CODIGO_BARRIO IN('008406','008407','008408') AND PUNTAJE >= 59 AND PUNTAJE<=88 AND DENSIDAD >= 0.0070319041 AND DENSIDAD<=0.0080546290) THEN DUMMY_SUB_2020_M02_6 = 1 ;
IF ( CODIGO_BARRIO IN('008315') AND EDAD < 9 AND DENSIDAD < 0.0316449784) THEN DUMMY_SUB_2020_M02_6 = 1 ;



/*M05. Bodegas + Industria PH*/

IF CODIGO_BARRIO IN('008413','008415','008417','008406') THEN DUMMY_STABARBAR=1; ELSE DUMMY_STABARBAR=0;
IF CODIGO_BARRIO IN('008308', '008309','008310','008311') THEN DUMMY_RETIROCHI=1; ELSE DUMMY_RETIROCHI=0;
IF CODIGO_BARRIO IN('006313', '006320') THEN DUMMY_SALITHAYU=1; ELSE DUMMY_SALITHAYU=0;

ARMAZON_FERROCONCRETO=0;
IF ARMAZON_ESTRUCTURA IN ('111','112') AND (COMPLEMENTO_INDUSTRIA IN ('511','512','513','514','515') OR AREA_CONSTRUIDA > 500) THEN ARMAZON_FERROCONCRETO = 1; ELSE DO;
IF ARMAZON_ESTRUCTURA IN ('114','115')  THEN ARMAZON_FERROCONCRETO=1;
END;


CERCHA_LIVIANA =0;
CERCHA_MEDIANA =0;
CERCHA_PESADA =0;
IF COMPLEMENTO_INDUSTRIA IN ('514') AND 0<AREA_CONSTRUIDA <= 10000 THEN CERCHA_MEDIANA =1;
IF COMPLEMENTO_INDUSTRIA NOT IN ('514') AND 0<AREA_CONSTRUIDA <= 1000 THEN CERCHA_LIVIANA =1;
IF COMPLEMENTO_INDUSTRIA IN ('000','') AND   AREA_CONSTRUIDA > 10000  THEN CERCHA_PESADA =1;
IF COMPLEMENTO_INDUSTRIA IN ('000','') AND 0<AREA_CONSTRUIDA <= 10000 THEN CERCHA_LIVIANA =1;
IF COMPLEMENTO_INDUSTRIA IN ('511','512') THEN CERCHA_LIVIANA =1;
IF COMPLEMENTO_INDUSTRIA IN ('513') AND   AREA_CONSTRUIDA > 1000 THEN CERCHA_MEDIANA =1;
IF COMPLEMENTO_INDUSTRIA IN ('514','515') AND AREA_CONSTRUIDA > 10000 THEN CERCHA_PESADA =1;


DUMMY_SOB_2020_M05 = 0 ;
DUMMY_SUB_2020_M05 = 0 ;

IF ( CODIGO_BARRIO IN('003102','006105','006218') AND AREA_CONSTRUIDA < 409.7) THEN DUMMY_SOB_2020_M05 = 1 ;
IF ( CODIGO_BARRIO IN('002104','005637','006313','006320','006507','006521','008407','009107','009123') AND AREA_CONSTRUIDA >= 198.5) THEN DUMMY_SOB_2020_M05 = 1 ;
IF ( CODIGO_BARRIO IN('001204','002306','004105','004201','004203','004630','005201','005207','005634','006215','007102','007106','008214','008314','008417','008515','008526','009106','009116','009122','009211')) THEN DUMMY_SOB_2020_M05 = 1 ;

IF ( CODIGO_BARRIO IN('005304','005403','006212','006313','006320','007402','008101') AND AREA_CONSTRUIDA >= 308.04 AND AREA_CONSTRUIDA <=543.70) THEN DUMMY_SUB_2020_M05 = 1 ;
IF ( CODIGO_BARRIO IN('002309','002401','003201','005507','006217','008212','008415','009110','009212')) THEN DUMMY_SUB_2020_M05 = 1 ;
IF ( CODIGO_BARRIO IN('005304','005403','006212','006313','006320','007402','008101') AND AREA_CONSTRUIDA >= 9.40 AND AREA_CONSTRUIDA <= 71.30) THEN DUMMY_SUB_2020_M05 = 1 ;
IF ( CODIGO_BARRIO IN('005304','005403','006212','006313','006320','007402','008101','009115','009136') AND AREA_CONSTRUIDA < 9.40) THEN DUMMY_SUB_2020_M05 = 1 ;

/*M03. Oficinas PH*/
DUMMY_SOB_2020_M03=0;
DUMMY_SUB_2020_M03=0;
DUMMY_ESPNORTE=0;
IF CODIGO_BARRIO='006303' THEN DUMMY_ESPNORTE=1;

IF ( CODIGO_BARRIO IN('003108','007204','008101','009127') AND CAI < 1476.5992 AND AREA_CONSTRUIDA >= 13.91 AND AREA_CONSTRUIDA <=48.35 AND DENSIDAD >= 0.091061815) THEN DUMMY_SOB_2020_M03 = 1 ;
IF ( CODIGO_BARRIO IN('003102','008414','008415','008514') AND CAI < 1476.5992 AND AREA_CONSTRUIDA >= 212.50) THEN DUMMY_SOB_2020_M03 = 1 ;
IF ( CODIGO_BARRIO IN('003102','003108','003109','004103','007204','008101','008301','008313','008411','008414','008415','008514','009124','009127') AND CAI >= 1476.5992) THEN DUMMY_SOB_2020_M03 = 1 ;
IF ( CODIGO_BARRIO IN('004101','004104','004209','005402','006103','007208','007403','008208','008501','008507','008512','008513','008530','009207') AND PKVENCIN < 234.5897) THEN DUMMY_SOB_2020_M03 = 1 ;

IF ( CODIGO_BARRIO IN('003102','003107','004101','004103','004110','005507','007107','008107','008109','008202','008314','008404','008406','008407','008411','008515','009118','009126') AND EST05 < 22.479371 AND PUNTAJE < 83 AND COL_PRIV < 503.54636) THEN DUMMY_SUB_2020_M03 = 1 ;
IF ( CODIGO_BARRIO IN('003102','003107','004101','004103','004110','005507','007107','008107','008109','008202','008314','008404','008406','008407','008411','008515','009118','009126') AND PUNTAJE >= 83) THEN DUMMY_SUB_2020_M03 = 1 ;
IF ( CODIGO_BARRIO IN('003108','003109','003110','008306','008412') AND EST05 >= 28.055870 AND PKBOLSIL >= 28.375272 AND AREA_CONSTRUIDA >= 11.205 AND AREA_CONSTRUIDA <=35.850 AND IN_MIL_POL >= 755.75683 AND IN_MIL_POL<=810.44199) THEN DUMMY_SUB_2020_M03 = 1 ;
IF ( CODIGO_BARRIO IN('004110','005507','007107','008109','008314') AND EST05 >= 22.479371 AND PUNTAJE < 64) THEN DUMMY_SUB_2020_M03 = 1 ;


/*M04. Comercio PH*/
DUMMY_SUB_2020_M04=0;
DUMMY_SOB_2020_M04=0;
NUMERO_PISO_01=0;
NUMERO_PISO_02=0;
IF NUMERO_PISO=1 THEN NUMERO_PISO_01=1;
IF NUMERO_PISO=2 THEN NUMERO_PISO_02=1;
IF ( CODIGO_BARRIO IN('001402','003103','003107','004107','004108','004203','004507','004511','005606','005614','005623','005657','006408','007403','008201','008313','008417','009228') AND AREA_CONSTRUIDA < 66.88 AND PKVENCIN >= 51.463132 AND PKZONAL>= 896.92302 AND PKZONAL<=935.75011) THEN DUMMY_SOB_2020_M04 = 1 ;
IF ( CODIGO_BARRIO IN('005509','008309') AND AREA_CONSTRUIDA < 66.88 AND PKVENCIN >= 51.463132 AND DENSIDAD < 0.047079844) THEN DUMMY_SOB_2020_M04 = 1 ;
IF ( CODIGO_BARRIO IN('003107','005606','008307','008309','008417') AND AREA_CONSTRUIDA >= 66.88 AND PKVENCIN < 155.110333) THEN DUMMY_SOB_2020_M04 = 1 ;
IF ( CODIGO_BARRIO IN('001204','002103','003108','003109','005502','006103','006201','007206','008207','008312','008315','008418','008518','009111') AND PKMETROP < 3148.5293 AND CAI >= 45.712544 AND COL_PUB >= 165.27407 AND EDAD >= 50 AND RFREGION >= 12565.718) THEN DUMMY_SOB_2020_M04 = 1 ;
IF ( CODIGO_BARRIO IN('001204','002103','003108','003109','005502','006103','006201','007206','008207','008312','008315','008418','008518','009111') AND PKMETROP < 3148.5293 AND CAI >= 45.712544 AND COL_PUB < 165.27407) THEN DUMMY_SOB_2020_M04 = 1 ;
IF ( CODIGO_BARRIO IN('001204','002103','003108','003109','005502','006103','006201','007206','008207','008312','008315','008418','008518','009111') AND PKMETROP < 3148.5293 AND CAI < 45.712544) THEN DUMMY_SOB_2020_M04 = 1 ;
IF ( CODIGO_BARRIO IN('001204','002103','003108','003109','005502','006103','006201','007206','008207','008312','008315','008418','008518','009111') AND PKMETROP >= 3148.5293) THEN DUMMY_SOB_2020_M04 = 1 ;
IF ( CODIGO_BARRIO IN('002301','003107','004105','004106','004108','005203','005606','005614','005657','006104','007403','008201','008202','008307','008309','008417','008523','009228') AND AREA_CONSTRUIDA >= 66.88 AND PKVENCIN >= 300.693524) THEN DUMMY_SOB_2020_M04 = 1 ;
IF ( CODIGO_BARRIO IN('001301','001402','002301','003103','003107','004105','004106','004107','004108','004203','004505','004507','004511','004520','004584','005203','005509','005606','005614','005623','005657','006104','006405','006408','007403','008201','008202','008307','008309','008313','008417','008523','009228','009234') AND AREA_CONSTRUIDA < 66.88 AND PKVENCIN < 51.463132) THEN DUMMY_SOB_2020_M04 = 1 ;
IF ( CODIGO_BARRIO IN('001301','004105','004106','004505','004520','004584','005509','006104','006405','008202','008307','008309','009234') AND AREA_CONSTRUIDA < 66.88 AND PKVENCIN >= 51.463132 AND DENSIDAD >=0.047079844 AND DENSIDAD<=0.067006640) THEN DUMMY_SOB_2020_M04 = 1 ;
IF ( CODIGO_BARRIO IN('001402','003103','004203','004507','004511','005623','008313') AND AREA_CONSTRUIDA >= 66.88) THEN DUMMY_SOB_2020_M04 = 1 ;
IF ( CODIGO_BARRIO IN('001211','002533','004403','004618','005117','005401','006105','006218','008515','008517','009209') AND CLINIC123 >= 369.18611) THEN DUMMY_SOB_2020_M04 = 1 ;

IF ( CODIGO_BARRIO IN('003107','004103','004109','004111','004503','005601','005626','008108','008202','008311','008414','008512','009105') AND EST02 < 1307.5545 AND RSDJ < 8202.9155) THEN DUMMY_SUB_2020_M04 = 1 ;
IF ( CODIGO_BARRIO IN('003105','004630','006212','008306','008310','008312','009133') AND EST02 < 1307.5545 AND AREA_CONSTRUIDA < 150.66 AND PKBOLSIL < 414.31314) THEN DUMMY_SUB_2020_M04 = 1 ;
IF ( CODIGO_BARRIO IN('001204','003108','004101','006301','007101','008201','008301','008308','008412','009130') AND AREA_CONSTRUIDA < 18.00 AND EST03 >= 33.708349) THEN DUMMY_SUB_2020_M04 = 1 ;
IF ( CODIGO_BARRIO IN('003107','004103','004109','004111','004503','005601','005626','008108','008202','008311','008414','008512','009105') AND EST02 < 1307.5545 AND RSDJ >= 8202.9155 AND IN_MIL_POL < 487.79808 AND PUNTAJE >= 61) THEN DUMMY_SUB_2020_M04 = 1 ;
IF ( CODIGO_BARRIO IN('003105','004630','006212','008306','008310','008312','009133') AND EST02 < 1307.5545 AND AREA_CONSTRUIDA >= 150.66) THEN DUMMY_SUB_2020_M04 = 1 ;
IF ( CODIGO_BARRIO IN('006106','006315','008416','008502','009220','009266')) THEN DUMMY_SUB_2020_M04 = 1 ;

/*M06.Bifamiliar_123*/

DUMMY_SUB_2020_M06_123=0;
DUMMY_SOB_2020_M06_123=0;

IF ( CODIGO_BARRIO IN ('001204','002311','002415','002537','002540','004402','004406','004621','005665','005670','006502') AND AREA_CONSTRUIDA >= 147.80) THEN DUMMY_SOB_2020_M06_123 = 1 ;
IF ( CODIGO_BARRIO IN ('001402','002519','002572','004204','004412','004597','009212') AND AREA_CONSTRUIDA >= 73.22) THEN DUMMY_SOB_2020_M06_123 = 1 ;
IF ( CODIGO_BARRIO IN ('001204','002311','002415','002537','002540','004402','004406','004621','005665','005670','006502') AND AREA_CONSTRUIDA < 46.25) THEN DUMMY_SOB_2020_M06_123 = 1 ;
IF ( CODIGO_BARRIO IN ('001205','001403','001423','001431','002102','002107','002536','002538','002570','002620','004108','004306','004584','004595','004617','005104','005601','005607','005627','005647','006301','006407','008502','008507','009107','009108','009224','009232','009262')) THEN DUMMY_SOB_2020_M06_123 = 1 ;

IF ( CODIGO_BARRIO IN ('002311','002555','004413','004550','004594','004633','004634','005614','005675','009206') AND 133.96442 <= COL_PUB <= 169.80281 AND AREA_CONSTRUIDA >= 57.85) THEN DUMMY_SUB_2020_M06_123 = 1 ;
IF ( CODIGO_BARRIO IN ('001111','001414','001428','002204','002409','004403','004504','004545','005620') AND COL_PUB >= 210.80479) THEN DUMMY_SUB_2020_M06_123 = 1 ;
IF ( CODIGO_BARRIO IN ('001203','001356','004401','004513','005602','005625','006410','006505','009106')) THEN DUMMY_SUB_2020_M06_123 = 1 ;


/*M06.Bifamiliar_456*/
DUMMY_SUB_2020_M06_456=0;
DUMMY_SOB_2020_M06_456=0;

IF ( CODIGO_BARRIO IN('005304','005401','005507','006208','008414','008415','008418','008508','008513','008519','009111','009112','009118','009124','009129') AND PKBOLSIL < 160.46471 AND COL_PUB < 1143.6857 AND RFREGION < 2978.3055) THEN DUMMY_SOB_2020_M06_456 = 1 ;
IF ( CODIGO_BARRIO IN('006201','008302','008304','008407','008417','009113','009116') AND ZHF_12_ACT_ECON_COM = 0 AND DENSIDAD < 0.0087562357 AND COL_PRIV < 306.94611) THEN DUMMY_SOB_2020_M06_456 = 1 ;
IF ( CODIGO_BARRIO IN('005304','005401','005507','006208','008414','008415','008418','008508','008513','008519','009111','009112','009118','009124','009129') AND PKBOLSIL >= 160.46471 AND EST05 < 1238.5969 AND PKVENCIN >= 198.66313 AND EDAD < 30) THEN DUMMY_SOB_2020_M06_456 = 1 ;
IF ( CODIGO_BARRIO IN('005304','005401','005507','006208','008414','008415','008418','008508','008513','008519','009111','009112','009118','009124','009129') AND PKBOLSIL >= 160.46471 AND EST05 < 1238.5969 AND PKVENCIN>= 49.48523 AND PKVENCIN <=198.66313 AND PUNTAJE < 73 AND PKZONAL < 395.46215 AND CLINIC123 >= 1022.88) THEN DUMMY_SOB_2020_M06_456 = 1 ;
IF ( CODIGO_BARRIO IN('005304','005401','005507','006208','008414','008415','008418','008508','008513','008519','009111','009112','009118','009124','009129') AND PKBOLSIL >= 160.46471 AND EST05 < 1238.5969 AND PKVENCIN < 49.48523 AND PUNTAJE < 50) THEN DUMMY_SOB_2020_M06_456 = 1 ;
IF ( CODIGO_BARRIO IN('005304','005401','005507','006208','008414','008415','008418','008508','008513','008519','009111','009112','009118','009124','009129') AND PKBOLSIL >= 160.46471 AND EST05 < 1238.5969 AND PKVENCIN >= 198.66313 AND PUNTAJE < 49 AND EDAD >= 30) THEN DUMMY_SOB_2020_M06_456 = 1 ;
IF ( CODIGO_BARRIO IN('005111','006201','006216','007104','008207','008302','008304','008407','008417','008530','009113','009116','009210','009222') AND ZHF_12_ACT_ECON_COM = 1) THEN DUMMY_SOB_2020_M06_456 = 1 ;
IF ( CODIGO_BARRIO IN('005304','005401','005507','006208','008414','008415','008418','008508','008513','008519','009111','009112','009118','009124','009129') AND PKBOLSIL < 160.46471 AND COL_PUB >= 1143.6857) THEN DUMMY_SOB_2020_M06_456 = 1 ;
IF ( CODIGO_BARRIO IN('005111','008207','009210','009222') AND ZHF_12_ACT_ECON_COM = 0 AND DENSIDAD < 0.0087562357) THEN DUMMY_SOB_2020_M06_456 = 1 ;


IF ( CODIGO_BARRIO IN('005507','005606','006312','008415','008417','008512','008514','009111','009123','009129') AND AREA_CONSTRUIDA>= 143.100 AND AREA_CONSTRUIDA<=183.450 AND DENSIDAD >= 0.0027890749 AND COL_PUB < 1564.4259 AND PKBOLSIL >= 378.76056 AND EST06 < 5388.5793 AND PKVENCIN >= 241.57514 AND CAI >= 332.43277) THEN DUMMY_SUB_2020_M06_456 = 1 ;
IF ( CODIGO_BARRIO IN('005507','005606','006312','008415','008417','008512','008514','009111','009123','009129') AND AREA_CONSTRUIDA < 410.625 AND DENSIDAD >= 0.0027890749 AND COL_PUB < 1564.4259 AND PKBOLSIL >= 378.76056 AND EST06 < 5388.5793 AND CAI < 332.43277 AND CLINIC123 < 1023.5847) THEN DUMMY_SUB_2020_M06_456 = 1 ;
IF ( CODIGO_BARRIO IN('005507','005606','006312','008415','008417','008512','008514','009111','009123','009129') AND AREA_CONSTRUIDA >= 410.625) THEN DUMMY_SUB_2020_M06_456 = 1 ;
IF ( CODIGO_BARRIO IN('005106','005401','008403','008404','008418','008510','008515','009112','009113','009116','009124') AND AREA_CONSTRUIDA >= 174.950 AND PUNTAJE < 56) THEN DUMMY_SUB_2020_M06_456 = 1 ;
IF ( CODIGO_BARRIO IN('008401','008538','009125') AND AREA_CONSTRUIDA >= 174.950) THEN DUMMY_SUB_2020_M06_456 = 1 ;
IF ( CODIGO_BARRIO IN('005106','005401','006302','008401','008403','008404','008418','008510','008515','008538','009112','009113','009116','009124','009125') AND AREA_CONSTRUIDA < 174.950 AND DENSIDAD >= 0.0027867295 AND PKVENCIN < 273.59353 AND EDAD >= 45) THEN DUMMY_SUB_2020_M06_456 = 1 ;
IF ( CODIGO_BARRIO IN('005106','005401','006302','008401','008403','008404','008418','008510','008515','008538','009112','009113','009116','009124','009125') AND AREA_CONSTRUIDA < 174.950 AND DENSIDAD >= 0.0027867295 AND PKVENCIN >= 273.59353) THEN DUMMY_SUB_2020_M06_456 = 1 ;
IF ( CODIGO_BARRIO IN('005106','005401','006302','008401','008403','008404','008418','008510','008515','008538','009112','009113','009116','009124','009125') AND AREA_CONSTRUIDA < 174.950 AND DENSIDAD < 0.0027867295) THEN DUMMY_SUB_2020_M06_456 = 1 ;

RUN;

/**************************************************************************************************************/
/*10. CÁLCULO DE VALORES INTEGRALES DE LOS MODELOS. */
/**************************************************************************************************************/


DATA PREDIO_VISTA_MODELOS; SET PRUEBA.PREDIO_VISTA_DUMMIES; /*PROGRAMACION MODELOS*/
		
IF MODELO_0='M01_1' THEN VALOR_INTEGRAL_20&VIGENCIA_2.= EXP(14.04973889416170000000	+
	PUNTAJE	*	0.00636248159800253000	+
	EDAD	*	-0.01576136521462360000	+
	AREA_CONSTRUIDA	*	-0.00173610422256434000	+
	USO_038	*	0.36032636637732400000	+
	COL_PUB	*	-0.00063873829197984800	+
	COL_PRIV	*	-0.00042746134680381100	+
	PKZONAL	*	0.00017269888141717400	+
	EST02	*	-0.00020254310957567800	+
	EST03	*	-0.00013534108830516300	+
	RELACION_AREA	*	-0.04741698832117760000	+
	SAN_CRISTOBAL	*	0.70235989976949500000	+
	USME	*	0.05701637708352630000	+
	BOSA	*	-0.39781591138835800000	+
	C_BOLIVAR	*	0.36520290700187400000	+
	P_ARANDA	*	-0.85722155422671700000	+
	ZHF_1213_12	*	0.24388955273662900000	+
	ZHF_1213_13	*	0.32932299066752200000	+
	AREA_ACT2	*	0.39091365010007700000	+
	ZMPA_50_100	*	0.18891068801537800000	+
	URI_UPJ	*	0.00005585710040786120	+
	GA3	*	0.19151186718737600000	+
	ZHF_4_TRAT_DESARR	*	-0.06944683650618790000	+
	NUMERO_UNIDADES_RES_BMP	*	0.00015592070578775700	+
	PUNTAJE*SAN_CRISTOBAL	*	-0.02461337060376920000	+
	PUNTAJE*USME	*	-0.01063059523695850000	+
	EDAD*USME	*	0.01034294698171330000	+
	EST03*BOSA	*	0.00023213692992406000	+
	USME*ZHF_1213_12	*	0.07919274682874340000	+
	PUNTAJE*AREA_ACT2	*	-0.00789403378687291000	);

IF MODELO_0='M01_2' THEN VALOR_INTEGRAL_20&VIGENCIA_2.=EXP(10.63517896199250000000000	+
AREA_CONSTRUIDA	*	-0.00816188341732546000000	+
	EDAD	*	-0.00499159869116227000000	+
DUMMY_CRUCBER	*	0.17456729739094700000000	+
DUMMY_CONCORDIA	*	0.46549895622315000000000	+
DUMMY_TINTAL	*	-0.11583755976231000000000	+
DUMMY_EGIPTOAGUAS	*	0.39916356800656800000000	+
COORDENADA_X	*	0.00002313014251994930000	+
COORDENADA_Y	*	0.00002118921997489570000	+
COL_PRIV	*	-0.00008693733502091170000	+
PKBOLSIL	*	0.00005985878103921700000	+
	URI_UPJ	*	-0.00001087321663148550000	+
ZMPA_M_100	*	0.03422123383722640000000	+
CENTCOMERC_100_200	*	0.08097895394759460000000	+
CENTCOMERC_200_500	*	0.04259991444603760000000	+
IN_MIL_POL	*	-0.00004511101316547250000	+
	PKZONAL	*	0.00001017479684668360000	+
ESTACTM_200_500	*	0.04922562064968330000000	+
	EST03	*	-0.00004350580900221060000	+
TUNJUELITO	*	0.29663156423301400000000	+
	BOSA	*	0.14949894466861800000000	+
	KENNEDY	*	0.32368394115383200000000	+
MARTIRES	*	-0.21469749436006600000000	+
	Tip4	*	-0.06252857141809520000000	+
	GA3	*	0.01796400696228680000000	+
	GB1	*	-0.09366101673349170000000	+
	GB2	*	-0.02703361602392350000000	+
ZHF_4_TRAT_CONSERV	*	-0.22633567011891000000000	+
ZHF_4_TRAT_MEJ	*	-0.01711895904693660000000	+
ZHF_10_EST_VIA_REG	*	-0.01509633891617520000000	+
ZHF_11_INF_VIA_LOCAL	*	-0.03864662797158310000000	+
ZHF_1213_13	*	0.02449934451857520000000	+
ZHF_1213_17	*	0.05553020442060160000000	+
ZHF_1213_32	*	0.14206792535443500000000	+
	SUBA	*	-0.09646000959308740000000	+
C_BOLIVAR	*	0.56520407533793400000000	+
	SANTAFE	*	-0.12198834654173100000000	+
SAN_CRISTOBAL	*	0.10435868259718800000000	+
	USME	*	0.27669778238828700000000	+
FONTIBON	*	0.20014398557997000000000	+
ENGATIVA	*	-0.03218318018081240000000	+
CANDELARIA	*	-0.16408811610632500000000	+
RAFAEL_U_U	*	0.00147353983120915000000	+
	PUNTAJE	*	0.00005256466586046330000	+
NUMERO_UNIDADES_BMP	*	-0.00000565583908078499000	+
DUMMY_SUB_2020_M01_2	*	0.18029921453520600000000	+
DUMMY_SOB_2020_M01_2 	*	-0.16275107948210400000000	+
AREA_CONSTRUIDA*SANTAFE	*	0.00918212004002447000000	+
AREA_CONSTRUIDA*SAN_CRISTOBAL	*	0.00572271457612385000000	+
AREA_CONSTRUIDA*USME	*	0.00441860137394329000000	+
AREA_CONSTRUIDA*BOSA	*	0.00732249584105746000000	+
AREA_CONSTRUIDA*KENNEDY	*	0.00422787574541938000000	+
AREA_CONSTRUIDA*FONTIBON	*	0.00464925695597629000000	+
AREA_CONSTRUIDA*ENGATIVA	*	0.00559720974508476000000	+
AREA_CONSTRUIDA*SUBA	*	0.00342545046386568000000	+
AREA_CONSTRUIDA*MARTIRES	*	0.00789541735644716000000	+
AREA_CONSTRUIDA*CANDELARIA	*	0.01228188967863760000000	+
AREA_CONSTRUIDA*RAFAEL_U_U	*	0.00886852498524119000000	+
TUNJUELITO*PUNTAJE	*	0.00582655334410607000000	+
SANTAFE*NUMERO_UNIDADES_BMP	*	-0.00057063324835980500000);

IF MODELO_0='M01_3' THEN VALOR_INTEGRAL_20&VIGENCIA_2.=EXP(	13.840427157342500	+	
USO_037	*	0.04011179185436820000000	+
PUNTAJE	*	0.00434167211309804000000	+
EDAD	*	-0.00523207552780406000000	+
COORDENADA_X	*	0.00000988119587956949000	+
DENSIDAD	*	0.72249083327062100000000	+
RELACION_AREA	*	-0.02450277303967420000000	+
EST05	*	-0.00004287189904464530000	+
EST04	*	-0.00001813337894246940000	+
RFREGION	*	0.00002225379598146520000	+
AREA_CONSTRUIDA	*	-0.00307437618116962000000	+
NUMERO_UNIDADES_RES_BMP	*	-0.00001965141704900030000	+
EST02	*	0.00006248384988358980000	+
COL_PUB	*	0.00006405219827504240000	+
EST01	*	0.00001505580438691840000	+
TEUSAQUILLO	*	0.18460290154496400000000	+
AREA_ACT5	*	0.80656842601821900000000	+
SANTAFE	*	-0.78251887890064800000000	+
PKVENCIN	*	-0.00007866391419015220000	+
CHAPINERO	*	0.03796824187356960000000	+
TUNJUELITO	*	0.17154744161810400000000	+
ENGATIVA	*	0.22365167995009700000000	+
CANDELARIA	*	-0.95713624577718800000000	+
C_BOLIVAR	*	0.07923626768066100000000	+
ZHF_1213_23	*	-0.12967165306338800000000	+
ZHF_4_TRAT_CONSOL	*	0.02626038381831740000000	+
ZHF_4_TRAT_DESARR	*	0.01646143397245850000000	+
ZHF_4_TRAT_CONSERV	*	0.09673226037930350000000	+
ZHF_6_TOPOG_INCL	*	0.10559978942009300000000	+
ZHF_6_TOPOG_PLANA	*	0.10714054806408400000000	+
ZHF_11_INF_VIA_ZO_INT	*	-0.01654971371700640000000	+
ZHF_11_INF_VIA_ART_COM	*	0.03703394738809900000000	+
MARTIRES	*	-0.13949646556462000000000	+
SUBA	*	-0.01409441158242320000000	+
ZHF_10_EST_VIA_REG	*	-0.00638651197599465000000	+
ZHF_1213_14	*	0.04707872842700530000000	+
ZHF_1213_17	*	0.03994177587449190000000	+
B_UNIDOS	*	0.16683179022183700000000	+
A_NARINO	*	0.09458643802808890000000	+
P_ARANDA	*	-0.08133586337831500000000	+
RAFAEL_U_U	*	0.06242986400987520000000	+
ZHF_1213_13	*	0.01189425657159780000000	+
SAN_CRISTOBAL	*	0.01934428125577200000000	+
KENNEDY	*	0.00417747520761352000000	+
AREA_ACT2	*	0.00560883750814369000000	+
DUMMY_SOB_2020_M01_3	*	-0.15819802709915200000000	+
DUMMY_SUB_2020_M01_3	*	0.19491789169572500000000	+
PUNTAJE*ENGATIVA	*	-0.00149527781633362000000	+
PUNTAJE*MARTIRES	*	0.00361635128901034000000	+
EDAD*SANTAFE	*	-0.00270018967941219000000	+
EDAD*B_UNIDOS	*	-0.00527545773764376000000	+
EDAD*RAFAEL_U_U	*	0.00191238389399517000000	+
RELACION_AREA*SANTAFE	*	0.03358499469071070000000	+
RELACION_AREA*CHAPINERO	*	0.05834012473181430000000	+
RELACION_AREA*ENGATIVA	*	-0.02726612672919160000000	+
RELACION_AREA*SUBA	*	0.01947494190369970000000	+
RELACION_AREA*MARTIRES	*	0.02604645147609000000000	+
RELACION_AREA*CANDELARIA	*	0.05095450366621100000000	+
RELACION_AREA*RAFAEL_U_U	*	-0.02976190884688340000000	+
AREA_CONSTRUIDA*A_NARINO	*	-0.00134523004944447000000	+
AREA_CONSTRUIDA*SANTAFE	*	0.00256979949387841000000	+
AREA_CONSTRUIDA*TUNJUELITO	*	-0.00313112711774239000000	+
AREA_CONSTRUIDA*CANDELARIA	*	0.00454408538231238000000	+
P_ARANDA*ZHF_1213_13	*	0.03757095034123050000000	+
ZHF_10_EST_VIA_REG*P_ARANDA	*	0.02956866544670870000000	+
TEUSAQUILLO*AREA_ACT5	*	-0.67940634010313300000000	+
ZHF_1213_14*A_NARINO	*	0.11741369058948600000000	+
SANTAFE*ZHF_4_TRAT_CONSOL	*	0.11381065822618800000000	+
SANTAFE*ZHF_6_TOPOG_INCL	*	0.21724419608881400000000	+
SANTAFE*ZHF_10_EST_VIA_REG	*	-0.16030435299380900000000	+
SANTAFE*ZHF_11_INF_VIA_ART_COM	*	0.12749867629674900000000	+
ZHF_4_TRAT_CONSERV*SAN_CRISTOBAL	*	-0.13897931902475400000000	+
ZHF_6_TOPOG_INCL*SAN_CRISTOBAL	*	-0.09218835002739860000000	+
ZHF_11_INF_VIA_ART_COM*SAN_CRISTOBAL	*	-0.10347984665588300000000	+
TUNJUELITO*ZHF_4_TRAT_CONSOL	*	0.10285174761078000000000	+
KENNEDY*AREA_ACT2	*	-0.06195167537575520000000	+
ZHF_1213_13*KENNEDY	*	-0.03152683201861780000000	+
ZHF_11_INF_VIA_ZO_INT*KENNEDY	*	-0.04664709702319950000000	+
ZHF_11_INF_VIA_ART_COM*KENNEDY	*	0.17539998330599100000000	+
ZHF_11_INF_VIA_ART_COM*SUBA	*	-0.06856513147663310000000	+
ZHF_4_TRAT_CONSOL*MARTIRES	*	-0.12479385906079000000000	+
MARTIRES*ZHF_10_EST_VIA_REG	*	-0.13514689588871800000000	+
ZHF_1213_17*RAFAEL_U_U	*	0.08607062724570270000000	);	
	

IF MODELO_0='M02_4' THEN VALOR_INTEGRAL_20&VIGENCIA_2.=EXP(	 19.0319260080453000000000000 	+		
COORDENADA_Y	*	-0.0000321688299713395000000 	+
EDAD	*	-0.0085560173370937000000000 	+
PUNTAJE	*	 0.0019885804595374600000000 	+
EST05	*	-0.0000250487003342691000000 	+
IN_MIL_POL	*	 0.0000406051099932231000000 	+
CLINIC123_M_500	*	 0.0191877519856940000000000 	+
RELACION_AREA	*	 0.0122855746865559000000000 	+
EST06	*	-0.0000253339526538584000000 	+
DENSIDAD	*	-0.2383514425971280000000000 	+
EST01	*	 0.0000416497055203498000000 	+
RFNAL	*	-0.0000159073503143320000000 	+
CAI	*	 0.0000258909414909079000000 	+
AREA_CONSTRUIDA	*	-0.0012831528773318800000000 	+
GA4	*	 0.0150683469356925000000000 	+
USO_037	*	 0.0541828947797290000000000 	+
CONSERVACION_N	*	-0.0673204504969733000000000 	+
COL_PUB	*	 0.0000326940915920791000000 	+
CLINIC123_100_200	*	-0.0286825456196759000000000 	+
CENTCOMERC_200_500	*	 0.0147318293407158000000000 	+
ZMPA_0_50	*	-0.0202968634342009000000000 	+
ZMPA_50_100	*	-0.0113923659776097000000000 	+
ZHF_1213_13	*	-0.0498594866321690000000000 	+
ZHF_1213_14	*	 0.0164847477203125000000000 	+
ZHF_1213_15	*	 0.0392544958791219000000000 	+
CHAPINERO	*	 0.0559212011358082000000000 	+
FONTIBON	*	-0.1220523852398290000000000 	+
TEUSAQUILLO	*	-0.0778107486035037000000000 	+
AREA_ACT6	*	 0.0147884731455124000000000 	+
ENGATIVA	*	-0.0529389083324888000000000 	+
B_UNIDOS	*	-0.0070763688073240500000000 	+
KENNEDY	*	 0.0003205030939617710000000 	+
SANTAFE	*	 0.0559059249798820000000000 	+
SUBA	*	-0.0032643083517399700000000 	+
USAQUEN	*	 0.0055821577641559800000000 	+
P_ARANDA	*	-0.0902047480125641000000000 	+
DUMMY_SOB_2020_M02_4	*	-0.1424197972370070000000000 	+
DUMMY_SUB_2020_M02_4	*	 0.1738281965129790000000000 	+
EDAD*FONTIBON	*	 0.0057137657128554000000000 	+
EDAD*ENGATIVA	*	-0.0016684971156938500000000 	+
RELACION_AREA*TEUSAQUILLO	*	 0.0077051604307748500000000 	+
RELACION_AREA*B_UNIDOS	*	-0.0255577254069886000000000 	+
RELACION_AREA*FONTIBON	*	 0.0491589374512531000000000 	+
RELACION_AREA*KENNEDY	*	-0.0718861827974358000000000 	+
DENSIDAD*FONTIBON	*	-0.6109258105449380000000000 	+
DENSIDAD*SANTAFE	*	 0.5771002265337180000000000 	+
AREA_CONSTRUIDA*TEUSAQUILLO	*	-0.0004097464032218230000000 	+
AREA_CONSTRUIDA*FONTIBON	*	 0.0004488192095336930000000 	+
AREA_CONSTRUIDA*CHAPINERO	*	-0.0003467287411243650000000 	+
AREA_CONSTRUIDA*SANTAFE	*	-0.0012886619179226000000000 	+
AREA_CONSTRUIDA*SUBA	*	-0.0003628172485268150000000 	+
ZHF_1213_15*TEUSAQUILLO	*	 0.1702096455921140000000000 	+
ZHF_1213_14*FONTIBON	*	-0.1007013315460500000000000 	+
ZHF_1213_15*FONTIBON	*	-0.0499544238661722000000000 	+
ZHF_1213_15*USAQUEN	*	-0.0345663798053567000000000 	+
AREA_ACT6*SUBA	*	-0.0367033701325298000000000 	+
ZHF_1213_15*P_ARANDA	*	 0.0966621760176500000000000 	)
;

IF MODELO_0='M02_5' THEN VALOR_INTEGRAL_20&VIGENCIA_2. = EXP(	17.681101023507600	 + 	
VALOR_REFERENCIA_2020	*	 0.0000000251839062566821 	+
EDAD	*	-0.0069066234020468600000 	+
PKVENCIN	*	 0.0001655111014394780000 	+
COORDENADA_Y	*	-0.0000102232223919153000 	+
EST06	*	-0.0000482221617594664000 	+
COORDENADA_X	*	-0.0000126754987008382000 	+
ZHF_1213_16	*	 0.0540450955307823000000 	+
PKZONAL	*	-0.0000115043662956265000 	+
PKMETROP	*	 0.0000254182582686587000 	+
CENTCOMERC_200_500	*	 0.0311390328283972000000 	+
EST03	*	 0.0000218087463212215000 	+
GB4	*	 0.0139003099359615000000 	+
COL_PRIV	*	-0.0000530963175808804000 	+
USO_037	*	 0.0611785105882057000000 	+
CONSERVACION_N	*	 0.1097901140032740000000 	+
CONSERVACION_I	*	 0.2347428451819950000000 	+
PISO_4_5	*	 0.0084225340856776600000 	+
PISO_11_20	*	 0.0487278545461250000000 	+
PISO_6_10	*	 0.0122907800186116000000 	+
UNIVERS	*	-0.0000304317752476789000 	+
CENTCOMERC_M_500	*	 0.0412969485256782000000 	+
ZHF_1213_14	*	 0.1809566418262370000000 	+
ZHF_1213_15	*	 0.1433405775818430000000 	+
ZHF_1213_18	*	 0.0645742746342450000000 	+
ZHF_1213_21	*	-0.0141379153575143000000 	+
ZHF_1213_23	*	-0.0646335994253931000000 	+
ZHF_4_TRAT_MEJ	*	 0.3073619331718370000000 	+
ZHF_11_INF_VIA_ART_BAS	*	 0.0230661095181905000000 	+
AREA_ACT4	*	-0.0326490011725867000000 	+
GB2	*	 0.1290785080026550000000 	+
GB3	*	 0.0187945411270613000000 	+
GC4	*	 0.0266106583594086000000 	+
TEUSAQUILLO	*	-1.0709080898565200000000 	+
USAQUEN	*	-0.1244425503733200000000 	+
B_UNIDOS	*	-0.5151660434322350000000 	+
SUBA	*	-0.0869447496024082000000 	+
PUNTAJE	*	 0.0032409154560842800000 	+
AREA_CONSTRUIDA	*	-0.0001261762896726840000 	+
DUMMY_SOB_2020_M02_5*	-0.1389488284872020000000 	+
DUMMY_SUB_2020_M02_5*	 0.1795288305563730000000 	+
RELACION_AREA	*	-0.0027317779360362300000 	+
FONTIBON	*	-0.4259127322628190000000 	+
VALOR_REFERENCIA_2020*TEUSAQUILLO	*	 0.0000001653433075278660 	+
EDAD*SUBA	*	-0.0025052877929055100000 	+
EDAD*USAQUEN	*	 0.0024079482470545200000 	+
EDAD*B_UNIDOS	*	 0.0039625252355710200000 	+
B_UNIDOS*RELACION_AREA	*	 0.0549980288771598000000 	+
PUNTAJE*FONTIBON	*	 0.0076757937309158400000 	+
TEUSAQUILLO*PUNTAJE	*	 0.0059531963267381800000 	+
SUBA*AREA_CONSTRUIDA	*	-0.0008225479722863020000 	+
ZHF_1213_16*SUBA	*	 0.3833559228019440000000 	+
ZHF_1213_21*USAQUEN	*	 0.0827908727798125000000 	+
ZHF_1213_14*PUNTAJE	*	-0.0019658999534672600000 	+
ZHF_1213_15*PUNTAJE	*	-0.0015250337823766000000 	);	

IF MODELO_0='M02_6' THEN VALOR_INTEGRAL_20&VIGENCIA_2.=EXP(	 19.85262170510580000000 	+			
COORDENADA_Y	*	-0.00003725474480413140 	+
EDAD	*	-0.01072337549601840000 	+
RFNAL	*	-0.00002653342839537380 	+
USAQUEN	*	-0.20084660885319200000 	+
PUNTAJE	*	 0.00294770754968299000 	+
PKZONAL	*	 0.00005108800202687160 	+
COL_PRIV	*	-0.00004439335471109550 	+
IN_MIL_POL	*	 0.00004617528390477190 	+
PKBOLSIL	*	 0.00005592223527027360 	+
GC3	*	-0.00675511943990647000 	+
ZHF_6_TOPOG_PLANA	*	 0.06454658296052730000 	+
NUMERO_UNIDADES_RES_BMP	*	 0.00046909994579978400 	+
RELACION_AREA	*	-0.06700940993915790000 	+
COL_PUB	*	-0.00006227602851512600 	+
USO_037	*	 0.05123809445151440000 	+
DENSIDAD	*	 0.20558951818534900000 	+
CAI	*	-0.00007088900482805220 	+
EST01	*	 0.00001115987025770490 	+
UNIVERS	*	 0.00003540020603606960 	+
CLINIC123_100_200	*	-0.02741194230585900000 	+
CLINIC123_200_500	*	-0.01814340403407690000 	+
ZHF_1213_15	*	 0.07691410338991240000 	+
DUMMY_SUB_2020_M02_6	*	 0.15073384683330200000 	+
DUMMY_SOB_2020_M02_6	*	-0.12986852768854600000 	+
ZHF_1213_16	*	-0.00235557695309689000 	+
CHAPINERO	*	-0.01648596228108310000 	+
AREA_CONSTRUIDA	*	 0.00005149317836298380 	+
EDAD*USAQUEN	*	 0.00203775059545575000 	+
EDAD*ZHF_1213_16	*	 0.00158270490713857000 	+
PUNTAJE*ZHF_1213_15	*	-0.00131380009372067000 	+
RELACION_AREA*CHAPINERO	*	 0.05220729732221350000 	+
USAQUEN*RELACION_AREA	*	 0.04560363306534940000 	+
CHAPINERO*AREA_CONSTRUIDA	*	-0.00012958502892557400 	+
USAQUEN*ZHF_1213_16	*	 0.07727828102027980000 	);	

IF MODELO_0='M03' THEN VALOR_INTEGRAL_20&VIGENCIA_2.=EXP(	 14.962214027111200000000000 	+	
DUMMY_ESPNORTE	*	 0.461008652116867000000000 +
EST05	*	-0.000047422829835455100000 +
PUNTAJE	*	 0.005217738696036090000000 +
PKZONAL	*	 0.000060900734716898700000 +
EDAD	*	-0.006591643174443530000000 +
NUMERO_UNIDADES_BMP	*	 0.000188564938910407000000 +
VALOR_REFERENCIA_2020	*	 0.000000016355507781266900 +
COL_PUB	*	-0.000082521192255756200000 +
ESTACTM_M_500	*	 0.083887315574675600000000 +
USO_081	*	-0.362618422613264000000000 +
CENT_CHAPINERO	*	-0.149461962580531000000000 +
CENT_SALITRE_Z_IND	*	 0.282917130477458000000000 +
CONSERVACION_M	*	-0.202075466242576000000000 +
ZHF_4_TRAT_RENOV	*	-0.048638187609146900000000 +
ZHF_4_TRAT_CONSERV	*	-0.098028109721636400000000 +
ZHF_10_EST_VIA_BUENO	*	 0.060171196248148700000000 +
ZHF_11_INF_VIA_ZO_INT	*	-0.043673251334476800000000 +
ZHF_1213_21	*	-0.057278098278481800000000 +
ZHF_1213_44	*	-0.183348151179569000000000 +
USAQUEN	*	 0.471667680296081000000000 +
CHAPINERO	*	 0.309340679449639000000000 +
SUBA	*	 0.340931923767772000000000 +
TEUSAQUILLO	*	 0.261754284832180000000000 +
CLINIC123_0_100	*	-0.050842356614460500000000 +
CENTCOMERC_0_100	*	-0.047119651793781600000000 +
ESTACTM_0_100	*	-0.025120977028465000000000 +
AREA_CONSTRUIDA	*	-0.000037478903871373300000 +
PKMETROP	*	 0.000085501345636520500000 +
PKVENCIN	*	-0.000126335865691130000000 +
SANTAFE	*	-0.238183888429729000000000 +
ZHF_11_INF_VIA_ART_COM	*	-0.035047109145083400000000 +
B_UNIDOS	*	 0.140383372631047000000000 +
DUMMY_SUB_2020_M03	*	 0.194546287954571000000000 +
DUMMY_SOB_2020_M03	*	-0.171362489440619000000000 +
RELACION_AREA	*	-0.005080121315238600000000 +
A_NARINO	*	-0.421391320511513000000000 +
CANDELARIA	*	 0.025839914743424000000000 +
P_ARANDA	*	-0.065842495431581600000000 +
ZHF_1213_14	*	 0.037750989140872300000000 +
ZHF_1213_13	*	-0.070567421456003600000000 +
CENT_USAQUEN_H_STA_BARB	*	 0.034346391686204400000000 +
PUNTAJE*SANTAFE	*	 0.004130646177685880000000 +
EDAD*A_NARINO	*	 0.017740283999848600000000 +
EDAD*CANDELARIA	*	 0.002654590413430290000000 +
SANTAFE*RELACION_AREA	*	 0.013092313644333900000000 +
SUBA*AREA_CONSTRUIDA	*	-0.001131280561836950000000 +
AREA_CONSTRUIDA*P_ARANDA	*	-0.001301738887532690000000 +
CHAPINERO*ZHF_1213_14	*	-0.140895679427111000000000 +
SANTAFE*ZHF_1213_13	*	-0.307094868965097000000000 +
ZHF_1213_21*SUBA	*	 0.204874314127652000000000 +
ZHF_11_INF_VIA_ART_COM*P_ARANDA	*	 0.283542282569629000000000 +
AREA_CONSTRUIDA*CENT_USAQUEN_H_STA_BARB	*	-0.000031714372280033600000 +
ZHF_1213_21*P_ARANDA	*	-0.267233420689100000000000 );


IF MODELO_0='M04' THEN VALOR_INTEGRAL_20&VIGENCIA_2.=EXP(	14.753179576853800	 + 	
NUMERO_PISO_01	*	 0.192983265071271000000 	+
NUMERO_PISO_02	*	 0.071119001009953100000 	+
VALOR_REFERENCIA_2020	*	 0.000000106081399572077 	+
COL_PUB	*	 0.000096358200027184700 	+
PUNTAJE	*	 0.006714891594782750000 	+
COL_PRIV	*	-0.000060225299180223600 	+
IN_MIL_POL	*	-0.000045369107629624700 	+
ZHF_1213_24	*	 0.397863365506384000000 	+
CHAPINERO	*	 0.433067660336036000000 	+
EST02	*	 0.000027852325023474800 	+
USAQUEN	*	 0.285369951897395000000 	+
EST04	*	-0.000028587784664235400 	+
ZHF_1213_23	*	 0.198125609765047000000 	+
CENT_USAQUEN_H_STA_BARB	*	 0.235109944182618000000 	+
ZHF_1213_15	*	 0.157726956840160000000 	+
SAN_CRISTOBAL	*	 0.164674281024584000000 	+
USME	*	-0.195688739267557000000 	+
TUNJUELITO	*	-0.113002353233073000000 	+
BOSA	*	 0.239273594790333000000 	+
FONTIBON	*	 0.004388433687297080000 	+
TEUSAQUILLO	*	 0.168126357820302000000 	+
MARTIRES	*	-0.087236538996614500000 	+
A_NARINO	*	 0.089812655841515400000 	+
CANDELARIA	*	 0.281063877417417000000 	+
RAFAEL_U_U	*	 0.102235770403654000000 	+
ZHF_1213_21	*	 0.064377161454493200000 	+
ZHF_1213_22	*	 0.114435325355656000000 	+
ZHF_4_TRAT_CONSOL	*	-0.101487973182899000000 	+
ZHF_4_TRAT_RENOV	*	-0.117642890297335000000 	+
ZHF_4_TRAT_CONSERV	*	-0.143007233076046000000 	+
ZHF_4_TRAT_MEJ	*	-0.080412408331993900000 	+
ZHF_6_TOPOG_PLANA	*	-0.156100584756093000000 	+
ZHF_6_TOPOG_INCL	*	-0.239177391627759000000 	+
ZHF_11_INF_VIA_LOCAL	*	-0.031599979574084700000 	+
ZHF_11_INF_VIA_ZO_INT	*	-0.037869496057224500000 	+
ZHF_11_INF_VIA_ART_COM	*	-0.031046429417875000000 	+
AREA_ACT5	*	 0.043337587052402800000 	+
AREA_ACT6	*	-0.106123772692956000000 	+
CENT_CENTRO_H_INT	*	-0.029437762828882200000 	+
CENT_DELICIAS_ENS	*	 0.123375983249850000000 	+
CENT_RESTREPO_SANT	*	-0.109487956895835000000 	+
CENT_SIETE_AGOSTO	*	-0.067726229705208800000 	+
CENT_SUBA	*	-0.064970241909660600000 	+
CENT_TOBERIN_LA_PAZ	*	-0.173226221312112000000 	+
CENT_VEINTE_JULIO	*	-0.105432529070716000000 	+
CENTCOMERC_0_100	*	 0.033543631576777500000 	+
RELACION_AREA	*	-0.006110378470697560000 	+
AREA_CONSTRUIDA	*	-0.000329937007925201000 	+
EDAD	*	-0.001816936265380350000 	+
NUMERO_UNIDADES_BMP	*	 0.000184629756747932000 	+
PKVENCIN	*	-0.000063341813772160000 	+
USO_040	*	 0.038982739618101900000 	+
KENNEDY	*	 0.269689024179114000000 	+
B_UNIDOS	*	 0.257863152642216000000 	+
P_ARANDA	*	-0.049020532618528700000 	+
SANTAFE	*	 0.132723024442680000000 	+
ZHF_10_EST_VIA_REG	*	-0.029476763339412100000 	+
ZHF_1213_12	*	-0.083229731354410500000 	+
SUBA	*	-0.064763923852037200000 	+
ENGATIVA	*	-0.026244507021395800000 	+
ZHF_1213_14	*	-0.000818115122826631000 	+
ZHF_1213_13	*	 0.013616222580047600000 	+
DUMMY_SOB_2020_M04	*	-0.168805896458534000000 	+
DUMMY_SUB_2020_M04	*	 0.218750497091043000000 	+
VALOR_REFERENCIA_2020*SUBA	*	 0.000000061772452835898 	+
VALOR_REFERENCIA_2020*B_UNIDOS	*	-0.000000068618354500977 	+
VALOR_REFERENCIA_2020*CANDELARIA	*	-0.000000064891821752593 	+
USAQUEN*RELACION_AREA	*	 0.006739784204626230000 	+
A_NARINO*RELACION_AREA	*	 0.009386095743434670000 	+
TEUSAQUILLO*AREA_CONSTRUIDA	*	-0.000636240659768104000 	+
A_NARINO*AREA_CONSTRUIDA	*	-0.000615736146197621000 	+
EDAD*KENNEDY	*	-0.010827137096228900000 	+
FONTIBON*EDAD	*	-0.002237652647880150000 	+
EDAD*ENGATIVA	*	 0.002714857424943720000 	+
CHAPINERO*ZHF_4_TRAT_CONSOL	*	-0.154255320445610000000 	+
CHAPINERO*ZHF_4_TRAT_RENOV	*	-0.220631526228208000000 	+
CHAPINERO*ZHF_6_TOPOG_PLANA	*	-0.138055855388170000000 	+
CHAPINERO*ZHF_10_EST_VIA_REG	*	 0.113123878613577000000 	+
USAQUEN*ZHF_1213_22	*	-0.061480411976571000000 	+
ZHF_1213_23*SANTAFE	*	-0.072857821349803800000 	+
ZHF_11_INF_VIA_ZO_INT*SANTAFE	*	-0.051276276516332200000 	+
ZHF_1213_23*TUNJUELITO	*	-0.121566102588377000000 	+
ZHF_1213_23*KENNEDY	*	-0.203882488273378000000 	+
ZHF_4_TRAT_MEJ*KENNEDY	*	-0.165196626954325000000 	+
ZHF_1213_12*SUBA	*	-0.181556846328600000000 	+
SUBA*ZHF_1213_14	*	 0.083058383075570200000 	+
A_NARINO*ZHF_1213_13	*	-0.136600177901136000000 	+
A_NARINO*ZHF_10_EST_VIA_REG	*	 0.075461197889688300000 	+
ZHF_1213_23*P_ARANDA	*	 0.250103492130983000000 	+
PUNTAJE*FONTIBON	*	 0.002983996992061220000 	); 

IF MODELO_0='M05' THEN VALOR_INTEGRAL_20&VIGENCIA_2.=EXP(14.77120590316850000000000+	
VALOR_REFERENCIA_2020*0.00000010046233740605100+
AREA_CONSTRUIDA*-0.00005637303951149600000+
COORDENADA_Y*0.00000361459060014405000+
USO_091*0.23236266087209000000000+
USAQUEN*-0.26138711715845500000000+
SUBA*-0.25185178939301000000000+
SANTAFE*-0.35793553653091100000000+
SAN_CRISTOBAL*-0.59680826786603600000000+
RAFAEL_U_U*-0.38314759604902800000000+
P_ARANDA*-0.27623475823879100000000+
MARTIRES*-0.54496886576437200000000+
KENNEDY*0.42755594916376600000000+
FONTIBON*-0.29506074983252700000000+
ENGATIVA*-0.18864765491381400000000+
BOSA*-0.36007326436987600000000+
B_UNIDOS*-0.31343716762485800000000+
CENT_CLL_72_CLL_100*0.20867782594687000000000+
CENT_SUBA*-0.54954609212346700000000+
CENT_RESTREPO_SANT*-0.24915120225541200000000+
ZHF_1213_33*0.15664030201445800000000+
ARMAZON_FERROCONCRETO*0.07071304601592630000000+
CERCHA_LIVIANA*-0.23777545176062400000000+
CERCHA_MEDIANA*-0.21300869323314300000000+
DUMMY_STABARBAR*0.62296662295194000000000+
DUMMY_SALITHAYU*0.86083467077966200000000+
AREA_TERRENO*0.00005165806525869420000+
PUNTAJE*0.00138578242059877000000+
USME*-0.21539803562077400000000+
DUMMY_SOB_2020_M05*-0.22574641001500000000000+
DUMMY_SUB_2020_M05*0.30220566940026500000000+
PUNTAJE*USME*-0.01274080768768620000000+
FONTIBON*AREA_TERRENO*-0.00001837336280308200000+
VALOR_REFERENCIA_2020*KENNEDY*-0.00000035755470783326300+
VALOR_REFERENCIA_2020*MARTIRES*0.00000007639119710750680);


IF MODELO_0='M06_123' THEN VALOR_INTEGRAL_20&VIGENCIA_2.=EXP(16.8293648910742	+	
0.152484351395347000000	*	ESTRATO2	+
0.203844144991722000000	*	ESTRATO3	+
-0.000007286987661030820	*	COORDENADA_Y	+
-0.000016212895208956700	*	COORDENADA_X	+
-0.006489247985692840000	*	EDAD	+
-0.101117666633419000000	*	RELACION_AREA	+
-0.000726597533364554000	*	AREA_CONSTRUIDA	+
0.000026606191751392300	*	IN_MIL_POL	+
-0.000026704702519494500	*	EST04	+
-0.000019847490751582200	*	EST05	+
0.000059898597084587600	*	PKBOLSIL	+
0.044446432700955600000	*	PORTALTM_200_500	+
0.076054583904902600000	*	ESTACTM_200_500	+
0.000000201770317764891	*	VALOR_REFERENCIA_2020	+
-0.388911656316722000000	*	SAN_CRISTOBAL	+
-0.156469953044176000000	*	TUNJUELITO	+
-0.051581452971606300000	*	BOSA	+
-0.496258283167810000000	*	KENNEDY	+
-0.624953654024685000000	*	FONTIBON	+
-0.213875195353392000000	*	ENGATIVA	+
-0.131672170329301000000	*	SUBA	+
-0.693498322487764000000	*	A_NARINO	+
0.146845825307546000000	*	P_ARANDA	+
-0.114758352722594000000	*	ZHF_4_TRAT_DESARR	+
-0.041876300060895700000	*	ZHF_4_TRAT_MEJ	+
0.039890410585449300000	*	AREA_ACT2	+
0.148527775269854000000	*	AREA_ACT6	+
0.036071967794060300000	*	ZHF_6_TOPOG_PLANA	+
-0.048625275952621600000	*	ZHF_10_EST_VIA_MALO	+
-0.341992963269360000000	*	GA1	+
-0.386321227526175000000	*	GA2	+
-0.320649962196595000000	*	GA3	+
0.403044012899581000000	*	GB1	+
0.309040074214619000000	*	GB2	+
0.346117582411027000000	*	GB3	+
0.323890576644715000000	*	GB4	+
-0.041196624821569500000	*	Tip7	+
0.040310869795074800000	*	ZHF_1213_13	+
0.060048174791564200000	*	ZHF_1213_17	+
0.058026287277907000000	*	ZHF_1213_21	+
0.198243411317715000000	*	ZHF_1213_22	+
0.270833094173000000000	*	ZHF_1213_23	+
-0.008494697615654570000	*	C_BOLIVAR	+
-0.195242814907676000000	*	DUMMY_SOB_2020_M06_123 +
0.222105634158007000000	*	DUMMY_SUB_2020_M06_123+
0.001812585382337010000	*	PUNTAJE	+
0.088638945779803400000	*	RAFAEL_U_U	+
-0.008667360737817990000	*	USME	+
0.010561919430264500000	*	SAN_CRISTOBAL*PUNTAJE	+
0.006598114486772140000	*	KENNEDY*PUNTAJE	+
0.012310535470029900000	*	FONTIBON*PUNTAJE	+
0.004848808347839870000	*	PUNTAJE*RAFAEL_U_U	+
0.009520622202303400000	*	A_NARINO*PUNTAJE	+
-0.008505747551380310000	*	EDAD*BOSA	+
0.003633657676151320000	*	EDAD*FONTIBON	+
0.005162648001654100000	*	EDAD*ENGATIVA	+
0.004713526500346130000	*	EDAD*SUBA	+
0.008833343818537990000	*	EDAD*A_NARINO	+
-0.103265504154589000000	*	RELACION_AREA*SAN_CRISTOBAL	+
-0.122246648896618000000	*	RELACION_AREA*P_ARANDA	+
-0.000000136421700796333	*	VALOR_REFERENCIA_2020*RAFAEL_U_U	+
0.042893214061115900000	*	RELACION_AREA*USME	);

IF MODELO_0='M06_456' THEN VALOR_INTEGRAL_20&VIGENCIA_2.=EXP(	 10.0421222764323000000000 	 + 	
VALOR_REFERENCIA_2020	*	 0.00000021672273947535900 	+
AREA_ACT5	*	 0.14785170953422600000000 	+
AREA_CONSTRUIDA	*	-0.00006164892011204640000 	+
PUNTAJE	*	 0.12549121291480600000000 	+
EDAD	*	-0.00825739848483072000000 	+
IN_MIL_POL	*	 0.00004100552822543070000 	+
RELACION_AREA	*	-0.34121881950795200000000 	+
B_UNIDOS	*	-0.75863555345678500000000 	+
CHAPINERO	*	 0.06756712210789770000000 	+
COL_PUB	*	-0.00003590701271157470000 	+
CONSERVACION_I	*	 0.40059279224521200000000 	+
COORDENADA_Y	*	-0.00001666269151732350000 	+
DENSIDAD	*	-11.56535174775820000000000 	+
ZHF_1213_22	*	-0.01917245568345900000000 	+
ZHF_1213_15	*	 0.07913520463066260000000 	+
ZHF_1213_16	*	 0.13928775327599600000000 	+
ZHF_1213_13	*	 0.27086838990535300000000 	+
ZHF_10_EST_VIA_BUENO	*	 7.22313870775979000000000 	+
Tip2	*	-0.07786455453436030000000 	+
USAQUEN	*	 0.19093685025755800000000 	+
TEUSAQUILLO	*	-0.06027525497542810000000 	+
SUBA	*	 0.03819362271073110000000 	+
FONTIBON	*	-0.04639174675170390000000 	+
ZHF_1213_14	*	 0.08674755368349680000000 	+
ZHF_10_EST_VIA_REG	*	 7.34348297455277000000000 	+
DUMMY_SOB_2020_M06_456	*	-0.15545597249431400000000 	+
DUMMY_SUB_2020_M06_456	*	 0.25187013417496100000000 	+
AREA_CONSTRUIDA*CHAPINERO	*	-0.00038553244650898500000 	+
AREA_CONSTRUIDA*USAQUEN	*	-0.00039667342464408600000 	+
VALOR_REFERENCIA_2020*B_UNIDOS	*	 0.00000022049282350697300 	+
ZHF_10_EST_VIA_BUENO*FONTIBON	*	 0.13118333582097100000000 	+
ZHF_10_EST_VIA_BUENO*SUBA	*	 0.10952920553703500000000 	+
B_UNIDOS*ZHF_1213_14	*	 0.21139627482927400000000 	+
USAQUEN*ZHF_1213_14	*	-0.09177848804990340000000 	+
ZHF_1213_16*SUBA	*	 0.51918437572917200000000 	+
ZHF_1213_22*TEUSAQUILLO	*	 0.32817020802059300000000 	+
PUNTAJE*ZHF_10_EST_VIA_BUENO	*	-0.12723691725797900000000 	+
PUNTAJE*ZHF_10_EST_VIA_REG	*	-0.12873124643866100000000 	);

RUN;


/**************************************************************************************************************/
/*10. INFORMACIÓN DE VALORES DE TERRENO CORREGIDOS PROVENIENTES DE ODBCLIB.RESOLUCION_PREDIO_DIG. */
/**************************************************************************************************************/


PROC SQL; 	CREATE TABLE PRUEBA.RES_FORM_PRED_SIIC_&VIGENCIA. AS  /*ZHF Y VALORES TERRENO CORREGIDOS VALOR_M2_TERRENO_COR_19*/
		SELECT CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO, VIGENCIA_RESOLUCION,  CODIGO_ZONA_FISICA, VALOR_TERRENO
			FROM ODBCLIB.RESOLUCION_PREDIO_DIG
			WHERE VIGENCIA_RESOLUCION = &VIGENCIA.;
			
QUIT;

PROC SORT 	DATA=PRUEBA.RES_FORM_PRED_SIIC NODUPKEY; BY CODIGO_BARRIO CODIGO_MANZANA CODIGO_PREDIO; RUN;

PROC SQL; 	CREATE TABLE PRUEBA.PREDIO_VISTA_MODELOS AS  /*VALOR_M2_TERRENO_COR_20*/
		SELECT A.*,  B.VALOR_TERRENO AS VALOR_M2_TERRENO_COR_&VIGENCIA_2.
			FROM PREDIO_VISTA_MODELOS AS A LEFT JOIN PRUEBA.RES_FORM_PRED_SIIC_&VIGENCIA. AS B
				ON	A.CODIGO_BARRIO = B.CODIGO_BARRIO &
					A.CODIGO_MANZANA = B.CODIGO_MANZANA &
					A.CODIGO_PREDIO=B.CODIGO_PREDIO
ORDER BY CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO, CODIGO_CONSTRUCCION, CODIGO_RESTO;
QUIT;


/**************************************************************************************************************/
/*10. AVALÚOS ESPECIALES. */
/**************************************************************************************************************/

DATA PRUEBA.AVALUOS_ESPECIALES_OR_&VIGENCIA.;
SET ODBCLIB.AVALUOS_ESPECIALES;  /*TABLA AVALÚOS ESPECIALES 2019*/
AVALUO_ESP = 1;
IF VIGENCIA_RESOLUCION = &VIGENCIA.;
LLAVE = COMPRESS(CODIGO_BARRIO||CODIGO_MANZANA||CODIGO_PREDIO||CODIGO_CONSTRUCCION||CODIGO_RESTO);
DROP PUNTAJE_USO AREA_CONSTRUIDA;
RUN;

PROC SORT DATA = PRUEBA.AVALUOS_ESPECIALES_OR_&VIGENCIA. NODUPKEY OUT = PREDIO_ESP_&VIGENCIA.; BY LLAVE; RUN;


PROC SQL; CREATE TABLE AVES_VISTA0 AS	/*LIQUIDACION VALOR CONSTRUCCION PONDERADO AVES*/
		SELECT A.CODIGO_LOCALIDAD, A.NOMBRE_BARRIO, A.CODIGO_BARRIO, A.CODIGO_MANZANA, A.CODIGO_PREDIO, A.CODIGO_CONSTRUCCION, A.CODIGO_RESTO , 
A.CODIGO_USO, A.UNIDAD_CALIFICADA, A.AREA_USO,
B.AVALUO_ESP /*VU_AREA=VALOR_UNITARIO_2019_AVES*AREA_USO*/
				FROM PRUEBA.VISTA_MODELO_UNID_LIQ AS A 
               INNER JOIN PREDIO_ESP_&VIGENCIA. AS B
				ON	A.CODIGO_BARRIO = B.CODIGO_BARRIO &
					A.CODIGO_MANZANA = B.CODIGO_MANZANA &
					A.CODIGO_PREDIO = B.CODIGO_PREDIO &
					A.CODIGO_CONSTRUCCION = B.CODIGO_CONSTRUCCION &
					A.CODIGO_RESTO = B.CODIGO_RESTO;
QUIT;



PROC SQL; CREATE TABLE AVES_VISTA1 AS	/*LIQUIDACION VALOR CONSTRUCCION PONDERADO AVES*/
		SELECT A.CODIGO_LOCALIDAD, A.NOMBRE_BARRIO, A.CODIGO_BARRIO, A.CODIGO_MANZANA, A.CODIGO_PREDIO, A.CODIGO_CONSTRUCCION, A.CODIGO_RESTO , 
               A.CODIGO_USO, A.UNIDAD_CALIFICADA, A.AREA_USO, A.AVALUO_ESP, 
B.MODELO_0, B.NOMBRE_MODELO_0, B.MODELO_USO, B.VALOR_UNITARIO_&VIGENCIA. /*VU_AREA=VALOR_UNITARIO_2019_AVES*AREA_USO*/
				FROM AVES_VISTA0 AS A LEFT JOIN PRUEBA.PREDIOS_VALORES_TABLAS_NPH AS B
				ON	A.CODIGO_BARRIO = B.CODIGO_BARRIO &
					A.CODIGO_MANZANA = B.CODIGO_MANZANA &
					A.CODIGO_PREDIO = B.CODIGO_PREDIO &
					A.CODIGO_CONSTRUCCION = B.CODIGO_CONSTRUCCION &
					A.CODIGO_RESTO = B.CODIGO_RESTO &
					A.CODIGO_USO = B.CODIGO_USO	&
					A.UNIDAD_CALIFICADA = B.UNIDAD_CALIFICADA;
QUIT;



PROC SQL; CREATE TABLE AVES_VISTA2 AS	/*LIQUIDACION VALOR CONSTRUCCION PONDERADO AVES*/
		SELECT A.*,  B.VALOR_M2_CONSTRUCCION AS VALOR_UNITARIO_UCAL_AVESP, B.ORIGEN /*VU_AREA=VALOR_UNITARIO_2019_AVES*AREA_USO*/
				FROM AVES_VISTA1 AS A LEFT JOIN  PRUEBA.AVALUOS_ESPECIALES_OR_&VIGENCIA. AS B
				ON	A.CODIGO_BARRIO = B.CODIGO_BARRIO &
					A.CODIGO_MANZANA = B.CODIGO_MANZANA &
					A.CODIGO_PREDIO = B.CODIGO_PREDIO &
					A.CODIGO_CONSTRUCCION = B.CODIGO_CONSTRUCCION &
					A.CODIGO_RESTO = B.CODIGO_RESTO &
					A.CODIGO_USO = B.CODIGO_USO	&
					A.UNIDAD_CALIFICADA = B.UNIDAD_CALIFICADA;
QUIT;


/* EN EL SIGUIENTE DATA SET, CREO QUE LA VARIABLE VALOR_UNITARIO_UC_AVES ESTÁ MAL FORMULADA */

DATA PRUEBA.AVES_VISTA; set AVES_VISTA2;
IF VALOR_UNITARIO_UCAL_AVESP = . THEN VALOR_UNITARIO_UC_AVES = VALOR_UNITARIO_&VIGENCIA.;
ELSE VALOR_UNITARIO_UC_AVES = VALOR_UNITARIO_UCAL_AVESP * AREA_USO; /* PARA MÍ, EN ESTA SENTENCIA SOBRA EL ÁREA DEL USO */
IF VALOR_UNITARIO_UCAL_AVESP = . THEN VU_AREA = VALOR_UNITARIO_&VIGENCIA. * AREA_USO;
ELSE VU_AREA = VALOR_UNITARIO_UCAL_AVESP * AREA_USO;
RUN;

PROC SQL; CREATE TABLE AVES_PRED_VCONST AS SELECT CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO, CODIGO_CONSTRUCCION, CODIGO_RESTO,
SUM(VU_AREA) AS VALOR_CONSTRUCCION_COM_&VIGENCIA.
FROM PRUEBA.AVES_VISTA
GROUP BY CODIGO_BARRIO, CODIGO_MANZANA, CODIGO_PREDIO, CODIGO_CONSTRUCCION, CODIGO_RESTO;
QUIT;

PROC SQL;CREATE TABLE PRUEBA.AVES_VISTA2 AS SELECT A.*,
B.VALOR_CONSTRUCCION_COM_&VIGENCIA. AS VALOR_UNITARIO_AVESP_&VIGENCIA.
FROM PRUEBA.AVES_VISTA AS A LEFT JOIN AVES_PRED_VCONST AS B ON 
A.CODIGO_BARRIO = B.CODIGO_BARRIO &
A.CODIGO_MANZANA = B.CODIGO_MANZANA &
A.CODIGO_PREDIO = B.CODIGO_PREDIO &
A.CODIGO_CONSTRUCCION = B.CODIGO_CONSTRUCCION &
A.CODIGO_RESTO = B.CODIGO_RESTO
ORDER BY A.CODIGO_BARRIO, A.CODIGO_MANZANA, A.CODIGO_PREDIO, A.CODIGO_CONSTRUCCION, A.CODIGO_RESTO;
QUIT;


DATA PRUEBA.AVALUOS_ESPECIALES_&VIGENCIA.;SET PRUEBA.AVES_VISTA2;  /*TABLA AVALÚOS ESPECIALES 2019*/
/*IF SUBSTR(CODIGO_BARRIO,1,1) EQ '0' ; /* AVALÚOS ESPECIALES SÓLO URBANOS */
LLAVE = COMPRESS(CODIGO_BARRIO||CODIGO_MANZANA||CODIGO_PREDIO||CODIGO_CONSTRUCCION||CODIGO_RESTO);
KEEP CODIGO_BARRIO CODIGO_MANZANA CODIGO_PREDIO CODIGO_CONSTRUCCION CODIGO_RESTO CODIGO_USO UNIDAD_CALIFICADA LLAVE CODIGO_RESTO VALOR_UNITARIO_UC_AVES VALOR_UNITARIO_AVESP_&VIGENCIA. AVALUO_ESP ORIGEN; 
RUN;

PROC SQL; CREATE TABLE BD_PREDIOS_VLORM2_TERCOR_AVES AS	/*LIQUIDACION VALOR CONSTRUCCION PONDERADO AVES*/
		SELECT A.*,  B.ORIGEN, B.VALOR_UNITARIO_UC_AVES /*VU_AREA=VALOR_UNITARIO_2019_AVES*AREA_USO*/
				FROM PRUEBA.PREDIO_VISTA_MODELOS AS A 
				LEFT JOIN  PRUEBA.AVALUOS_ESPECIALES_&VIGENCIA. AS B
				ON	A.CODIGO_BARRIO = B.CODIGO_BARRIO &
					A.CODIGO_MANZANA = B.CODIGO_MANZANA &
					A.CODIGO_PREDIO = B.CODIGO_PREDIO &
					A.CODIGO_CONSTRUCCION = B.CODIGO_CONSTRUCCION &
					A.CODIGO_RESTO = B.CODIGO_RESTO &
					A.CODIGO_USO = B.CODIGO_USO	&
					A.UNIDAD_CALIFICADA = B.UNIDAD_CALIFICADA;
QUIT;

PROC SORT DATA=PRUEBA.AVALUOS_ESPECIALES_&VIGENCIA. NODUPKEY;   /*Base  AVALUOS_ESPECIALES a nivel de predio*/
BY CODIGO_BARRIO CODIGO_MANZANA CODIGO_PREDIO CODIGO_CONSTRUCCION CODIGO_RESTO;
QUIT;


PROC SQL; CREATE TABLE PRUEBA.BD_PREDIOS_VLORM2_TERCOR_AVES AS	/*LIQUIDACION VALOR CONSTRUCCION PONDERADO AVES*/
		SELECT A.*,  B.VALOR_UNITARIO_AVESP_&VIGENCIA., B.AVALUO_ESP /*VU_AREA=VALOR_UNITARIO_2019_AVES*AREA_USO*/
				FROM BD_PREDIOS_VLORM2_TERCOR_AVES AS A LEFT JOIN  PRUEBA.AVALUOS_ESPECIALES_&VIGENCIA. AS B
				ON	A.CODIGO_BARRIO = B.CODIGO_BARRIO &
					A.CODIGO_MANZANA = B.CODIGO_MANZANA &
					A.CODIGO_PREDIO = B.CODIGO_PREDIO &
					A.CODIGO_CONSTRUCCION = B.CODIGO_CONSTRUCCION &
					A.CODIGO_RESTO = B.CODIGO_RESTO 
					;
QUIT;

/******************/


/*****************************************************************************/
/*	EN ESTA LINEA SE EXCLUYEN LAS UNIDADES CORRESPONDIENTES A AVALÚOS ESPECIALES QUE NO SON LA UNIDAD DE LIQUIDACIÓN */
/*****************************************************************************/  

DATA BD_PREDIOS_VLORM2_TERCOR_AVES; SET PRUEBA.BD_PREDIOS_VLORM2_TERCOR_AVES;
IF MODELO_0 NOT IN ('USOS MULTIPLES') AND UNIDAD_LIQUIDACION=0 AND AVALUO_ESP=1 THEN DELETE; RUN;


/*****************************************************************************/
/*			FIN AVALUOS ESPECIALES											 */
/*****************************************************************************/  

/*****************************************************************************/  
/* CALCULO DEL AVALUO COMERCIAL  */
/*****************************************************************************/  
DATA PREDIO_TABLA_LIQ_1; SET BD_PREDIOS_VLORM2_TERCOR_AVES; /*LIQUIDACION VALOR_INTEGRAL T21, T22,T23 Y VALOR_AVALUO_COM_2020*/
VALOR_AVALUO_COM_&VIGENCIA. = VALOR_UNITARIO_&VIGENCIA. * AREA_CONSTRUIDA + VALOR_M2_TERRENO_COR_&VIGENCIA_2. * AREA_TERRENO;
IF MODELO_0 IN ('USOS MULTIPLES') AND AVALUO_ESP NE 1 THEN VALOR_AVALUO_COM_&VIGENCIA.=VALOR_CONSTRUCCION_COM_&VIGENCIA._UM + VALOR_M2_TERRENO_COR_&VIGENCIA_2. * AREA_TERRENO;

IF MODELO_0 IN ('USOS MULTIPLES') AND AVALUO_ESP = 1 THEN VALOR_AVALUO_COM_&VIGENCIA. = VALOR_UNITARIO_AVESP_&VIGENCIA. + VALOR_M2_TERRENO_COR_&VIGENCIA_2. * AREA_TERRENO;

IF (MODELO_0 IN ('T21','T22')) THEN VALOR_AVALUO_COM_&VIGENCIA. = PRODUCTO_&VIGENCIA.;
IF MODELO_0 IN ('M01_1', 'M01_2', 'M01_3', 'M02_4', 'M02_5', 'M02_6', 'M03', 'M04','M05','M06_123', 'M06_456') THEN VALOR_AVALUO_COM_&VIGENCIA. = VALOR_INTEGRAL_&VIGENCIA. * AREA_CONSTRUIDA; 
IF MODELO_0 IN ('LOTES_PH','LOTES_NPH') THEN VALOR_AVALUO_COM_&VIGENCIA.=VALOR_M2_TERRENO_COR_&VIGENCIA_2. * AREA_TERRENO;
IF AVALUO_ESP = 1 THEN VALOR_AVALUO_COM_&VIGENCIA. = ((VALOR_UNITARIO_AVESP_&VIGENCIA.)+(VALOR_M2_TERRENO_COR_&VIGENCIA_2.*AREA_TERRENO));

IF MODELO_0 IN ('T23') THEN VALOR_INTEGRAL_&VIGENCIA. = VALOR_UNITARIO_&VIGENCIA.; 
IF (MODELO_0 IN ('T21','T22')) THEN VALOR_INTEGRAL_&VIGENCIA. = PRODUCTO_&VIGENCIA./AREA_CONSTRUIDA; 

RUN; 

/*****************************************************************************/  
/* CÁLCULO DE VALORES DE CONSTRUCCIÓN POR M2 DE ACUERDO AL MODELO  */
/*****************************************************************************/  
DATA PRUEBA.BD_PREDIOS_LIQUIDACIONT_TAB_UR; SET PREDIO_TABLA_LIQ_1; /*LIQUIDACION VALOR_M2_CONSTRUCCION_2020 Y VALOR_AVALUO_COM_2020*/
IF MODELO_0 IN ('USOS MULTIPLES') AND AVALUO_ESP NE 1 THEN VALOR_M2_CONSTRUCCION_&VIGENCIA. = VALOR_CONSTRUCCION_COM_&VIGENCIA._UM/AREA_CONSTRUIDA;
IF MODELO_0 IN ('USOS MULTIPLES') AND AVALUO_ESP = 1  THEN VALOR_M2_CONSTRUCCION_&VIGENCIA. = VALOR_UNITARIO_AVESP_&VIGENCIA./AREA_CONSTRUIDA;

IF MODELO_0 NOT IN ('USOS MULTIPLES') THEN VALOR_M2_CONSTRUCCION_&VIGENCIA. = VALOR_UNITARIO_&VIGENCIA.;/*LIQUIDACION USO A USO*/
IF MODELO_0 IN ('T21','T22') THEN VALOR_M2_CONSTRUCCION_&VIGENCIA. = (VALOR_AVALUO_COM_&VIGENCIA.-(AREA_TERRENO*VALOR_M2_TERRENO_COR_&VIGENCIA_2.))/AREA_CONSTRUIDA; 
IF MODELO_0 IN ('T23') THEN VALOR_AVALUO_COM_&VIGENCIA.=(VALOR_INTEGRAL_&VIGENCIA.*AREA_CONSTRUIDA);
IF MODELO_0 IN ('M01_1', 'M01_2', 'M01_3', 'M02_4', 'M02_5', 'M02_6', 'M03', 'M04', 'M05', 'M06_123', 'M06_456', 'T23') 
THEN VALOR_M2_CONSTRUCCION_&VIGENCIA. = ((VALOR_INTEGRAL_&VIGENCIA. * AREA_CONSTRUIDA) - (AREA_TERRENO * VALOR_M2_TERRENO_COR_&VIGENCIA_2.))/AREA_CONSTRUIDA;

IF AVALUO_ESP = 1 THEN VALOR_M2_CONSTRUCCION_&VIGENCIA. = VALOR_UNITARIO_AVESP_&VIGENCIA./AREA_CONSTRUIDA; /*se descomentan cuando haya tabla */ 

VALOR_M2_CONSTRUCCION_&VIGENCIA._or = VALOR_M2_CONSTRUCCION_&VIGENCIA.;
VALOR_AVALUO_COM_&VIGENCIA._or = VALOR_AVALUO_COM_&VIGENCIA.;
MODELO_0_or = MODELO_0;
NOMBRE_MODELO_0_or = NOMBRE_MODELO_0;
MODELO_USO_or = MODELO_USO;
LIQUIDACION_or = LIQUIDACION;
RUN; 





DATA PRUEBA.BD_PREDIOS_LIQUID_TAB_MOD_AVES; SET PRUEBA.BD_PREDIOS_LIQUIDACIONT_TAB_UR; /*VALORES AVALUO ESPECIAL*/
IF AVALUO_ESP = 1 THEN LIQUIDACION='AVESP';
/*IF AVALUO_ESP = 1 and LIQUIDACION='MODEL' THEN MODELO_0 = 'AV_ESP_MOD' ;*/
IF AVALUO_ESP = 1 AND MODELO_0 NOT IN ('USOS MULTIPLES')  THEN MODELO_0 ='AVESP';
IF AVALUO_ESP = 1 AND MODELO_0 IN ('USOS MULTIPLES')  THEN MODELO_0 ='USOS MULTIPLES CON AVESP';
IF AVALUO_ESP = 1 and MODELO_0 NOT IN ('USOS MULTIPLES') AND ORIGEN=4 THEN MODELO_0 = 'AV_ESP_USO';
IF AVALUO_ESP = 1 and MODELO_0 NOT IN ('USOS MULTIPLES') AND ORIGEN=5 THEN MODELO_0 = 'PRED_CESP';
IF AVALUO_ESP = 1 and MODELO_0 NOT IN ('USOS MULTIPLES') AND ORIGEN=6 THEN MODELO_0 = 'REVIS_CAT';
IF AVALUO_ESP = 1 and MODELO_0 NOT IN ('USOS MULTIPLES') AND ORIGEN=7 THEN MODELO_0 = 'AV_COMER';
IF AVALUO_ESP = 1 and MODELO_0 NOT IN ('USOS MULTIPLES') AND ORIGEN=8 THEN MODELO_0 = 'AV_ESP_MOD';
IF AVALUO_ESP = 1 and MODELO_0 NOT IN ('USOS MULTIPLES') AND ORIGEN=9 THEN MODELO_0 = 'AV_ESP_TAB';
IF AVALUO_ESP = 1 and MODELO_0 NOT IN ('USOS MULTIPLES') AND ORIGEN=10 THEN MODELO_0 = 'AV_ESP_TOP';
IF AVALUO_ESP = 1 and MODELO_0 NOT IN ('USOS MULTIPLES') AND ORIGEN=11 THEN MODELO_0 = 'AV_ESP_BIC';
IF AVALUO_ESP = 1 and MODELO_0 NOT IN ('USOS MULTIPLES') AND ORIGEN=12 THEN MODELO_0 = 'AV_RUR_PH';
IF AVALUO_ESP = 1 and MODELO_0 NOT IN ('USOS MULTIPLES') AND ORIGEN=13 THEN MODELO_0 = 'AV_USO_MU';
IF AVALUO_ESP = 1 and MODELO_0 NOT IN ('USOS MULTIPLES') AND ORIGEN=14 THEN MODELO_0 = 'AV_ESP_SEN';
IF AVALUO_ESP = 1 and MODELO_0 NOT IN ('USOS MULTIPLES') AND ORIGEN=15 THEN MODELO_0 = 'AV_ESP_CC';
IF AVALUO_ESP = 1 and MODELO_0 NOT IN ('USOS MULTIPLES') AND ORIGEN=16 THEN MODELO_0 = 'AV_ESP_IND';
IF AVALUO_ESP = 1 and MODELO_0 NOT IN ('USOS MULTIPLES') AND ORIGEN=18 THEN MODELO_0 = 'AVAL_COMER';
IF AVALUO_ESP = 1 and MODELO_0 NOT IN ('USOS MULTIPLES') AND ORIGEN=43 THEN MODELO_0 = 'AV_ESP_MUL';
IF AVALUO_ESP = 1 and MODELO_0 NOT IN ('USOS MULTIPLES') AND ORIGEN=44 THEN MODELO_0 = 'AV_AUTO_CAT';
IF AVALUO_ESP = 1 and MODELO_0 NOT IN ('USOS MULTIPLES') AND ORIGEN=63 THEN MODELO_0 = 'AV_PROC_MARC';
IF AVALUO_ESP = 1 and MODELO_0 NOT IN ('USOS MULTIPLES') AND ORIGEN=64 THEN MODELO_0 = 'AV 100';

IF AVALUO_ESP = 1 and ORIGEN=4 THEN MODELO_USO = 'AV_ESP_USO';
IF AVALUO_ESP = 1 and ORIGEN=5 THEN MODELO_USO = 'PRED_CESP';
IF AVALUO_ESP = 1 and ORIGEN=6 THEN MODELO_USO = 'REVIS_CAT';
IF AVALUO_ESP = 1 and ORIGEN=7 THEN MODELO_USO = 'AV_COMER';
IF AVALUO_ESP = 1 and ORIGEN=8 THEN MODELO_USO = 'AV_ESP_MOD';
IF AVALUO_ESP = 1 and ORIGEN=9 THEN MODELO_USO = 'AV_ESP_TAB';
IF AVALUO_ESP = 1 and ORIGEN=10 THEN MODELO_USO = 'AV_ESP_TOP';
IF AVALUO_ESP = 1 and ORIGEN=11 THEN MODELO_USO = 'AV_ESP_BIC';
IF AVALUO_ESP = 1 and ORIGEN=12 THEN MODELO_USO = 'AV_RUR_PH';
IF AVALUO_ESP = 1 and ORIGEN=13 THEN MODELO_USO = 'AV_USO_MU';
IF AVALUO_ESP = 1 and ORIGEN=14 THEN MODELO_USO = 'AV_ESP_SEN';
IF AVALUO_ESP = 1 and ORIGEN=15 THEN MODELO_USO = 'AV_ESP_CC';
IF AVALUO_ESP = 1 and ORIGEN=16 THEN MODELO_USO = 'AV_ESP_IND';
IF AVALUO_ESP = 1 and ORIGEN=18 THEN MODELO_USO = 'AVAL_COMER';
IF AVALUO_ESP = 1 and ORIGEN=43 THEN MODELO_USO = 'AV_ESP_MUL';
IF AVALUO_ESP = 1 and ORIGEN=44 THEN MODELO_USO = 'AV_AUTO_CAT';
IF AVALUO_ESP = 1 and ORIGEN=63 THEN MODELO_USO = 'AV_PROC_MARC';
IF AVALUO_ESP = 1 and ORIGEN=64 THEN MODELO_USO = 'AV 100';

IF AVALUO_ESP = 1  AND MODELO_0 IN ('USOS MULTIPLES') THEN NOMBRE_MODELO_0 = 'USOS MULTIPLES CON AVESP';
IF AVALUO_ESP = 1  AND MODELO_0 NOT IN ('USOS MULTIPLES') THEN NOMBRE_MODELO_0 = 'AVESP';
IF AVALUO_ESP = 1 and ORIGEN=4 THEN NOMBRE_MODELO_0 = 'AV_ESP_USO - PREDIOS CON USO SIN TABLA NI MODELO';
IF AVALUO_ESP = 1 and ORIGEN=5 THEN NOMBRE_MODELO_0 = 'PRED_CESP - PREDIOS CON CARACTERISTICAS ESPECIALES';
IF AVALUO_ESP = 1 and ORIGEN=6 THEN NOMBRE_MODELO_0 = 'REVIS_CAT - AVALUOS CON MARCAS ECONOMICAS';
IF AVALUO_ESP = 1 and ORIGEN=7 THEN NOMBRE_MODELO_0 = 'AV_COMER - PREDIOS CON AVALUOS COMERCIALES';
IF AVALUO_ESP = 1 and ORIGEN=8 THEN NOMBRE_MODELO_0 = 'AV_ESP_MOD - AVALUOS CON USO DE MODELO NO SE AJUSTA';
IF AVALUO_ESP = 1 and ORIGEN=9 THEN NOMBRE_MODELO_0 = 'AV_ESP_TAB - AVALUOS CON TABLA VALOR NO SE AJUSTA';
IF AVALUO_ESP = 1 and ORIGEN=10 THEN NOMBRE_MODELO_0 = 'AV_ESP_TOP - AVALUOS CON AREA QUE SUPERA EL TOPE';
IF AVALUO_ESP = 1 and ORIGEN=11 THEN NOMBRE_MODELO_0 = 'AV_ESP_BIC - AVALUOS DE PREDIOS DE INTERES CULTURAL';
IF AVALUO_ESP = 1 and ORIGEN=12 THEN NOMBRE_MODELO_0 = 'AV_RUR_PH - AVALUOS RURALES EN PH';
IF AVALUO_ESP = 1 and ORIGEN=13 THEN NOMBRE_MODELO_0 = 'AV_USO_MU - AVALUOS DE USOS MULTIPLES';
IF AVALUO_ESP = 1 and ORIGEN=14 THEN NOMBRE_MODELO_0 = 'AV_ESP_SEN - AVALUOS PRESENTADOS EN EL PROCESO DE SENSIBILIDAD';
IF AVALUO_ESP = 1 and ORIGEN=15 THEN NOMBRE_MODELO_0 = 'AV_ESP_CC - AVALUOS DE CENTROS COMERCIALES';
IF AVALUO_ESP = 1 and ORIGEN=16 THEN NOMBRE_MODELO_0 = 'AV_ESP_IND - AVALUOS POR INCREMENTO INDICE LOCAL POR USO';
IF AVALUO_ESP = 1 and ORIGEN=18 THEN NOMBRE_MODELO_0 = 'AVAL_COMER - PREDIOS CON AVALUOS COMERCIALES PUNTUALES';
IF AVALUO_ESP = 1 and ORIGEN=43 THEN NOMBRE_MODELO_0 = 'AV_ESP_MUL - PREDIOS USO DE TABLA Y MODELO';
IF AVALUO_ESP = 1 and ORIGEN=44 THEN NOMBRE_MODELO_0 = 'AV_AUTO_CAT - PREDIO CON AUTO-AVALUO ACEPTADO';
IF AVALUO_ESP = 1 and ORIGEN=63 THEN NOMBRE_MODELO_0 = 'AV_PROC_MARC - AVALUOS ESPECIAL GENERADO POR EL PROCESO DE MARCAS';
IF AVALUO_ESP = 1 and ORIGEN=64 THEN NOMBRE_MODELO_0 = 'AV 100 - USOS CON MAS DE 100 AÑOS DE VETUSTEZ';

RUN;


PROC SQL;	CREATE TABLE PREDIO_Y_UM_FINAL_&FECHA_CORTE.  AS
		SELECT A.*,  B.AVALUO_TOTAL_PUNTUAL_COM_&VIGENCIA_ANT. AS VALOR_AVALUO_COM_&VIGENCIA_ANT., 
                    B.VALOR_M2_CONS_COM_&VIGENCIA_ANT. AS VALOR_M2_CONSTRUCCION_&VIGENCIA_ANT.,
             	((A.VALOR_AVALUO_COM_&VIGENCIA.-B.AVALUO_TOTAL_PUNTUAL_COM_&VIGENCIA_ANT.)/B.AVALUO_TOTAL_PUNTUAL_COM_&VIGENCIA_ANT.) AS VAR_AVALUO_COM_&VIGENCIA_ANT._&VIGENCIA.,
				((A.VALOR_M2_CONSTRUCCION_&VIGENCIA.-B.VALOR_M2_CONS_COM_&VIGENCIA_ANT.)/B.VALOR_M2_CONS_COM_&VIGENCIA_ANT.) AS VAR_M2_CONS_COM_&VIGENCIA_ANT._&VIGENCIA.
				FROM PRUEBA.BD_PREDIOS_LIQUID_TAB_MOD_AVES AS A LEFT JOIN COMUN.PREDIO_FINAL_&VIGENCIA_ANT. AS B  
				ON	A.CODIGO_BARRIO = B.CODIGO_BARRIO &
					A.CODIGO_MANZANA = B.CODIGO_MANZANA &
					A.CODIGO_PREDIO=B.CODIGO_PREDIO &
					A.CODIGO_CONSTRUCCION=B.CODIGO_CONSTRUCCION &
					A.CODIGO_RESTO=B.CODIGO_RESTO
			ORDER BY A.CODIGO_BARRIO, A.CODIGO_MANZANA, A.CODIGO_PREDIO, CODIGO_CONSTRUCCION, CODIGO_RESTO,
			CODIGO_USO, UNIDAD_CALIFICADA;
QUIT;

/*****************************************************************************/
/*			CALCULO VALORES CATASTRALES										 */
/*****************************************************************************/
DATA PREDIO_COMERCIAL;SET PREDIO_Y_UM_FINAL_&FECHA_CORTE.;
IF (AREA_CONSTRUIDA=.) THEN AREA_CONSTRUIDA = 0;
IF (AREA_CONSTRUIDA=. OR AREA_CONSTRUIDA=0)  THEN VALOR_M2_CONSTRUCCION_&VIGENCIA. = 0;
ELSE VALOR_M2_CONSTRUCCION_&VIGENCIA. = VALOR_M2_CONSTRUCCION_&VIGENCIA.;
IF VALOR_M2_CONSTRUCCION_&VIGENCIA. = . THEN VALOR_M2_CONSTRUCCION_&VIGENCIA. = 0;
RUN;

 
/*LIQUIDACIÓN AVALÚO CATASTRAL */

DATA PRUEBA.PREDIO_COMERCIAL_A; /*CALCULO VALORES CATASTRALES	*/
SET PREDIO_COMERCIAL;

/*Aplicación de CONFIS 2020*/
/*Aplicación General, cubre los casos no específicos*/

VALOR_M2_TERRENO_CAT_&VIGENCIA. = VALOR_M2_TERRENO_COR_&VIGENCIA_2.*0.85;
VALOR_M2_CONSTRUCCION_CAT_&VIGENCIA. = VALOR_M2_CONSTRUCCION_&VIGENCIA.*0.75; 
 
/* Lotes */
IF AREA_CONSTRUIDA=0 OR (CODIGO_USOP in ('090')) THEN DO;
     VALOR_M2_TERRENO_CAT_&VIGENCIA. = VALOR_M2_TERRENO_COR_&VIGENCIA_2.*0.90;
     VALOR_M2_CONSTRUCCION_CAT_&VIGENCIA. = VALOR_M2_CONSTRUCCION_&VIGENCIA.*0.90;
END;
 
/* Residencial, Parqueaderos y Bodegas*/
ELSE DO;
     IF CODIGO_DESTINO='01' THEN DO; 
          IF 0<CODIGO_ESTRATO<3  THEN DO;
           VALOR_M2_TERRENO_CAT_&VIGENCIA. = VALOR_M2_TERRENO_COR_&VIGENCIA_2.*0.65;
           VALOR_M2_CONSTRUCCION_CAT_&VIGENCIA. = VALOR_M2_CONSTRUCCION_&VIGENCIA.*0.60;
        END;
          IF codigo_estrato=3 THEN DO;
           VALOR_M2_TERRENO_CAT_&VIGENCIA. = VALOR_M2_TERRENO_COR_&VIGENCIA_2.*0.68;
           VALOR_M2_CONSTRUCCION_CAT_&VIGENCIA. = VALOR_M2_CONSTRUCCION_&VIGENCIA.*0.60;
        END;
          if codigo_estrato=4 THEN DO;
           VALOR_M2_TERRENO_CAT_&VIGENCIA. = VALOR_M2_TERRENO_COR_&VIGENCIA_2.*0.84;
           VALOR_M2_CONSTRUCCION_CAT_&VIGENCIA. = VALOR_M2_CONSTRUCCION_&VIGENCIA.*0.64;
        END;
          IF 4<codigo_estrato<=6 THEN DO;
           VALOR_M2_TERRENO_CAT_&VIGENCIA. = VALOR_M2_TERRENO_COR_&VIGENCIA_2.*0.85;
           VALOR_M2_CONSTRUCCION_CAT_&VIGENCIA. = VALOR_M2_CONSTRUCCION_&VIGENCIA.*0.74;
        END;
     END;
     IF CODIGO_DESTINO='24' OR (CODIGO_USOP IN ('025','033')) THEN DO;
           VALOR_M2_TERRENO_CAT_&VIGENCIA. = VALOR_M2_TERRENO_COR_&VIGENCIA_2.*0.90;
           VALOR_M2_CONSTRUCCION_CAT_&VIGENCIA. = VALOR_M2_CONSTRUCCION_&VIGENCIA.*0.90;
     END;
END;
/*rurales*/
IF ID_UR_RU IN ('1','2') THEN DO; 
           VALOR_M2_TERRENO_CAT_&VIGENCIA. = VALOR_M2_TERRENO_COR_&VIGENCIA_2.*0.70;
           VALOR_M2_CONSTRUCCION_CAT_&VIGENCIA. = VALOR_M2_CONSTRUCCION_&VIGENCIA.*0.60;
END;

VALOR_AVALUO_CAT = AREA_TERRENO*VALOR_M2_TERRENO_CAT_&VIGENCIA. + AREA_CONSTRUIDA*VALOR_M2_CONSTRUCCION_CAT_&VIGENCIA.;

RUN;


DATA COMUN.PREDIO_Y_UM_FINAL_&FECHA_CORTE.;  SET PRUEBA.PREDIO_COMERCIAL_A;
IF ID_UR_RU IN ('1','2') AND ACTUALIZADO NOT = 1 THEN VALOR_M2_TERRENO_CAT_&VIGENCIA. = (VALOR_M2_TERRENO*0.977); ELSE VALOR_M2_TERRENO_CAT_&VIGENCIA. = VALOR_M2_TERRENO_CAT_&VIGENCIA.;
IF ID_UR_RU IN ('1','2') AND ACTUALIZADO NOT = 1 THEN VALOR_M2_CONSTRUCCION_CAT_&VIGENCIA. = (VALOR_M2_CONSTRUCCION*0.977); ELSE VALOR_M2_CONSTRUCCION_CAT_&VIGENCIA. = VALOR_M2_CONSTRUCCION_CAT_&VIGENCIA.;
IF ID_UR_RU IN ('1','2') AND ACTUALIZADO NOT = 1 THEN VALOR_AVALUO_CAT = (AREA_TERRENO * (VALOR_M2_TERRENO*0.977) + AREA_CONSTRUIDA * (VALOR_M2_CONSTRUCCION * 0.977)); ELSE VALOR_AVALUO_CAT=VALOR_AVALUO_CAT;
RUN;

data _null_;
  dur = datetime() - &_timer_start;
  put 30*'-' / ' TOTAL DURATION:' dur time13.2 / 30*'-';
run;

/*
DATA BASE_FOCA_MODELACION;
SET COMUN.PREDIO_Y_UM_FINAL_&FECHA_CORTE.;
IF FOCA_MODELACION = 1 AND F_EXPANSION NE . AND
MODELO_0 IN ("M01_1", "M01_2", "M01_3", "M02_4", "M02_5", "M02_6", "M03", "M04", "M05", "M06_123", "M06_456") AND 
UNIDAD_LIQUIDACION = 1;
RUN;
*/